<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Joins and logic</title>
    <meta charset="utf-8" />
    <meta name="author" content="Todd Gerarden" />
    <script src="libs/header-attrs-2.20/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/tdg-slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">









class: center middle main-title section-title-4

# Joins and logic

.class-info[

**Week 4**

AEM 2850 / 5850 : R for Business Analytics&lt;br&gt;
Cornell Dyson&lt;br&gt;
Spring 2023

Acknowledgements: 
&lt;!-- [Andrew Heiss](https://datavizm20.classes.andrewheiss.com),  --&gt;
&lt;!-- [Claus Wilke](https://wilkelab.org/SDS375/),  --&gt;
[Grant McDermott](https://github.com/uo-ec607/lectures),
[Jenny Bryan](https://stat545.com/join-cheatsheet.html),
&lt;!-- [Allison Horst](https://github.com/allisonhorst/stats-illustrations), --&gt;
[R4DS (2e)](https://r4ds.hadley.nz)

]


---

# Announcements

Reminders:
- Submit assignments via canvas
  - Lab-03 was due yesterday (Monday) at 11:59pm

Questions before we get started?

---

# Plan for this week

[Prologue](#prologue)

[Joins (Tuesday)](#joins)
  - [example-04-1](#example-04-1)

[Logic (Thursday)](#logic)
  - [example-04-2](#example-04-2)



---
class: inverse, center, middle
name: prologue

# Prologue

---

# What sports do we watch?

Take a guess: what's the most popular spectator sport among classmates?



--


```
##  [1] "football"   "basketball" "volleyball" "soccer"     NA          
##  [6] "baseball"   "football"   "basketball" "basketball" "football"  
## [11] "gymnastics" "gymnastics" "squash"     NA           "basketball"
## [16] "gymnastics" "tennis"     "baseball"   "basketball" "basketball"
## [21] NA           "soccer"     "basketball" "baseball"   "tennis"    
## [26] "polo"       "hockey"     "basketball" "gymnastics" "soccer"    
## [31] "tennis"     NA           "soccer"     "cricket"    "tennis"    
## [36] "tennis"     "badminton"  "football"   "football"
```

--

Let's `count` and `arrange` to get the top 3:


```
## # A tibble: 3 × 2
##   sport          n
##   &lt;chr&gt;      &lt;int&gt;
## 1 basketball     8
## 2 football       5
## 3 tennis         5
```

---

# R can be used for sports analytics, too!

.pull-left[
&lt;img src="img/04/stephen-curry.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="img/04/kobe-bryant.png" width="100%" style="display: block; margin: auto;" /&gt;
]

???
Source: https://github.com/toddwschneider/ballr


---
class: inverse, center, middle
name: joins

# Joins


---

# What are relational data?

--

Multiple tables of data with pairwise relations

Relations across &gt;2 data tables are determined by the relations between each pair

---

# Relational data example: `nycflights13`

&lt;img src="img/04/nycflights13-relational.png" width="75%" style="display: block; margin: auto;" /&gt;

---

# Relational data verbs from dplyr

1. **Mutating joins**: add new variables
  - `left_join()`
  - `right_join()`
  - `inner_join()`
  - `full_join()`

2. **Filtering joins**: filter observations
  - `semi_join()`
  - `anti_join()`


&lt;!-- --- --&gt;

&lt;!-- # How do join verbs work? --&gt;


&lt;!-- From Ivan Rudik's slides: --&gt;

&lt;!-- We need two datasets (e.g., housing prices and pollution) --&gt;

&lt;!-- Each dataset has the same set of **key** variables (e.g. county) --&gt;

&lt;!-- When we join, we match up the two datasets on the key, and combine them into one --&gt;

&lt;!-- In our housing example, each row of the joined dataset would now tell us the house price, the county it's in, and the county's pollution --&gt;

???

You can visualize the operations [here](https://r4ds.hadley.nz/joins.html)

---

# Joins

Let's learn these join commands using two small data frames



.pull-left[

```r
superheroes
```

```
## # A tibble: 7 × 3
##   name     alignment publisher        
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            
## 1 Magneto  bad       Marvel           
## 2 Storm    good      Marvel           
## 3 Mystique bad       Marvel           
## 4 Batman   good      DC               
## 5 Joker    bad       DC               
## 6 Catwoman bad       DC               
## 7 Hellboy  good      Dark Horse Comics
```
]

.pull-right[

```r
publishers
```

```
## # A tibble: 3 × 2
##   publisher year_founded
##   &lt;chr&gt;            &lt;int&gt;
## 1 DC                1934
## 2 Marvel            1939
## 3 Image             1992
```
]

???
Source: https://stat545.com/join-cheatsheet.html


---

# 1) dplyr::left_join(x, y)


```r
left_join(superheroes, publishers)
```

```
## Joining with `by = join_by(publisher)`
```

```
## # A tibble: 7 × 4
##   name     alignment publisher         year_founded
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;                    &lt;int&gt;
## 1 Magneto  bad       Marvel                    1939
## 2 Storm    good      Marvel                    1939
## 3 Mystique bad       Marvel                    1939
## 4 Batman   good      DC                        1934
## 5 Joker    bad       DC                        1934
## 6 Catwoman bad       DC                        1934
## 7 Hellboy  good      Dark Horse Comics           NA
```

`left_join` is a **mutating join**: it adds variables to `x`

`left_join` returns all rows from `x`

---

# 2) dplyr::right_join(x, y)


```r
right_join(superheroes, publishers)
```

```
## Joining with `by = join_by(publisher)`
```

```
## # A tibble: 7 × 4
##   name     alignment publisher year_founded
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            &lt;int&gt;
## 1 Magneto  bad       Marvel            1939
## 2 Storm    good      Marvel            1939
## 3 Mystique bad       Marvel            1939
## 4 Batman   good      DC                1934
## 5 Joker    bad       DC                1934
## 6 Catwoman bad       DC                1934
## 7 &lt;NA&gt;     &lt;NA&gt;      Image             1992
```

`right_join` is a **mutating join**: it adds variables to `y`

`right_join` returns all rows from `y`

---

# 3) dplyr::inner_join(x, y)


```r
inner_join(superheroes, publishers)
```

```
## Joining with `by = join_by(publisher)`
```

```
## # A tibble: 6 × 4
##   name     alignment publisher year_founded
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            &lt;int&gt;
## 1 Magneto  bad       Marvel            1939
## 2 Storm    good      Marvel            1939
## 3 Mystique bad       Marvel            1939
## 4 Batman   good      DC                1934
## 5 Joker    bad       DC                1934
## 6 Catwoman bad       DC                1934
```

How is `inner_join` different from `left_join` and `right_join`?

--

`inner_join` returns all rows in `x` **AND** `y`

---

# 4) dplyr::full_join(x, y)


```r
full_join(superheroes, publishers) # how many rows do you think this will produce?
```

--


```
## Joining with `by = join_by(publisher)`
```

```
## # A tibble: 8 × 4
##   name     alignment publisher         year_founded
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;                    &lt;int&gt;
## 1 Magneto  bad       Marvel                    1939
## 2 Storm    good      Marvel                    1939
## 3 Mystique bad       Marvel                    1939
## 4 Batman   good      DC                        1934
## 5 Joker    bad       DC                        1934
## 6 Catwoman bad       DC                        1934
## 7 Hellboy  good      Dark Horse Comics           NA
## 8 &lt;NA&gt;     &lt;NA&gt;      Image                     1992
```

`full_join` returns all rows in `x` **OR** `y`

---

# 5) dplyr::semi_join(x, y)

.pull-left[

```r
superheroes
```

```
## # A tibble: 7 × 3
##   name     alignment publisher        
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            
## 1 Magneto  bad       Marvel           
## 2 Storm    good      Marvel           
## 3 Mystique bad       Marvel           
## 4 Batman   good      DC               
## 5 Joker    bad       DC               
## 6 Catwoman bad       DC               
## 7 Hellboy  good      Dark Horse Comics
```
]

.pull-right[

```r
semi_join(superheroes, publishers)
```

```
## Joining with `by = join_by(publisher)`
```

```
## # A tibble: 6 × 3
##   name     alignment publisher
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Magneto  bad       Marvel   
## 2 Storm    good      Marvel   
## 3 Mystique bad       Marvel   
## 4 Batman   good      DC       
## 5 Joker    bad       DC       
## 6 Catwoman bad       DC
```
]

`semi_join` is a **filtering join**: it keeps observations in `x` that have a match in `y`

Note that the variables do not change

---

# 6) dplyr::anti_join(x, y)

.pull-left[

```r
superheroes
```

```
## # A tibble: 7 × 3
##   name     alignment publisher        
##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            
## 1 Magneto  bad       Marvel           
## 2 Storm    good      Marvel           
## 3 Mystique bad       Marvel           
## 4 Batman   good      DC               
## 5 Joker    bad       DC               
## 6 Catwoman bad       DC               
## 7 Hellboy  good      Dark Horse Comics
```
]

.pull-right[

```r
anti_join(superheroes, publishers)
```

```
## Joining with `by = join_by(publisher)`
```

```
## # A tibble: 1 × 3
##   name    alignment publisher        
##   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;            
## 1 Hellboy good      Dark Horse Comics
```
]

`anti_join` is a **filtering join**: it keeps obs. in `x` that **DO NOT** have a match in `y`

Note that the variables do not change


---

# Key variables

How do `dplyr` join commands know what variables to use as **keys**?

--

By default, `*_join()` uses all variables that are common across `x` and `y`

```r
intersect(names(superheroes), names(publishers)) # variable used for matching before
```

```
## [1] "publisher"
```

--

Or, we can specify what to join by: `*_join(..., by = join_by(publisher))`

.small[Note: before `dplyr` 1.1.0, the syntax was: `*_join(..., by = "publisher")`]

---

# Exploring keys


```r
library(nycflights13) # let's explore keys using the nycflights13 data
flights |&gt; print(n = 8) # print the first 8 rows of flights
```

```
## # A tibble: 336,776 × 19
##    year month   day dep_time sched_dep…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;       &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1  2013     1     1      517         515       2     830     819      11 UA     
## 2  2013     1     1      533         529       4     850     830      20 UA     
## 3  2013     1     1      542         540       2     923     850      33 AA     
## 4  2013     1     1      544         545      -1    1004    1022     -18 B6     
## 5  2013     1     1      554         600      -6     812     837     -25 DL     
## 6  2013     1     1      554         558      -4     740     728      12 UA     
## 7  2013     1     1      555         600      -5     913     854      19 B6     
## 8  2013     1     1      557         600      -3     709     723     -14 EV     
## # … with 336,768 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
## #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay
```

---

# Exploring keys


```r
planes # print the first 10 rows of planes
```

```
## # A tibble: 3,322 × 9
##    tailnum  year type                   manuf…¹ model engines seats speed engine
##    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;                  &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
##  1 N10156   2004 Fixed wing multi engi… EMBRAER EMB-…       2    55    NA Turbo…
##  2 N102UW   1998 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
##  3 N103US   1999 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
##  4 N104UW   1999 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
##  5 N10575   2002 Fixed wing multi engi… EMBRAER EMB-…       2    55    NA Turbo…
##  6 N105UW   1999 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
##  7 N107US   1999 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
##  8 N108UW   1999 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
##  9 N109UW   1999 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
## 10 N110UW   1999 Fixed wing multi engi… AIRBUS… A320…       2   182    NA Turbo…
## # … with 3,312 more rows, and abbreviated variable name ¹​manufacturer
```

---

# Let's perform a left join on flights and planes


```r
*left_join(flights, planes) |&gt;
  select(year:dep_time, arr_time, carrier:tailnum, type, model) |&gt; # keep text to one slide
  print(n = 5) # just to save vertical space on the slide
```

```
## Joining with `by = join_by(year, tailnum)`
```

```
## # A tibble: 336,776 × 10
##    year month   day dep_time arr_time carrier flight tailnum type  model
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1  2013     1     1      517      830 UA        1545 N14228  &lt;NA&gt;  &lt;NA&gt; 
## 2  2013     1     1      533      850 UA        1714 N24211  &lt;NA&gt;  &lt;NA&gt; 
## 3  2013     1     1      542      923 AA        1141 N619AA  &lt;NA&gt;  &lt;NA&gt; 
## 4  2013     1     1      544     1004 B6         725 N804JB  &lt;NA&gt;  &lt;NA&gt; 
## 5  2013     1     1      554      812 DL         461 N668DN  &lt;NA&gt;  &lt;NA&gt; 
## # … with 336,771 more rows
```

--

Uh-oh! What's up with `type` and `model`?

---

# Uh-oh!

As before, `dplyr` guessed which columns to join on

It uses columns with the same name:

```
*## Joining, by = c("year", "tailnum")
```

Does anyone see a potential problem here?

--

The variable `year` does not have a consistent meaning across the datasets

--

In `flights` it refers to the *year of flight*, in `planes` it refers to *year of construction*

--

Luckily we can avoid this by using the argument `by = join_by(...)`

---

# What should we join flights and planes by?

&lt;img src="img/04/nycflights13-relational.png" width="75%" style="display: block; margin: auto;" /&gt;

---

# Specifying join keys

We just need to be explicit in the join call by using the `by` argument


```r
left_join(flights,
          planes |&gt; rename(year_built = year), # not necessary w/ below line, but helpful
*         by = join_by(tailnum) # be specific about the joining column
          ) |&gt;
  select(year, month:dep_time, carrier, flight, tailnum, year_built, type, model) |&gt;
  print(n = 5) # just to save vertical space on the slide
```

```
## # A tibble: 336,776 × 10
##    year month   day dep_time carrier flight tailnum year_built type        model
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;
## 1  2013     1     1      517 UA        1545 N14228        1999 Fixed wing… 737-…
## 2  2013     1     1      533 UA        1714 N24211        1998 Fixed wing… 737-…
## 3  2013     1     1      542 AA        1141 N619AA        1990 Fixed wing… 757-…
## 4  2013     1     1      544 B6         725 N804JB        2012 Fixed wing… A320…
## 5  2013     1     1      554 DL         461 N668DN        1991 Fixed wing… 757-…
## # … with 336,771 more rows
```

---

# Specifying join keys

What happens if we don't rename `year` before this join?


```r
left_join(flights,
*         planes, # not renaming "year" to "year_built" this time
          by = join_by(tailnum)
          ) |&gt;
  select(contains("year"), month:dep_time, arr_time, carrier, flight, tailnum, type, model) |&gt;
  print(n = 4) # just to save vertical space on the slide
```

```
## # A tibble: 336,776 × 11
##   year.x year.y month   day dep_time arr_time carrier flight tailnum type  model
##    &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1   2013   1999     1     1      517      830 UA        1545 N14228  Fixe… 737-…
## 2   2013   1998     1     1      533      850 UA        1714 N24211  Fixe… 737-…
## 3   2013   1990     1     1      542      923 AA        1141 N619AA  Fixe… 757-…
## 4   2013   2012     1     1      544     1004 B6         725 N804JB  Fixe… A320…
## # … with 336,772 more rows
```

--

What is `year.x`? What is `year.y`?

---
class: inverse, center, middle
name: summary

# Summary of key verbs so far

---

# Key verbs

.pull-left-4[
### Import
#### readr
1. `read_csv`
2. `write_csv`

#### readxl
1. `read_excel`
]

.pull-midleft-4[
### Tidy
#### tidyr
1. `pivot_longer`
2. `pivot_wider`
3. `separate`
4. `unite`
]

.pull-midright-4[
### Join
#### dplyr
1. `left_join`
2. `right_join`
3. `inner_join`
4. `full_join`
5. `semi_join`
6. `anti_join`
]

.pull-right-4[
### Transform
#### dplyr
1. `filter`
2. `arrange`
3. `select`
4. `mutate`
5. `summarize`
]


---
class: center, middle
name: example-04-1

# [link to example-04-1](https://posit.cloud/spaces/328615/content/5413852)

---
class: inverse, center, middle
name: logic

# Logic


---

# Logic slides will be added for Thursday

See &lt;https://aem2850.toddgerarden.com/content/04-content/&gt; for the updated version of these slides

---
class: center, middle
name: example-04-2

# [link to example-04-2](https://posit.cloud/spaces/328615/content/5413858)

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%",
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
