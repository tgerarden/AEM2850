<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Basic base R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Todd Gerarden" />
    <script src="libs/header-attrs-2.20/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/tdg-slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">









class: center middle main-title section-title-4

# Basic base R

.class-info[

**Week 1.2**

AEM 2850 / 5850 : R for Business Analytics&lt;br&gt;
Cornell Dyson&lt;br&gt;
Spring 2023

Acknowledgements: 
&lt;!-- [Andrew Heiss](https://datavizm20.classes.andrewheiss.com),  --&gt;
&lt;!-- [Claus Wilke](https://wilkelab.org/SDS375/),  --&gt;
[Grant McDermott](https://github.com/uo-ec607/lectures)

]


---

# Plan for the rest of today

The plan for the rest of today is to introduce ourselves to **base** R

[Introduction to base R](#intro)

[Object-oriented programming in R](#oop)

["Everything is an object"](#eobject)

**Reference material** (cut for time):
  - ["Everything has a name"](#ename) (reserved words and namespace conflicts)
  - [Indexing](#indexing)
  - [Cleaning up](#cleaning)


---
class: inverse, center, middle
name: intro

# Introduction to base R

(Some of this is just for reference, since we covered it in example-01)

---

# Basic arithmetic

R is a powerful calculator and recognizes all of the standard arithmetic operators:


```r
1+2 # add / subtraction
```

```
## [1] 3
```

```r
5/2 # divide
```

```
## [1] 2.5
```

```r
2^3 # exponentiate
```

```
## [1] 8
```

```r
2+4*1^3 # standard order of precedence (`*` before `+`, etc.)
```

```
## [1] 6
```

---

# Logic

R also comes equipped with a full set of logical operators and Booleans


```r
1 &gt; 2
```

```
## [1] FALSE
```

```r
(1 &gt; 2) &amp; (1 &gt; 0.5) # "&amp;" is the "and" operator
```

```
## [1] FALSE
```

```r
(1 &gt; 2) | (1 &gt; 0.5) # "|" is the "or" operator
```

```
## [1] TRUE
```

---

# Logic

We can negate expressions with: `!`

This is helpful for filtering data


```r
is.na(1:10)
```

```
##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
```

```r
!is.na(1:10)
```

```
##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
```

`NA` means **not available** (i.e., missing)

---

# Logic

For value matching we can use: `%in%`

To see whether an object is contained in a list of items, use `%in%`:

```r
1:10
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10
```

```r
4 %in% 1:10
```

```
## [1] TRUE
```

```r
4 %in% 5:10
```

```
## [1] FALSE
```

---

# Logic

To evaluate whether two expressions are equal, we need to use **two** equal signs


```r
1 = 1 # This doesn't work
```

```
## Error in 1 = 1: invalid (do_set) left-hand side to assignment
```

```r
1 == 1 # This does.
```

```
## [1] TRUE
```

```r
1 != 2 # Note the single equal sign when combined with a negation.
```

```
## [1] TRUE
```

---

# Logic

**Evaluation caveat:** What will happen if we evaluate `0.1 + 0.2 == 0.3`?

--


```r
0.1 + 0.2 == 0.3
```

```
## [1] FALSE
```
&lt;!-- Uh-oh! What went wrong here? --&gt;

--

**Problem:** Computers represent numbers as binary (i.e., base 2) floating-points
- Fast and memory efficient, but can lead to unexpected behavior
- Similar to how decimals can't capture some fractions (e.g., `\(\frac{1}{3} = 0.3333...\)`)

--

**Solution:** Use `all.equal()` for evaluating floats (i.e., fractions)


```r
all.equal(0.1 + 0.2, 0.3)
```

```
## [1] TRUE
```

???
More details [here](https://floating-point-gui.de/basic/)

---

# Assignment

In R, we can use either `&lt;-` or `=` to handle assignment

--

### Assignment with `&lt;-`

`&lt;-` is normally read aloud as "gets". You can think of it as a (left-facing) arrow saying *assign in this direction*.


```r
a &lt;- 10 + 5
a
```

```
## [1] 15
```

---

# Assignment with `=`

You can also use `=` for assignment.


```r
b = 10 + 10
b
```

```
## [1] 20
```

--

### Which assignment operator should you use?

Most R users prefer `&lt;-`, inserted using the keyboard shortcut Alt/Option + -

&lt;!-- , since `=` also has specific role for evaluation *within* functions --&gt;

It doesn't really matter for our purposes, other languages use `=`

**Bottom line:** Use whichever you prefer, just be consistent

---

# Help

For more information on a (named) function or object in R, consult the "help" documentation using `?`

For example:

```R
?plot 
```

---

# Vignettes

For some packages, `vignette()` will provide a detailed intro


```r
# Try this:
vignette("dplyr")
```

Vignettes are a great way to learn how and when to use a package

---

# Comments


Comments in R code are demarcated by `#`

Use comments to document your logic in `.R` scripts and within `.Rmd` code chunks


```r
# THIS IS A CODE SECTION ----
# this is a comment
winter &lt;- "ski season" # iykyk
```

--

Comments should be concise (unlike above)

--

Using at least four trailing dashes (`----`) creates a code section, which simplifies navigation and code folding
&lt;!-- - Also works with trailing equals (`====`) or pound signs (`====`) --&gt;

--

**Keyboard shortcut:** use `Ctrl/Cmd+Shift+c` in RStudio to (un)comment whole sections of highlighted code


---
class: inverse, center, middle
name: oop

# Object-oriented programming in R



---

# Object-oriented programming

In R:

&gt; **"Everything is an object and everything has a name."**


---
class: inverse, center, middle
name: eobject

# "Everything is an object"


---

# What are objects? 

There are many different *types* (or *classes*) of objects

Here are some objects that we'll be working with regularly:
- vectors
- matrices
- data frames
- lists
- functions


---

# Data frames

The most important object we will be working with is the **data frame**

You can think of it basically as an Excel spreadsheet


```r
# Create a small data frame called "d"
d &lt;- data.frame(x = 1:2, y = 3:4) 
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

--

This is essentially just a table with columns named `x` and `y`

--

Each row is an observation telling us the values of both `x` and `y`

---

# Aside: built-in data frames

Base R and packages have built-in data frames with special names you can call on

As you may recall, we just used `cars`:

.pull-left[

```r
head(cars)
```

```
##   speed dist
## 1     4    2
## 2     4   10
## 3     7    4
## 4     7   22
## 5     8   16
## 6     9   10
```
]

.pull-right[

```r
plot(cars)
```

&lt;img src="01-2-slides_files/figure-html/plot-cars-1.png" width="360" style="display: block; margin: auto;" /&gt;
]



---

# Back to objects

Each object class has its own set of rules for determining valid operations


```r
d &lt;- data.frame(x = 1:2, y = 3:4) # create a small data frame called "d"
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

--

At the same time, you can (usually) convert an object from one type to another


```r
mat &lt;- as.matrix(d) # convert it to (i.e., create) a matrix call "mat"
mat
```

```
##      x y
## [1,] 1 3
## [2,] 2 4
```

---

# Working with multiple objects

In R we can have multiple data frames in memory at once

Even though we just made `mat`, `d` still exists:


```r
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

---

# Ways to learn about objects

Printing an object directly in the console is often handy

--

`View()` is very helpful, and has the same effect as clicking on the object in your RStudio *Environment* pane

--

Use the `str` command to learn about an object's **str**ucture


```r
# d &lt;- data.frame(x = 1:2, y = 3:4) # Create a small data frame called "d"
str(d) # Evaluate its structure
```

```
## 'data.frame':	2 obs. of  2 variables:
##  $ x: int  1 2
##  $ y: int  3 4
```

--

You can also use `class` to get an object's class without all the other details


---
name: global_env

# Global environment

Let's go back to the simple data frame that we created a few slides earlier.

```r
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

--

Now, let's try to do a logical comparison of these "x" and "y" variables:


```r
x &lt; y
```

```
## Error in eval(expr, envir, enclos): object 'x' not found
```

--

Uh-oh. What went wrong here?

---

# Global environment

The error message provides the answer to our question:

```
*## Error in eval(predvars, data, env): object 'x' not found
```

--

R looked in our *Global Environment* and couldn't find `x`

&lt;img src="img/02/environment.png" width="65%" style="display: block; margin: auto;" /&gt;


&lt;!-- &lt;figure&gt; --&gt;
&lt;!--   &lt;img src="img/02/environment.png" alt="environment" title="environment" width="75%"&gt; --&gt;
&lt;!-- &lt;/figure&gt; --&gt;

--

We have to tell R that `x` and `y` belong to the object `d`

We will come back to this


---
class: inverse, center, middle

# Reference material

(We don't have time for the rest of this today)

---
class: inverse, center, middle
name: ename

# "Everything has a name"



---

# Reserved words

R has a bunch of key/reserved words that serve specific functions
- You can't (re)assign these, even if you wanted to

See [here](http://stat.ethz.ch/R-manual/R-devel/library/base/html/Reserved.html) for a full list, including (but not limited to):

```R
if 
else 
while # looping
function 
for # looping
TRUE 
FALSE 
NULL # null/undefined
Inf #infinity
NaN # not a number
NA # not available / missing
```

---

# Semi-reserved words

There are other words that are sort of reserved, in that they have a particular meaning
- These are named functions or constants (e.g., `pi`) that you can re-assign if you really want to... but that already come with important meanings from base R

The most important example is `c()`, which binds and concatenates objects together


```r
my_vector &lt;- c(1, 2, 5)
my_vector
```

```
## [1] 1 2 5
```

--

What do you think will happen if you type the following?


```r
c &lt;- 4
c(1, 2 ,5)
```

--


```
## [1] 1 2 5
```

--

In this case, R is "smart" enough to distinguish between the variable `c` and the built-in function `c()`

---

# Semi-reserved words (cont.)

But R won't always be able to distinguish between conflicting definitions! For example:

```r
pi
```

```
## [1] 3.141593
```

```r
pi &lt;- 2
pi
```

```
## [1] 2
```
--

**Bottom line:** Don't use (semi-)reserved words!

---

# Namespace conflicts

Try loading the `dplyr` package in RStudio

```r
library(dplyr)
```

What warning gets reported?

    The following objects are masked from ‘package:stats’:

        filter, lag

    The following objects are masked from ‘package:base’:

        intersect, setdiff, setequal, union

--

The warning *masked from 'package:X'* is about a **namespace conflict**

???

Here, both `dplyr` and the `stats` package (which gets loaded automatically when you start R) have functions named `filter` and `lag`

---

# Namespace conflicts

Whenever a namespace conflict arises, the most recently loaded package will gain preference

The `filter()` function now refers specifically to the `dplyr` variant

--

What if we want the `stats` variant?
1. Use `stats::filter()`
2. Assign `filter &lt;- stats::filter`

---

# Solving namespace conflicts

### 1. Use `package::function()`

Explicitly call a conflicted function from a package using the `package::function()` syntax

--

We can also use `::` to clarify the source of a function or dataset in our code


```r
dplyr::starwars # Print the starwars data frame from the dplyr package
scales::comma(c(1000, 1000000)) # Use the comma function, which comes from the scales package
```

--

The `::` syntax also allows us to call functions without loading the package (as long as it is installed)
  
---

# Solving namespace conflicts

### 2. Assign `function &lt;- package::function`
  
A more permanent option is to assign a conflicted function name to a particular package

```r
filter &lt;- stats::filter # Note the lack of parentheses
filter &lt;- dplyr::filter # Change it back again
```

???

### General advice

I would generally advocate for the temporary `package::function()` solution. 

Another good rule of thumb is that you want to load your most important packages last. (e.g., Load the tidyverse after you've already loaded any other packages.)
  
Other than that, simply pay attention to any warnings when loading a new package and `?` is your friend if you're ever unsure. (e.g., `?filter` will tell you which variant is being used.)
- In truth, problematic namespace conflicts are rare. But it's good to be aware of them. 


---

# User-side namespace conflicts

Namespace conflicts don't just arise from loading packages

Users like you and me can (and probably will!) create them through assignment


---
class: inverse, center, middle
name: indexing

# Indexing


  
---

# Indexing

How do we index in R?

--

We've already seen an example of indexing in the form of R console output:


```r
1+2
```

```
## [1] 3
```

The `[1]` above denotes the ﬁrst (and, in this case, only) element of our output

--

In this case, a vector of length one equal to the value "3"

---

# Indexing

Try the following in your console to see a more explicit example of indexed output:


```r
rnorm(n = 50, mean = 0, sd = 1) # take 50 draws from the standard normal distribution
```

```
##  [1]  0.71146763  0.95047192  0.42910637 -1.16327940  0.86852460 -0.43855960
##  [7] -1.22934924  1.67758956 -0.44815704  0.72756612  2.31834286 -0.22489278
## [13] -1.35056754  0.63679734 -0.25460548 -1.79721522  0.84120702  0.37784620
## [19] -0.69498619  0.46194829 -0.91979853 -0.13288374  0.83393184  0.49146497
## [25] -0.40016223 -1.00656892  0.67314222 -0.98243447  1.47718789  0.06028536
## [31] -0.83974201  1.42050640 -0.10785130 -0.39009916  0.12250144 -0.20159295
## [37] -0.51971684  1.47406677  2.42377749  0.13206770 -0.18421338 -0.61879287
## [43]  0.95696217  0.06142347 -0.19287274 -1.32181660  2.56245705 -1.13661277
## [49] -0.70635898  0.93332769
```


---

# Option 1: [ ]

We can use `[]` to index objects that we create in R

```r
a = 1:10
a[4] ## Get the 4th element of object "a"
```

```
## [1] 4
```

```r
a[c(4, 6)] ## Get the 4th and 6th elements
```

```
## [1] 4 6
```

---

# Option 1: [ ]

This also works on larger arrays (vectors, matrices, data frames, and lists)

```r
starwars &lt;- dplyr::starwars # assign for convenience
starwars[1, 1] ## Show the cell corresponding to the 1st row &amp; 1st column of the data frame.
```

```
## # A tibble: 1 × 1
##   name          
##   &lt;chr&gt;         
## 1 Luke Skywalker
```

--

What does `starwars[1:3, 1]` give you?

--


```
## # A tibble: 3 × 1
##   name          
##   &lt;chr&gt;         
## 1 Luke Skywalker
## 2 C-3PO         
## 3 R2-D2
```


---

# Option 1: [ ]

We haven't discussed them yet, but **lists** are a more complex type of array object in R

--

They can contain a collection of objects that don't share the same structure

--

For example, you can have lists containing:

- a scalar, a string, and a data frame
- a list of data frames
- a list of lists

---

# Option 1: [ ]

The relevance to indexing is that lists require two square brackets `[[]]` to index the parent list item and then the standard `[]` within that parent item. An example might help to illustrate:

```r
my_list &lt;- list(
  a = "hello", 
  b = c(1,2,3), 
  c = data.frame(x = 1:5, y = 6:10))
my_list[[1]] # Return the 1st list object
```

```
## [1] "hello"
```

```r
my_list[[2]][3] # Return the 3rd element of the 2nd list object
```

```
## [1] 3
```

---

# Option 2: $


Lists provide a nice segue to our other indexing operator: `$`
- Let's continue with the `my_list` example from the previous slide.


```r
my_list
```

```
## $a
## [1] "hello"
## 
## $b
## [1] 1 2 3
## 
## $c
##   x  y
## 1 1  6
## 2 2  7
## 3 3  8
## 4 4  9
## 5 5 10
```

---
count: false

# Option 2: $


Lists provide a nice segue to our other indexing operator: `$`.
- Let's continue with the `my_list` example from the previous slide


```r
my_list
```

```
*## $a
## [1] "hello"
## 
*## $b
## [1] 1 2 3
## 
*## $c
##   x  y
## 1 1  6
## 2 2  7
## 3 3  8
## 4 4  9
## 5 5 10
```

Notice how our (named) parent list objects are demarcated: `$a`,`$b` and `$c`

---

# Option 2: $

We can call these objects directly by name using the dollar sign, e.g.

```r
my_list$a ## Return list object "a"
```

```
## [1] "hello"
```

```r
my_list$b[3] ## Return the 3rd element of list object "b" 
```

```
## [1] 3
```

```r
my_list$c$x ## Return column "x" of list object "c"
```

```
## [1] 1 2 3 4 5
```

???

**Aside:** Typing `View(my_list)` (or, equivalently, clicking on the object in RStudio's environment pane) provides a nice interactive window for exploring the nested structure of lists.

---

# Option 2: $

The `$` form of indexing also works for other object types

In some cases, you can also combine the two index options:

```r
starwars$name[1]
```

```
## [1] "Luke Skywalker"
```

???

Note some key differences between the output from this example and that of our previous `starwars[1, 1]` example. What are they?
- Hint: Apart from the visual cues, try wrapping each command in `str()`.

---

# Option 2: $

Finally, `$` provides another way to avoid the "object not found" problem that we ran into earlier


```r
x &lt; y # Doesn't work
```

```
## Error in eval(expr, envir, enclos): object 'x' not found
```

```r
d$x &lt; d$y # Works!
```

```
## [1] TRUE TRUE
```

---
class: inverse, center, middle
name: cleaning

# Cleaning up



---

# Removing objects

Use `rm()` to remove an object or objects from your working environment

```r
a &lt;- "hello"
b &lt;- "world"
rm(a, b)
```

You can use `rm(list = ls())` to remove all objects in your working environment, though this is [frowned upon](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/)
- Better just to start a new R session

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%",
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
