<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Welcome to the tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Todd Gerarden" />
    <script src="libs/header-attrs-2.25/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/tdg-slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">











class: center middle main-title section-title-4

# Welcome to the tidyverse

.class-info[

**Week 2**

AEM 2850 / 5850 : R for Business Analytics&lt;br&gt;
Cornell Dyson&lt;br&gt;
Spring 2024

Acknowledgements: 
&lt;!-- [Andrew Heiss](https://datavizm20.classes.andrewheiss.com),  --&gt;
&lt;!-- [Claus Wilke](https://wilkelab.org/SDS375/),  --&gt;
[Grant McDermott](https://github.com/uo-ec607/lectures),
[Allison Horst](https://github.com/allisonhorst/stats-illustrations)

]


---

# Announcements

If you are new to the class, please review canvas and [course site](https://aem2850.toddgerarden.com)

**Prelim dates:** Feb 29 and May 7 in class
&lt;!-- - SDS: we will use the Alternative Testing Program, submit form by Feb. 8 --&gt;

**Other reminders:**
- Bookmark [the schedule](https://aem2850.toddgerarden.com/schedule) and visit often
- Submit assignments via canvas by Monday at 11:59pm going forward

---

# Office hours update

**TA office hours:**
- Mondays 1:30pm - 3:30pm in Warren 370
- Mondays 3:30pm - 5:00pm in Warren 167
- Fridays 2:30pm - 3:30pm in Warren B50


**My office hours:** Tuesdays 11:30 - 12:30 in Warren 464; [aem2850.youcanbook.me](https://aem2850.youcanbook.me)
- Caveat: I cannot hold office hours today

---

# Questions before we get started?

---

# Plan for today

[Prologue](#prologue)

[Tidyverse basics](#basics)
  - [tibbles](#tibbles) and [pipes](#pipes)

[Data transformation with dplyr](#dplyr)
  - [select](#select)
  - [filter](#filter)
  - [arrange](#arrange)
  - [mutate](#mutate)
  - [summarize](#summarize)
  - [other goodies](#goodies)


---
class: inverse, center, middle
name: prologue

# Prologue


---

# How we feel about the course, in a few words

&lt;!-- I haven't read all the surveys yet, but here are some common phrases that came up: --&gt;

&gt; excited

&lt;br&gt;

&gt; feeling great

&lt;br&gt;

--

&gt; nervous but looking forward to it

&lt;br&gt;

---

# Where we're from



How can we use your 88 survey responses to construct our origin story without having to read them one by one?

--

- **Caveat:** This is based on submissions as of 16:26 Tuesday

--

We can use R for this!

--

I won't go through details now

&lt;!-- I won't go through details now, but here is one way to approach it: --&gt;

&lt;!-- - use `readr` function `read_csv()` to import data from csv file --&gt;
&lt;!-- - use `dplyr` functions to manipulate data --&gt;
&lt;!-- - make maps using `ggplot2` --&gt;

By the end of the course you should be able to do this kind of thing easily


---

# Are we all from New York?

What share of us are from the state of New York?

--


```r
# step 1: do a bunch of stuff that's omitted for clarity
# step 2: show us the answer!
ny_share
```

```
## # A tibble: 1 Ã— 2
##   origin   percent
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 new york    18.0
```

---

# Are we all from New York?


&lt;img src="02-slides_files/figure-html/us-map-1.png" width="1008" style="display: block; margin: auto;" /&gt;


---

# Are we all from the U.S.?


&lt;img src="02-slides_files/figure-html/world-map-1.png" width="1008" style="display: block; margin: auto;" /&gt;


---
class: inverse, center, middle
name: basics

# Tidyverse basics

---

# R "dialects"

Last week we *briefly* introduced several R programming concepts:
  - logical expressions
  - assignment
  - object types
  - [object names, namespace conflicts]
  - [indexing]

We did this using base R
  - **pro:** comes in the box, close parallels to other programming languages
  - **con:** can be confusing for new programmers (esp. indexing operations)

---

# R "dialects"

.more-left[
This course will primarily use the tidyverse

You can think of it as a particular "dialect" of R

This dialect is similar to human language

Intuitive if you're new to programming

Not representative of all R programming

Base R and `data.table` are alternative "dialects"
]

.less-right[
&lt;img src="img/02/r_first_then.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

# Tidyverse vs. base R

Lots of debate over tidyverse vs. base R

--

Why we're using the tidyverse:
- Consistent philosophy and syntax
- Great documentation and community support
- For data wrangling and plotting, tidyverse is ðŸ”¥

--

&lt;br&gt;

Base R is still great, can do some things tidyverse can't

**data.table** is another great alternative for data wrangling

---

# Tidyverse vs. base R

Often a correspondence between tidyverse and base R commands:

| tidyverse  |  base |
|---|---|
| `?readr::read_csv`  | `?utils::read.csv` |
|  `?dplyr::if_else` |  `?base::ifelse` |
|  `?tibble::tibble` |  `?base::data.frame` |

Tidyverse alternatives typically offer extra features

--

**Remember:** There are always multiple ways to do something in R

---

# Let's load the tidyverse meta-package




```r
library(tidyverse)
```

--


```
## â”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€
## âœ” dplyr     1.1.4     âœ” readr     2.1.5
## âœ” forcats   1.0.0     âœ” stringr   1.5.1
## âœ” ggplot2   3.4.4     âœ” tibble    3.2.1
## âœ” lubridate 1.9.3     âœ” tidyr     1.3.0
## âœ” purrr     1.0.2     
## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## âœ– dplyr::filter() masks stats::filter()
## âœ– dplyr::lag()    masks stats::lag()
## â„¹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
```

--

We just loaded a bunch of packages: **ggplot2**, **dplyr**, **tidyr**, **tibble**, etc.

We also see some **namespace conflicts**

---

# Tidyverse packages

When you install the tidyverse, you actually get a lot more packages:

```r
tidyverse_packages()
```

```
##  [1] "broom"         "conflicted"    "cli"           "dbplyr"       
##  [5] "dplyr"         "dtplyr"        "forcats"       "ggplot2"      
##  [9] "googledrive"   "googlesheets4" "haven"         "hms"          
## [13] "httr"          "jsonlite"      "lubridate"     "magrittr"     
## [17] "modelr"        "pillar"        "purrr"         "ragg"         
## [21] "readr"         "readxl"        "reprex"        "rlang"        
## [25] "rstudioapi"    "rvest"         "stringr"       "tibble"       
## [29] "tidyr"         "xml2"          "tidyverse"
```

--

These other packages have to be loaded separately

---

# Tidyverse packages

Today we'll focus on [**dplyr**](https://dplyr.tidyverse.org/)

But first let's talk about tibbles and pipes


---
name: tibbles

# Review: What are objects? 

There are many different *types* (or *classes*) of objects

Here are some objects that we'll be working with regularly:
- vectors
- matrices
- data frames
- lists
- functions


---

# Data frames

The most important object we'll work with is the **data frame**

You can think of it as an Excel spreadsheet


```r
# Create a small data frame called "d"
d &lt;- data.frame(x = 1:2, y = 3:4) 
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

This is essentially just a table with columns named `x` and `y`

Each row is an observation telling us the values of both `x` and `y`

---

# Tibbles are data frames with opinions

For this class you can think of tibbles and data frames as synonymous

Tibbles have some advantages, such as pretty printing

--

We will primarily use tibbles in this course

Two functions may come in handy:
- `as_tibble()` converts data frames to tibbles
- `tibble()` creates new tibbles from scratch

See `vignette("tibble")` for more

---

# Printing a data.frame


```r
as.data.frame(starwars)
```

```
##                     name height   mass    hair_color          skin_color
## 1         Luke Skywalker    172   77.0         blond                fair
## 2                  C-3PO    167   75.0          &lt;NA&gt;                gold
## 3                  R2-D2     96   32.0          &lt;NA&gt;         white, blue
## 4            Darth Vader    202  136.0          none               white
## 5            Leia Organa    150   49.0         brown               light
## 6              Owen Lars    178  120.0   brown, grey               light
## 7     Beru Whitesun Lars    165   75.0         brown               light
## 8                  R5-D4     97   32.0          &lt;NA&gt;          white, red
## 9      Biggs Darklighter    183   84.0         black               light
## 10        Obi-Wan Kenobi    182   77.0 auburn, white                fair
## 11      Anakin Skywalker    188   84.0         blond                fair
## 12        Wilhuff Tarkin    180     NA  auburn, grey                fair
## 13             Chewbacca    228  112.0         brown             unknown
## 14              Han Solo    180   80.0         brown                fair
## 15                Greedo    173   74.0          &lt;NA&gt;               green
## 16 Jabba Desilijic Tiure    175 1358.0          &lt;NA&gt;    green-tan, brown
## 17        Wedge Antilles    170   77.0         brown                fair
## 18      Jek Tono Porkins    180  110.0         brown                fair
## 19                  Yoda     66   17.0         white               green
## 20             Palpatine    170   75.0          grey                pale
## 21             Boba Fett    183   78.2         black                fair
## 22                 IG-88    200  140.0          none               metal
## 23                 Bossk    190  113.0          none               green
## 24      Lando Calrissian    177   79.0         black                dark
## 25                 Lobot    175   79.0          none               light
## 26                Ackbar    180   83.0          none        brown mottle
## 27            Mon Mothma    150     NA        auburn                fair
## 28          Arvel Crynyd     NA     NA         brown                fair
## 29 Wicket Systri Warrick     88   20.0         brown               brown
## 30             Nien Nunb    160   68.0          none                grey
## 31          Qui-Gon Jinn    193   89.0         brown                fair
## 32           Nute Gunray    191   90.0          none       mottled green
## 33         Finis Valorum    170     NA         blond                fair
## 34         PadmÃ© Amidala    185   45.0         brown               light
## 35         Jar Jar Binks    196   66.0          none              orange
## 36          Roos Tarpals    224   82.0          none                grey
## 37            Rugor Nass    206     NA          none               green
## 38              Ric OliÃ©    183     NA         brown                fair
## 39                 Watto    137     NA         black          blue, grey
## 40               Sebulba    112   40.0          none           grey, red
## 41         Quarsh Panaka    183     NA         black                dark
## 42        Shmi Skywalker    163     NA         black                fair
## 43            Darth Maul    175   80.0          none                 red
## 44           Bib Fortuna    180     NA          none                pale
## 45           Ayla Secura    178   55.0          none                blue
## 46          Ratts Tyerel     79   15.0          none          grey, blue
## 47              Dud Bolt     94   45.0          none          blue, grey
## 48               Gasgano    122     NA          none         white, blue
## 49        Ben Quadinaros    163   65.0          none grey, green, yellow
## 50            Mace Windu    188   84.0          none                dark
## 51          Ki-Adi-Mundi    198   82.0         white                pale
## 52             Kit Fisto    196   87.0          none               green
## 53             Eeth Koth    171     NA         black               brown
## 54            Adi Gallia    184   50.0          none                dark
## 55           Saesee Tiin    188     NA          none                pale
## 56           Yarael Poof    264     NA          none               white
## 57              Plo Koon    188   80.0          none              orange
## 58            Mas Amedda    196     NA          none                blue
## 59          Gregar Typho    185   85.0         black                dark
## 60                 CordÃ©    157     NA         brown               light
## 61           Cliegg Lars    183     NA         brown                fair
## 62     Poggle the Lesser    183   80.0          none               green
## 63       Luminara Unduli    170   56.2         black              yellow
## 64         Barriss Offee    166   50.0         black              yellow
## 65                 DormÃ©    165     NA         brown               light
## 66                 Dooku    193   80.0         white                fair
## 67   Bail Prestor Organa    191     NA         black                 tan
## 68            Jango Fett    183   79.0         black                 tan
## 69            Zam Wesell    168   55.0        blonde fair, green, yellow
## 70       Dexter Jettster    198  102.0          none               brown
## 71               Lama Su    229   88.0          none                grey
## 72               Taun We    213     NA          none                grey
## 73            Jocasta Nu    167     NA         white                fair
## 74                R4-P17     96     NA          none         silver, red
## 75            Wat Tambor    193   48.0          none         green, grey
## 76              San Hill    191     NA          none                grey
## 77              Shaak Ti    178   57.0          none    red, blue, white
## 78              Grievous    216  159.0          none        brown, white
## 79               Tarfful    234  136.0         brown               brown
## 80       Raymus Antilles    188   79.0         brown               light
## 81             Sly Moore    178   48.0          none                pale
## 82            Tion Medon    206   80.0          none                grey
## 83                  Finn     NA     NA         black                dark
## 84                   Rey     NA     NA         brown               light
## 85           Poe Dameron     NA     NA         brown               light
## 86                   BB8     NA     NA          none                none
## 87        Captain Phasma     NA     NA          none                none
##        eye_color birth_year            sex    gender      homeworld
## 1           blue       19.0           male masculine       Tatooine
## 2         yellow      112.0           none masculine       Tatooine
## 3            red       33.0           none masculine          Naboo
## 4         yellow       41.9           male masculine       Tatooine
## 5          brown       19.0         female  feminine       Alderaan
## 6           blue       52.0           male masculine       Tatooine
## 7           blue       47.0         female  feminine       Tatooine
## 8            red         NA           none masculine       Tatooine
## 9          brown       24.0           male masculine       Tatooine
## 10     blue-gray       57.0           male masculine        Stewjon
## 11          blue       41.9           male masculine       Tatooine
## 12          blue       64.0           male masculine         Eriadu
## 13          blue      200.0           male masculine       Kashyyyk
## 14         brown       29.0           male masculine       Corellia
## 15         black       44.0           male masculine          Rodia
## 16        orange      600.0 hermaphroditic masculine      Nal Hutta
## 17         hazel       21.0           male masculine       Corellia
## 18          blue         NA           &lt;NA&gt;      &lt;NA&gt;     Bestine IV
## 19         brown      896.0           male masculine           &lt;NA&gt;
## 20        yellow       82.0           male masculine          Naboo
## 21         brown       31.5           male masculine         Kamino
## 22           red       15.0           none masculine           &lt;NA&gt;
## 23           red       53.0           male masculine      Trandosha
## 24         brown       31.0           male masculine        Socorro
## 25          blue       37.0           male masculine         Bespin
## 26        orange       41.0           male masculine       Mon Cala
## 27          blue       48.0         female  feminine      Chandrila
## 28         brown         NA           male masculine           &lt;NA&gt;
## 29         brown        8.0           male masculine          Endor
## 30         black         NA           male masculine        Sullust
## 31          blue       92.0           male masculine           &lt;NA&gt;
## 32           red         NA           male masculine Cato Neimoidia
## 33          blue       91.0           male masculine      Coruscant
## 34         brown       46.0         female  feminine          Naboo
## 35        orange       52.0           male masculine          Naboo
## 36        orange         NA           male masculine          Naboo
## 37        orange         NA           male masculine          Naboo
## 38          blue         NA           male masculine          Naboo
## 39        yellow         NA           male masculine       Toydaria
## 40        orange         NA           male masculine      Malastare
## 41         brown       62.0           male masculine          Naboo
## 42         brown       72.0         female  feminine       Tatooine
## 43        yellow       54.0           male masculine       Dathomir
## 44          pink         NA           male masculine         Ryloth
## 45         hazel       48.0         female  feminine         Ryloth
## 46       unknown         NA           male masculine    Aleen Minor
## 47        yellow         NA           male masculine        Vulpter
## 48         black         NA           male masculine        Troiken
## 49        orange         NA           male masculine           Tund
## 50         brown       72.0           male masculine     Haruun Kal
## 51        yellow       92.0           male masculine          Cerea
## 52         black         NA           male masculine    Glee Anselm
## 53         brown         NA           male masculine       Iridonia
## 54          blue         NA         female  feminine      Coruscant
## 55        orange         NA           male masculine        Iktotch
## 56        yellow         NA           male masculine        Quermia
## 57         black       22.0           male masculine          Dorin
## 58          blue         NA           male masculine       Champala
## 59         brown         NA           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 60         brown         NA           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 61          blue       82.0           male masculine       Tatooine
## 62        yellow         NA           male masculine       Geonosis
## 63          blue       58.0         female  feminine         Mirial
## 64          blue       40.0         female  feminine         Mirial
## 65         brown         NA         female  feminine          Naboo
## 66         brown      102.0           male masculine        Serenno
## 67         brown       67.0           male masculine       Alderaan
## 68         brown       66.0           male masculine   Concord Dawn
## 69        yellow         NA         female  feminine          Zolan
## 70        yellow         NA           male masculine           Ojom
## 71         black         NA           male masculine         Kamino
## 72         black         NA         female  feminine         Kamino
## 73          blue         NA         female  feminine      Coruscant
## 74     red, blue         NA           none  feminine           &lt;NA&gt;
## 75       unknown         NA           male masculine          Skako
## 76          gold         NA           male masculine     Muunilinst
## 77         black         NA         female  feminine          Shili
## 78 green, yellow         NA           male masculine          Kalee
## 79          blue         NA           male masculine       Kashyyyk
## 80         brown         NA           male masculine       Alderaan
## 81         white         NA           &lt;NA&gt;      &lt;NA&gt;         Umbara
## 82         black         NA           male masculine         Utapau
## 83          dark         NA           male masculine           &lt;NA&gt;
## 84         hazel         NA         female  feminine           &lt;NA&gt;
## 85         brown         NA           male masculine           &lt;NA&gt;
## 86         black         NA           none masculine           &lt;NA&gt;
## 87       unknown         NA         female  feminine           &lt;NA&gt;
##           species
## 1           Human
## 2           Droid
## 3           Droid
## 4           Human
## 5           Human
## 6           Human
## 7           Human
## 8           Droid
## 9           Human
## 10          Human
## 11          Human
## 12          Human
## 13        Wookiee
## 14          Human
## 15         Rodian
## 16           Hutt
## 17          Human
## 18           &lt;NA&gt;
## 19 Yoda's species
## 20          Human
## 21          Human
## 22          Droid
## 23     Trandoshan
## 24          Human
## 25          Human
## 26   Mon Calamari
## 27          Human
## 28          Human
## 29           Ewok
## 30      Sullustan
## 31          Human
## 32      Neimodian
## 33          Human
## 34          Human
## 35         Gungan
## 36         Gungan
## 37         Gungan
## 38          Human
## 39      Toydarian
## 40            Dug
## 41          Human
## 42          Human
## 43         Zabrak
## 44        Twi'lek
## 45        Twi'lek
## 46         Aleena
## 47     Vulptereen
## 48          Xexto
## 49          Toong
## 50          Human
## 51         Cerean
## 52       Nautolan
## 53         Zabrak
## 54     Tholothian
## 55       Iktotchi
## 56       Quermian
## 57        Kel Dor
## 58       Chagrian
## 59           &lt;NA&gt;
## 60           &lt;NA&gt;
## 61          Human
## 62      Geonosian
## 63       Mirialan
## 64       Mirialan
## 65          Human
## 66          Human
## 67          Human
## 68          Human
## 69       Clawdite
## 70       Besalisk
## 71       Kaminoan
## 72       Kaminoan
## 73          Human
## 74          Droid
## 75        Skakoan
## 76           Muun
## 77        Togruta
## 78        Kaleesh
## 79        Wookiee
## 80          Human
## 81           &lt;NA&gt;
## 82         Pau'an
## 83          Human
## 84          Human
## 85          Human
## 86          Droid
## 87          Human
##                                                                                                                                        films
## 1                                            A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 2                     A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 3  A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith, The Force Awakens
## 4                                                               A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith
## 5                                            A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 6                                                                                      A New Hope, Attack of the Clones, Revenge of the Sith
## 7                                                                                      A New Hope, Attack of the Clones, Revenge of the Sith
## 8                                                                                                                                 A New Hope
## 9                                                                                                                                 A New Hope
## 10                    A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 11                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 12                                                                                                           A New Hope, Revenge of the Sith
## 13                                           A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 14                                                                A New Hope, The Empire Strikes Back, Return of the Jedi, The Force Awakens
## 15                                                                                                                                A New Hope
## 16                                                                                        A New Hope, Return of the Jedi, The Phantom Menace
## 17                                                                                   A New Hope, The Empire Strikes Back, Return of the Jedi
## 18                                                                                                                                A New Hope
## 19                                The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 20                                The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 21                                                                         The Empire Strikes Back, Return of the Jedi, Attack of the Clones
## 22                                                                                                                   The Empire Strikes Back
## 23                                                                                                                   The Empire Strikes Back
## 24                                                                                               The Empire Strikes Back, Return of the Jedi
## 25                                                                                                                   The Empire Strikes Back
## 26                                                                                                     Return of the Jedi, The Force Awakens
## 27                                                                                                                        Return of the Jedi
## 28                                                                                                                        Return of the Jedi
## 29                                                                                                                        Return of the Jedi
## 30                                                                                                                        Return of the Jedi
## 31                                                                                                                        The Phantom Menace
## 32                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 33                                                                                                                        The Phantom Menace
## 34                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 35                                                                                                  The Phantom Menace, Attack of the Clones
## 36                                                                                                                        The Phantom Menace
## 37                                                                                                                        The Phantom Menace
## 38                                                                                                                        The Phantom Menace
## 39                                                                                                  The Phantom Menace, Attack of the Clones
## 40                                                                                                                        The Phantom Menace
## 41                                                                                                                        The Phantom Menace
## 42                                                                                                  The Phantom Menace, Attack of the Clones
## 43                                                                                                                        The Phantom Menace
## 44                                                                                                                        Return of the Jedi
## 45                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 46                                                                                                                        The Phantom Menace
## 47                                                                                                                        The Phantom Menace
## 48                                                                                                                        The Phantom Menace
## 49                                                                                                                        The Phantom Menace
## 50                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 51                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 52                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 53                                                                                                   The Phantom Menace, Revenge of the Sith
## 54                                                                                                   The Phantom Menace, Revenge of the Sith
## 55                                                                                                   The Phantom Menace, Revenge of the Sith
## 56                                                                                                                        The Phantom Menace
## 57                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 58                                                                                                  The Phantom Menace, Attack of the Clones
## 59                                                                                                                      Attack of the Clones
## 60                                                                                                                      Attack of the Clones
## 61                                                                                                                      Attack of the Clones
## 62                                                                                                 Attack of the Clones, Revenge of the Sith
## 63                                                                                                 Attack of the Clones, Revenge of the Sith
## 64                                                                                                                      Attack of the Clones
## 65                                                                                                                      Attack of the Clones
## 66                                                                                                 Attack of the Clones, Revenge of the Sith
## 67                                                                                                 Attack of the Clones, Revenge of the Sith
## 68                                                                                                                      Attack of the Clones
## 69                                                                                                                      Attack of the Clones
## 70                                                                                                                      Attack of the Clones
## 71                                                                                                                      Attack of the Clones
## 72                                                                                                                      Attack of the Clones
## 73                                                                                                                      Attack of the Clones
## 74                                                                                                 Attack of the Clones, Revenge of the Sith
## 75                                                                                                                      Attack of the Clones
## 76                                                                                                                      Attack of the Clones
## 77                                                                                                 Attack of the Clones, Revenge of the Sith
## 78                                                                                                                       Revenge of the Sith
## 79                                                                                                                       Revenge of the Sith
## 80                                                                                                           A New Hope, Revenge of the Sith
## 81                                                                                                 Attack of the Clones, Revenge of the Sith
## 82                                                                                                                       Revenge of the Sith
## 83                                                                                                                         The Force Awakens
## 84                                                                                                                         The Force Awakens
## 85                                                                                                                         The Force Awakens
## 86                                                                                                                         The Force Awakens
## 87                                                                                                                         The Force Awakens
##                                vehicles
## 1    Snowspeeder, Imperial Speeder Bike
## 2                                      
## 3                                      
## 4                                      
## 5                 Imperial Speeder Bike
## 6                                      
## 7                                      
## 8                                      
## 9                                      
## 10                      Tribubble bongo
## 11 Zephyr-G swoop bike, XJ-6 airspeeder
## 12                                     
## 13                                AT-ST
## 14                                     
## 15                                     
## 16                                     
## 17                          Snowspeeder
## 18                                     
## 19                                     
## 20                                     
## 21                                     
## 22                                     
## 23                                     
## 24                                     
## 25                                     
## 26                                     
## 27                                     
## 28                                     
## 29                                     
## 30                                     
## 31                      Tribubble bongo
## 32                                     
## 33                                     
## 34                                     
## 35                                     
## 36                                     
## 37                                     
## 38                                     
## 39                                     
## 40                                     
## 41                                     
## 42                                     
## 43                         Sith speeder
## 44                                     
## 45                                     
## 46                                     
## 47                                     
## 48                                     
## 49                                     
## 50                                     
## 51                                     
## 52                                     
## 53                                     
## 54                                     
## 55                                     
## 56                                     
## 57                                     
## 58                                     
## 59                                     
## 60                                     
## 61                                     
## 62                                     
## 63                                     
## 64                                     
## 65                                     
## 66                     Flitknot speeder
## 67                                     
## 68                                     
## 69           Koro-2 Exodrive airspeeder
## 70                                     
## 71                                     
## 72                                     
## 73                                     
## 74                                     
## 75                                     
## 76                                     
## 77                                     
## 78          Tsmeu-6 personal wheel bike
## 79                                     
## 80                                     
## 81                                     
## 82                                     
## 83                                     
## 84                                     
## 85                                     
## 86                                     
## 87                                     
##                                                                                                   starships
## 1                                                                                  X-wing, Imperial shuttle
## 2                                                                                                          
## 3                                                                                                          
## 4                                                                                           TIE Advanced x1
## 5                                                                                                          
## 6                                                                                                          
## 7                                                                                                          
## 8                                                                                                          
## 9                                                                                                    X-wing
## 10 Jedi starfighter, Trade Federation cruiser, Naboo star skiff, Jedi Interceptor, Belbullab-22 starfighter
## 11                                                Naboo fighter, Trade Federation cruiser, Jedi Interceptor
## 12                                                                                                         
## 13                                                                      Millennium Falcon, Imperial shuttle
## 14                                                                      Millennium Falcon, Imperial shuttle
## 15                                                                                                         
## 16                                                                                                         
## 17                                                                                                   X-wing
## 18                                                                                                   X-wing
## 19                                                                                                         
## 20                                                                                                         
## 21                                                                                                  Slave 1
## 22                                                                                                         
## 23                                                                                                         
## 24                                                                                        Millennium Falcon
## 25                                                                                                         
## 26                                                                                                         
## 27                                                                                                         
## 28                                                                                                   A-wing
## 29                                                                                                         
## 30                                                                                        Millennium Falcon
## 31                                                                                                         
## 32                                                                                                         
## 33                                                                                                         
## 34                                                     Naboo fighter, H-type Nubian yacht, Naboo star skiff
## 35                                                                                                         
## 36                                                                                                         
## 37                                                                                                         
## 38                                                                                     Naboo Royal Starship
## 39                                                                                                         
## 40                                                                                                         
## 41                                                                                                         
## 42                                                                                                         
## 43                                                                                                 Scimitar
## 44                                                                                                         
## 45                                                                                                         
## 46                                                                                                         
## 47                                                                                                         
## 48                                                                                                         
## 49                                                                                                         
## 50                                                                                                         
## 51                                                                                                         
## 52                                                                                                         
## 53                                                                                                         
## 54                                                                                                         
## 55                                                                                                         
## 56                                                                                                         
## 57                                                                                         Jedi starfighter
## 58                                                                                                         
## 59                                                                                            Naboo fighter
## 60                                                                                                         
## 61                                                                                                         
## 62                                                                                                         
## 63                                                                                                         
## 64                                                                                                         
## 65                                                                                                         
## 66                                                                                                         
## 67                                                                                                         
## 68                                                                                                         
## 69                                                                                                         
## 70                                                                                                         
## 71                                                                                                         
## 72                                                                                                         
## 73                                                                                                         
## 74                                                                                                         
## 75                                                                                                         
## 76                                                                                                         
## 77                                                                                                         
## 78                                                                                 Belbullab-22 starfighter
## 79                                                                                                         
## 80                                                                                                         
## 81                                                                                                         
## 82                                                                                                         
## 83                                                                                                         
## 84                                                                                                         
## 85                                                                                                   X-wing
## 86                                                                                                         
## 87
```

---

# How could we make this look nicer?


```r
as.data.frame(starwars)
```

```
##                     name height   mass    hair_color          skin_color
## 1         Luke Skywalker    172   77.0         blond                fair
## 2                  C-3PO    167   75.0          &lt;NA&gt;                gold
## 3                  R2-D2     96   32.0          &lt;NA&gt;         white, blue
## 4            Darth Vader    202  136.0          none               white
## 5            Leia Organa    150   49.0         brown               light
## 6              Owen Lars    178  120.0   brown, grey               light
## 7     Beru Whitesun Lars    165   75.0         brown               light
## 8                  R5-D4     97   32.0          &lt;NA&gt;          white, red
## 9      Biggs Darklighter    183   84.0         black               light
## 10        Obi-Wan Kenobi    182   77.0 auburn, white                fair
## 11      Anakin Skywalker    188   84.0         blond                fair
## 12        Wilhuff Tarkin    180     NA  auburn, grey                fair
## 13             Chewbacca    228  112.0         brown             unknown
## 14              Han Solo    180   80.0         brown                fair
## 15                Greedo    173   74.0          &lt;NA&gt;               green
## 16 Jabba Desilijic Tiure    175 1358.0          &lt;NA&gt;    green-tan, brown
## 17        Wedge Antilles    170   77.0         brown                fair
## 18      Jek Tono Porkins    180  110.0         brown                fair
## 19                  Yoda     66   17.0         white               green
## 20             Palpatine    170   75.0          grey                pale
## 21             Boba Fett    183   78.2         black                fair
## 22                 IG-88    200  140.0          none               metal
## 23                 Bossk    190  113.0          none               green
## 24      Lando Calrissian    177   79.0         black                dark
## 25                 Lobot    175   79.0          none               light
## 26                Ackbar    180   83.0          none        brown mottle
## 27            Mon Mothma    150     NA        auburn                fair
## 28          Arvel Crynyd     NA     NA         brown                fair
## 29 Wicket Systri Warrick     88   20.0         brown               brown
## 30             Nien Nunb    160   68.0          none                grey
## 31          Qui-Gon Jinn    193   89.0         brown                fair
## 32           Nute Gunray    191   90.0          none       mottled green
## 33         Finis Valorum    170     NA         blond                fair
## 34         PadmÃ© Amidala    185   45.0         brown               light
## 35         Jar Jar Binks    196   66.0          none              orange
## 36          Roos Tarpals    224   82.0          none                grey
## 37            Rugor Nass    206     NA          none               green
## 38              Ric OliÃ©    183     NA         brown                fair
## 39                 Watto    137     NA         black          blue, grey
## 40               Sebulba    112   40.0          none           grey, red
## 41         Quarsh Panaka    183     NA         black                dark
## 42        Shmi Skywalker    163     NA         black                fair
## 43            Darth Maul    175   80.0          none                 red
## 44           Bib Fortuna    180     NA          none                pale
## 45           Ayla Secura    178   55.0          none                blue
## 46          Ratts Tyerel     79   15.0          none          grey, blue
## 47              Dud Bolt     94   45.0          none          blue, grey
## 48               Gasgano    122     NA          none         white, blue
## 49        Ben Quadinaros    163   65.0          none grey, green, yellow
## 50            Mace Windu    188   84.0          none                dark
## 51          Ki-Adi-Mundi    198   82.0         white                pale
## 52             Kit Fisto    196   87.0          none               green
## 53             Eeth Koth    171     NA         black               brown
## 54            Adi Gallia    184   50.0          none                dark
## 55           Saesee Tiin    188     NA          none                pale
## 56           Yarael Poof    264     NA          none               white
## 57              Plo Koon    188   80.0          none              orange
## 58            Mas Amedda    196     NA          none                blue
## 59          Gregar Typho    185   85.0         black                dark
## 60                 CordÃ©    157     NA         brown               light
## 61           Cliegg Lars    183     NA         brown                fair
## 62     Poggle the Lesser    183   80.0          none               green
## 63       Luminara Unduli    170   56.2         black              yellow
## 64         Barriss Offee    166   50.0         black              yellow
## 65                 DormÃ©    165     NA         brown               light
## 66                 Dooku    193   80.0         white                fair
## 67   Bail Prestor Organa    191     NA         black                 tan
## 68            Jango Fett    183   79.0         black                 tan
## 69            Zam Wesell    168   55.0        blonde fair, green, yellow
## 70       Dexter Jettster    198  102.0          none               brown
## 71               Lama Su    229   88.0          none                grey
## 72               Taun We    213     NA          none                grey
## 73            Jocasta Nu    167     NA         white                fair
## 74                R4-P17     96     NA          none         silver, red
## 75            Wat Tambor    193   48.0          none         green, grey
## 76              San Hill    191     NA          none                grey
## 77              Shaak Ti    178   57.0          none    red, blue, white
## 78              Grievous    216  159.0          none        brown, white
## 79               Tarfful    234  136.0         brown               brown
## 80       Raymus Antilles    188   79.0         brown               light
## 81             Sly Moore    178   48.0          none                pale
## 82            Tion Medon    206   80.0          none                grey
## 83                  Finn     NA     NA         black                dark
## 84                   Rey     NA     NA         brown               light
## 85           Poe Dameron     NA     NA         brown               light
## 86                   BB8     NA     NA          none                none
## 87        Captain Phasma     NA     NA          none                none
##        eye_color birth_year            sex    gender      homeworld
## 1           blue       19.0           male masculine       Tatooine
## 2         yellow      112.0           none masculine       Tatooine
## 3            red       33.0           none masculine          Naboo
## 4         yellow       41.9           male masculine       Tatooine
## 5          brown       19.0         female  feminine       Alderaan
## 6           blue       52.0           male masculine       Tatooine
## 7           blue       47.0         female  feminine       Tatooine
## 8            red         NA           none masculine       Tatooine
## 9          brown       24.0           male masculine       Tatooine
## 10     blue-gray       57.0           male masculine        Stewjon
## 11          blue       41.9           male masculine       Tatooine
## 12          blue       64.0           male masculine         Eriadu
## 13          blue      200.0           male masculine       Kashyyyk
## 14         brown       29.0           male masculine       Corellia
## 15         black       44.0           male masculine          Rodia
## 16        orange      600.0 hermaphroditic masculine      Nal Hutta
## 17         hazel       21.0           male masculine       Corellia
## 18          blue         NA           &lt;NA&gt;      &lt;NA&gt;     Bestine IV
## 19         brown      896.0           male masculine           &lt;NA&gt;
## 20        yellow       82.0           male masculine          Naboo
## 21         brown       31.5           male masculine         Kamino
## 22           red       15.0           none masculine           &lt;NA&gt;
## 23           red       53.0           male masculine      Trandosha
## 24         brown       31.0           male masculine        Socorro
## 25          blue       37.0           male masculine         Bespin
## 26        orange       41.0           male masculine       Mon Cala
## 27          blue       48.0         female  feminine      Chandrila
## 28         brown         NA           male masculine           &lt;NA&gt;
## 29         brown        8.0           male masculine          Endor
## 30         black         NA           male masculine        Sullust
## 31          blue       92.0           male masculine           &lt;NA&gt;
## 32           red         NA           male masculine Cato Neimoidia
## 33          blue       91.0           male masculine      Coruscant
## 34         brown       46.0         female  feminine          Naboo
## 35        orange       52.0           male masculine          Naboo
## 36        orange         NA           male masculine          Naboo
## 37        orange         NA           male masculine          Naboo
## 38          blue         NA           male masculine          Naboo
## 39        yellow         NA           male masculine       Toydaria
## 40        orange         NA           male masculine      Malastare
## 41         brown       62.0           male masculine          Naboo
## 42         brown       72.0         female  feminine       Tatooine
## 43        yellow       54.0           male masculine       Dathomir
## 44          pink         NA           male masculine         Ryloth
## 45         hazel       48.0         female  feminine         Ryloth
## 46       unknown         NA           male masculine    Aleen Minor
## 47        yellow         NA           male masculine        Vulpter
## 48         black         NA           male masculine        Troiken
## 49        orange         NA           male masculine           Tund
## 50         brown       72.0           male masculine     Haruun Kal
## 51        yellow       92.0           male masculine          Cerea
## 52         black         NA           male masculine    Glee Anselm
## 53         brown         NA           male masculine       Iridonia
## 54          blue         NA         female  feminine      Coruscant
## 55        orange         NA           male masculine        Iktotch
## 56        yellow         NA           male masculine        Quermia
## 57         black       22.0           male masculine          Dorin
## 58          blue         NA           male masculine       Champala
## 59         brown         NA           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 60         brown         NA           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 61          blue       82.0           male masculine       Tatooine
## 62        yellow         NA           male masculine       Geonosis
## 63          blue       58.0         female  feminine         Mirial
## 64          blue       40.0         female  feminine         Mirial
## 65         brown         NA         female  feminine          Naboo
## 66         brown      102.0           male masculine        Serenno
## 67         brown       67.0           male masculine       Alderaan
## 68         brown       66.0           male masculine   Concord Dawn
## 69        yellow         NA         female  feminine          Zolan
## 70        yellow         NA           male masculine           Ojom
## 71         black         NA           male masculine         Kamino
## 72         black         NA         female  feminine         Kamino
## 73          blue         NA         female  feminine      Coruscant
## 74     red, blue         NA           none  feminine           &lt;NA&gt;
## 75       unknown         NA           male masculine          Skako
## 76          gold         NA           male masculine     Muunilinst
## 77         black         NA         female  feminine          Shili
## 78 green, yellow         NA           male masculine          Kalee
## 79          blue         NA           male masculine       Kashyyyk
## 80         brown         NA           male masculine       Alderaan
## 81         white         NA           &lt;NA&gt;      &lt;NA&gt;         Umbara
## 82         black         NA           male masculine         Utapau
## 83          dark         NA           male masculine           &lt;NA&gt;
## 84         hazel         NA         female  feminine           &lt;NA&gt;
## 85         brown         NA           male masculine           &lt;NA&gt;
## 86         black         NA           none masculine           &lt;NA&gt;
## 87       unknown         NA         female  feminine           &lt;NA&gt;
##           species
## 1           Human
## 2           Droid
## 3           Droid
## 4           Human
## 5           Human
## 6           Human
## 7           Human
## 8           Droid
## 9           Human
## 10          Human
## 11          Human
## 12          Human
## 13        Wookiee
## 14          Human
## 15         Rodian
## 16           Hutt
## 17          Human
## 18           &lt;NA&gt;
## 19 Yoda's species
## 20          Human
## 21          Human
## 22          Droid
## 23     Trandoshan
## 24          Human
## 25          Human
## 26   Mon Calamari
## 27          Human
## 28          Human
## 29           Ewok
## 30      Sullustan
## 31          Human
## 32      Neimodian
## 33          Human
## 34          Human
## 35         Gungan
## 36         Gungan
## 37         Gungan
## 38          Human
## 39      Toydarian
## 40            Dug
## 41          Human
## 42          Human
## 43         Zabrak
## 44        Twi'lek
## 45        Twi'lek
## 46         Aleena
## 47     Vulptereen
## 48          Xexto
## 49          Toong
## 50          Human
## 51         Cerean
## 52       Nautolan
## 53         Zabrak
## 54     Tholothian
## 55       Iktotchi
## 56       Quermian
## 57        Kel Dor
## 58       Chagrian
## 59           &lt;NA&gt;
## 60           &lt;NA&gt;
## 61          Human
## 62      Geonosian
## 63       Mirialan
## 64       Mirialan
## 65          Human
## 66          Human
## 67          Human
## 68          Human
## 69       Clawdite
## 70       Besalisk
## 71       Kaminoan
## 72       Kaminoan
## 73          Human
## 74          Droid
## 75        Skakoan
## 76           Muun
## 77        Togruta
## 78        Kaleesh
## 79        Wookiee
## 80          Human
## 81           &lt;NA&gt;
## 82         Pau'an
## 83          Human
## 84          Human
## 85          Human
## 86          Droid
## 87          Human
##                                                                                                                                        films
## 1                                            A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 2                     A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 3  A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith, The Force Awakens
## 4                                                               A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith
## 5                                            A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 6                                                                                      A New Hope, Attack of the Clones, Revenge of the Sith
## 7                                                                                      A New Hope, Attack of the Clones, Revenge of the Sith
## 8                                                                                                                                 A New Hope
## 9                                                                                                                                 A New Hope
## 10                    A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 11                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 12                                                                                                           A New Hope, Revenge of the Sith
## 13                                           A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 14                                                                A New Hope, The Empire Strikes Back, Return of the Jedi, The Force Awakens
## 15                                                                                                                                A New Hope
## 16                                                                                        A New Hope, Return of the Jedi, The Phantom Menace
## 17                                                                                   A New Hope, The Empire Strikes Back, Return of the Jedi
## 18                                                                                                                                A New Hope
## 19                                The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 20                                The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 21                                                                         The Empire Strikes Back, Return of the Jedi, Attack of the Clones
## 22                                                                                                                   The Empire Strikes Back
## 23                                                                                                                   The Empire Strikes Back
## 24                                                                                               The Empire Strikes Back, Return of the Jedi
## 25                                                                                                                   The Empire Strikes Back
## 26                                                                                                     Return of the Jedi, The Force Awakens
## 27                                                                                                                        Return of the Jedi
## 28                                                                                                                        Return of the Jedi
## 29                                                                                                                        Return of the Jedi
## 30                                                                                                                        Return of the Jedi
## 31                                                                                                                        The Phantom Menace
## 32                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 33                                                                                                                        The Phantom Menace
## 34                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 35                                                                                                  The Phantom Menace, Attack of the Clones
## 36                                                                                                                        The Phantom Menace
## 37                                                                                                                        The Phantom Menace
## 38                                                                                                                        The Phantom Menace
## 39                                                                                                  The Phantom Menace, Attack of the Clones
## 40                                                                                                                        The Phantom Menace
## 41                                                                                                                        The Phantom Menace
## 42                                                                                                  The Phantom Menace, Attack of the Clones
## 43                                                                                                                        The Phantom Menace
## 44                                                                                                                        Return of the Jedi
## 45                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 46                                                                                                                        The Phantom Menace
## 47                                                                                                                        The Phantom Menace
## 48                                                                                                                        The Phantom Menace
## 49                                                                                                                        The Phantom Menace
## 50                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 51                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 52                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 53                                                                                                   The Phantom Menace, Revenge of the Sith
## 54                                                                                                   The Phantom Menace, Revenge of the Sith
## 55                                                                                                   The Phantom Menace, Revenge of the Sith
## 56                                                                                                                        The Phantom Menace
## 57                                                                             The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 58                                                                                                  The Phantom Menace, Attack of the Clones
## 59                                                                                                                      Attack of the Clones
## 60                                                                                                                      Attack of the Clones
## 61                                                                                                                      Attack of the Clones
## 62                                                                                                 Attack of the Clones, Revenge of the Sith
## 63                                                                                                 Attack of the Clones, Revenge of the Sith
## 64                                                                                                                      Attack of the Clones
## 65                                                                                                                      Attack of the Clones
## 66                                                                                                 Attack of the Clones, Revenge of the Sith
## 67                                                                                                 Attack of the Clones, Revenge of the Sith
## 68                                                                                                                      Attack of the Clones
## 69                                                                                                                      Attack of the Clones
## 70                                                                                                                      Attack of the Clones
## 71                                                                                                                      Attack of the Clones
## 72                                                                                                                      Attack of the Clones
## 73                                                                                                                      Attack of the Clones
## 74                                                                                                 Attack of the Clones, Revenge of the Sith
## 75                                                                                                                      Attack of the Clones
## 76                                                                                                                      Attack of the Clones
## 77                                                                                                 Attack of the Clones, Revenge of the Sith
## 78                                                                                                                       Revenge of the Sith
## 79                                                                                                                       Revenge of the Sith
## 80                                                                                                           A New Hope, Revenge of the Sith
## 81                                                                                                 Attack of the Clones, Revenge of the Sith
## 82                                                                                                                       Revenge of the Sith
## 83                                                                                                                         The Force Awakens
## 84                                                                                                                         The Force Awakens
## 85                                                                                                                         The Force Awakens
## 86                                                                                                                         The Force Awakens
## 87                                                                                                                         The Force Awakens
##                                vehicles
## 1    Snowspeeder, Imperial Speeder Bike
## 2                                      
## 3                                      
## 4                                      
## 5                 Imperial Speeder Bike
## 6                                      
## 7                                      
## 8                                      
## 9                                      
## 10                      Tribubble bongo
## 11 Zephyr-G swoop bike, XJ-6 airspeeder
## 12                                     
## 13                                AT-ST
## 14                                     
## 15                                     
## 16                                     
## 17                          Snowspeeder
## 18                                     
## 19                                     
## 20                                     
## 21                                     
## 22                                     
## 23                                     
## 24                                     
## 25                                     
## 26                                     
## 27                                     
## 28                                     
## 29                                     
## 30                                     
## 31                      Tribubble bongo
## 32                                     
## 33                                     
## 34                                     
## 35                                     
## 36                                     
## 37                                     
## 38                                     
## 39                                     
## 40                                     
## 41                                     
## 42                                     
## 43                         Sith speeder
## 44                                     
## 45                                     
## 46                                     
## 47                                     
## 48                                     
## 49                                     
## 50                                     
## 51                                     
## 52                                     
## 53                                     
## 54                                     
## 55                                     
## 56                                     
## 57                                     
## 58                                     
## 59                                     
## 60                                     
## 61                                     
## 62                                     
## 63                                     
## 64                                     
## 65                                     
## 66                     Flitknot speeder
## 67                                     
## 68                                     
## 69           Koro-2 Exodrive airspeeder
## 70                                     
## 71                                     
## 72                                     
## 73                                     
## 74                                     
## 75                                     
## 76                                     
## 77                                     
## 78          Tsmeu-6 personal wheel bike
## 79                                     
## 80                                     
## 81                                     
## 82                                     
## 83                                     
## 84                                     
## 85                                     
## 86                                     
## 87                                     
##                                                                                                   starships
## 1                                                                                  X-wing, Imperial shuttle
## 2                                                                                                          
## 3                                                                                                          
## 4                                                                                           TIE Advanced x1
## 5                                                                                                          
## 6                                                                                                          
## 7                                                                                                          
## 8                                                                                                          
## 9                                                                                                    X-wing
## 10 Jedi starfighter, Trade Federation cruiser, Naboo star skiff, Jedi Interceptor, Belbullab-22 starfighter
## 11                                                Naboo fighter, Trade Federation cruiser, Jedi Interceptor
## 12                                                                                                         
## 13                                                                      Millennium Falcon, Imperial shuttle
## 14                                                                      Millennium Falcon, Imperial shuttle
## 15                                                                                                         
## 16                                                                                                         
## 17                                                                                                   X-wing
## 18                                                                                                   X-wing
## 19                                                                                                         
## 20                                                                                                         
## 21                                                                                                  Slave 1
## 22                                                                                                         
## 23                                                                                                         
## 24                                                                                        Millennium Falcon
## 25                                                                                                         
## 26                                                                                                         
## 27                                                                                                         
## 28                                                                                                   A-wing
## 29                                                                                                         
## 30                                                                                        Millennium Falcon
## 31                                                                                                         
## 32                                                                                                         
## 33                                                                                                         
## 34                                                     Naboo fighter, H-type Nubian yacht, Naboo star skiff
## 35                                                                                                         
## 36                                                                                                         
## 37                                                                                                         
## 38                                                                                     Naboo Royal Starship
## 39                                                                                                         
## 40                                                                                                         
## 41                                                                                                         
## 42                                                                                                         
## 43                                                                                                 Scimitar
## 44                                                                                                         
## 45                                                                                                         
## 46                                                                                                         
## 47                                                                                                         
## 48                                                                                                         
## 49                                                                                                         
## 50                                                                                                         
## 51                                                                                                         
## 52                                                                                                         
## 53                                                                                                         
## 54                                                                                                         
## 55                                                                                                         
## 56                                                                                                         
## 57                                                                                         Jedi starfighter
## 58                                                                                                         
## 59                                                                                            Naboo fighter
## 60                                                                                                         
## 61                                                                                                         
## 62                                                                                                         
## 63                                                                                                         
## 64                                                                                                         
## 65                                                                                                         
## 66                                                                                                         
## 67                                                                                                         
## 68                                                                                                         
## 69                                                                                                         
## 70                                                                                                         
## 71                                                                                                         
## 72                                                                                                         
## 73                                                                                                         
## 74                                                                                                         
## 75                                                                                                         
## 76                                                                                                         
## 77                                                                                                         
## 78                                                                                 Belbullab-22 starfighter
## 79                                                                                                         
## 80                                                                                                         
## 81                                                                                                         
## 82                                                                                                         
## 83                                                                                                         
## 84                                                                                                         
## 85                                                                                                   X-wing
## 86                                                                                                         
## 87
```

---

# Printing a data.frame with head()


```r
head(as.data.frame(starwars))
```

```
##             name height mass  hair_color  skin_color eye_color birth_year
## 1 Luke Skywalker    172   77       blond        fair      blue       19.0
## 2          C-3PO    167   75        &lt;NA&gt;        gold    yellow      112.0
## 3          R2-D2     96   32        &lt;NA&gt; white, blue       red       33.0
## 4    Darth Vader    202  136        none       white    yellow       41.9
## 5    Leia Organa    150   49       brown       light     brown       19.0
## 6      Owen Lars    178  120 brown, grey       light      blue       52.0
##      sex    gender homeworld species
## 1   male masculine  Tatooine   Human
## 2   none masculine  Tatooine   Droid
## 3   none masculine     Naboo   Droid
## 4   male masculine  Tatooine   Human
## 5 female  feminine  Alderaan   Human
## 6   male masculine  Tatooine   Human
##                                                                                                                                       films
## 1                                           A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 2                    A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 3 A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith, The Force Awakens
## 4                                                              A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith
## 5                                           A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 6                                                                                     A New Hope, Attack of the Clones, Revenge of the Sith
##                             vehicles                starships
## 1 Snowspeeder, Imperial Speeder Bike X-wing, Imperial shuttle
## 2                                                            
## 3                                                            
## 4                                             TIE Advanced x1
## 5              Imperial Speeder Bike                         
## 6
```

---

# This still doesn't look very nice...


```r
head(as.data.frame(starwars))
```

```
##             name height mass  hair_color  skin_color eye_color birth_year
## 1 Luke Skywalker    172   77       blond        fair      blue       19.0
## 2          C-3PO    167   75        &lt;NA&gt;        gold    yellow      112.0
## 3          R2-D2     96   32        &lt;NA&gt; white, blue       red       33.0
## 4    Darth Vader    202  136        none       white    yellow       41.9
## 5    Leia Organa    150   49       brown       light     brown       19.0
## 6      Owen Lars    178  120 brown, grey       light      blue       52.0
##      sex    gender homeworld species
## 1   male masculine  Tatooine   Human
## 2   none masculine  Tatooine   Droid
## 3   none masculine     Naboo   Droid
## 4   male masculine  Tatooine   Human
## 5 female  feminine  Alderaan   Human
## 6   male masculine  Tatooine   Human
##                                                                                                                                       films
## 1                                           A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 2                    A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith
## 3 A New Hope, The Empire Strikes Back, Return of the Jedi, The Phantom Menace, Attack of the Clones, Revenge of the Sith, The Force Awakens
## 4                                                              A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith
## 5                                           A New Hope, The Empire Strikes Back, Return of the Jedi, Revenge of the Sith, The Force Awakens
## 6                                                                                     A New Hope, Attack of the Clones, Revenge of the Sith
##                             vehicles                starships
## 1 Snowspeeder, Imperial Speeder Bike X-wing, Imperial shuttle
## 2                                                            
## 3                                                            
## 4                                             TIE Advanced x1
## 5              Imperial Speeder Bike                         
## 6
```

---

# Printing a tibble


```r
starwars
```

```
*## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
*##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
*## # â„¹ 77 more rows
*## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: pipes

# Pipes

**Generic programming question:** Does anyone know what pipes do?

--

Pipes allow us to pass information through a sequence of operations

--

The tidyverse loads the `magrittr` pipe, denoted `%&gt;%`

R now has a native pipe, denoted `|&gt;` (since R version 4.1.0)

--

They are identical for simple cases, but have some differences

--

We will use `|&gt;` in class

**Keyboard shortcut:** use `Ctrl/Cmd+Shift+m` to insert the pipe (with spaces)
- You can [set the RStudio keyboard shortcut](https://r4ds.hadley.nz/workflow-pipes.html) to use either `%&gt;%` or `|&gt;`

---

# Pipe usage

To see why using pipes is so powerful, consider this contrived example based on what we did this morning:

1. Wake up
2. Get out of bed
4. Get dressed
5. Drink coffee
6. Go to class


---

# A day without pipes

You could code this through a series of assignment operations:


```r
me &lt;- wake_up(me)
me &lt;- get_out_of_bed(me)
me &lt;- get_dressed(me)
me &lt;- drink(me, "coffee")
me &lt;- go(me, "class")
```

Or by putting all these operations in a single line of code:


```r
me &lt;- go(drink(get_dressed(get_out_of_bed(wake_up(me))), "coffee"), "class")
```

Neither is ideal

---

# Pipes are the best of both worlds

We can do everything at once, in order:


```r
me |&gt; 
  wake_up() |&gt; 
  get_out_of_bed() |&gt; 
  get_dressed() |&gt; 
  drink("coffee") |&gt; 
  go("class")
```

Emphasis is on verbs (e.g., `wake_up`, `get_out_of_bed`, etc.), not nouns (i.e., `me`)

---

# Pipes: Best practices

Write linear code

Spread code out for readability: use one line per verb

Don't use pipes...
- when you need more than 10 (use intermediate objects instead)
- for multiple inputs or outputs
- for non-linear relationships

--

**Reminder:** `|&gt;` and `%&gt;%` can both be used, though they have some important differences for more advanced work. We will us `|&gt;` in this class.

---
class: inverse, center, middle
name: dplyr

# dplyr

---

# What is dplyr?

&lt;img src="img/02/dplyr_wrangling.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# What is dplyr?

The dplyr package provides a **grammar of data manipulation**

--

dplyr's functions are **verbs** that correspond to things we want to **do**

--

dplyr functions all have these things in common:
1. their first argument is a data frame
2. their other arguments describe what you want to do
3. their output is a new data frame

--

**1** + **3** + **pipes** allow us to combine simple steps to achieve complex results

---

# dplyr has five key verbs we will use

1. `filter`: subset rows based on their values

2. `arrange`: reorder rows based on their values

3. `select`: select columns (i.e., variables)

4. `mutate`: create new columns

5. `summarize`: collapse multiple rows into a single summary value


---

# dplyr verbs operate on different things

- Rows:
  - `filter`: subset rows based on their values
  - `arrange`: reorder rows based on their values
- Columns:
  - `select`: select columns (i.e., variables)
  - `mutate`: create new columns
- Groups of rows:
  - `summarize`: collapse multiple rows into a single summary value

--

Let's study these commands together using the `starwars` data frame that comes pre-packaged with dplyr

---

# Starwars

This is what the `starwars` dataset looks like:


```r
starwars
```

```
## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```


---
name: select

# 1) dplyr::select

`select` allows us to select columns / variables:

.pull-left[

```r
starwars |&gt; select(name)
```

```
*## # A tibble: 87 Ã— 1
##    name              
##    &lt;chr&gt;             
##  1 Luke Skywalker    
##  2 C-3PO             
##  3 R2-D2             
##  4 Darth Vader       
##  5 Leia Organa       
##  6 Owen Lars         
##  7 Beru Whitesun Lars
##  8 R5-D4             
##  9 Biggs Darklighter 
## 10 Obi-Wan Kenobi    
## # â„¹ 77 more rows
```
]

--

.pull-right[
`select` returns a tibble even though you only asked for one variable

To get a vector, you can use:
- `starwars |&gt; pull(name)`
]

---

# 1) dplyr::select

You can get fancy: use commas to select multiple columns, deselect a column using "-", and select consecutive columns using "first:last"

```r
starwars |&gt; 
  select(name:skin_color, species, -height)
```

```
## # A tibble: 87 Ã— 5
##    name                mass hair_color    skin_color  species
##    &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;  
##  1 Luke Skywalker        77 blond         fair        Human  
##  2 C-3PO                 75 &lt;NA&gt;          gold        Droid  
##  3 R2-D2                 32 &lt;NA&gt;          white, blue Droid  
##  4 Darth Vader          136 none          white       Human  
##  5 Leia Organa           49 brown         light       Human  
##  6 Owen Lars            120 brown, grey   light       Human  
##  7 Beru Whitesun Lars    75 brown         light       Human  
##  8 R5-D4                 32 &lt;NA&gt;          white, red  Droid  
##  9 Biggs Darklighter     84 black         light       Human  
## 10 Obi-Wan Kenobi        77 auburn, white fair        Human  
## # â„¹ 77 more rows
```

---

# 1) dplyr::select

You can also rename your selected variables at the same time:

```r
starwars |&gt;
  select(alias = name, crib = homeworld)
```

```
## # A tibble: 87 Ã— 2
##    alias              crib    
##    &lt;chr&gt;              &lt;chr&gt;   
##  1 Luke Skywalker     Tatooine
##  2 C-3PO              Tatooine
##  3 R2-D2              Naboo   
##  4 Darth Vader        Tatooine
##  5 Leia Organa        Alderaan
##  6 Owen Lars          Tatooine
##  7 Beru Whitesun Lars Tatooine
##  8 R5-D4              Tatooine
##  9 Biggs Darklighter  Tatooine
## 10 Obi-Wan Kenobi     Stewjon 
## # â„¹ 77 more rows
```

---

# 1) dplyr::select

If you just want to rename columns without subsetting them, use `rename`:

```r
starwars |&gt;
  rename(alias = name, crib = homeworld)
```

```
## # A tibble: 87 Ã— 14
##    alias    height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: crib &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;
```

---

# 1) dplyr::select

`select(contains(PATTERN))` provides a handy shortcut:

```r
starwars |&gt; 
  select(name, contains("color"))
```

```
## # A tibble: 87 Ã— 4
##    name               hair_color    skin_color  eye_color
##    &lt;chr&gt;              &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker     blond         fair        blue     
##  2 C-3PO              &lt;NA&gt;          gold        yellow   
##  3 R2-D2              &lt;NA&gt;          white, blue red      
##  4 Darth Vader        none          white       yellow   
##  5 Leia Organa        brown         light       brown    
##  6 Owen Lars          brown, grey   light       blue     
##  7 Beru Whitesun Lars brown         light       blue     
##  8 R5-D4              &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter  black         light       brown    
## 10 Obi-Wan Kenobi     auburn, white fair        blue-gray
## # â„¹ 77 more rows
```

---

# 1) dplyr::~~select~~ relocate

You can also use `relocate` to move important variables to the "front" of a data frame without subsetting:

```r
starwars |&gt; 
  relocate(species, homeworld) |&gt;
  head(5)
```

```
## # A tibble: 5 Ã— 14
##   species homeworld name           height  mass hair_color skin_color  eye_color
##   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    
## 1 Human   Tatooine  Luke Skywalker    172    77 blond      fair        blue     
## 2 Droid   Tatooine  C-3PO             167    75 &lt;NA&gt;       gold        yellow   
## 3 Droid   Naboo     R2-D2              96    32 &lt;NA&gt;       white, blue red      
## 4 Human   Tatooine  Darth Vader       202   136 none       white       yellow   
## 5 Human   Alderaan  Leia Organa       150    49 brown      light       brown    
## # â„¹ 6 more variables: birth_year &lt;dbl&gt;, sex &lt;chr&gt;, gender &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
# 1) dplyr::~~select~~ relocate

&lt;img src="img/02/dplyr_relocate.png" width="65%" style="display: block; margin: auto;" /&gt;


---
class: inverse, center, middle
name: example

# Let's work through an example on Posit Cloud


---
name: filter

# 2) dplyr::filter

&lt;img src="img/02/dplyr_filter.jpg" width="75%" style="display: block; margin: auto;" /&gt;

---

# 2) dplyr::filter

`filter` allows us to focus on certain rows / observations

--

For example, you may only be interested in droids:


```r
starwars |&gt; 
  filter(species == "Droid") 
```

```
## # A tibble: 6 Ã— 14
##   name   height  mass hair_color skin_color  eye_color birth_year sex   gender  
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   
## 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow           112 none  masculiâ€¦
## 2 R2-D2      96    32 &lt;NA&gt;       white, blue red               33 none  masculiâ€¦
## 3 R5-D4      97    32 &lt;NA&gt;       white, red  red               NA none  masculiâ€¦
## 4 IG-88     200   140 none       metal       red               15 none  masculiâ€¦
## 5 R4-P17     96    NA none       silver, red red, blue         NA none  feminine
## 6 BB8        NA    NA none       none        black             NA none  masculiâ€¦
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 2) dplyr::filter

Or perhaps you want to subset the humans that are taller than I am:


```r
starwars |&gt; 
  filter( 
    species == "Human", 
    height &gt;= 194
    ) 
```

Can you name one? *Hint: there's only one*

--


```
## # A tibble: 1 Ã— 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
*## 1 Darth Vaâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```


---

# 2) dplyr::filter

Regular expressions work here too, with the help of the `stringr` package:

```r
starwars |&gt; 
  filter(str_detect(name, "Skywalker"))
```

```
## # A tibble: 3 Ã— 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Skyâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
## 2 Anakin Sâ€¦    188    84 blond      fair       blue            41.9 male  mascuâ€¦
## 3 Shmi Skyâ€¦    163    NA black      fair       brown           72   femaâ€¦ feminâ€¦
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 2) dplyr::filter

A common `filter` use case is identifying/removing missing data using `is.na`:

```r
starwars |&gt; 
  filter(is.na(height))
```

```
## # A tibble: 6 Ã— 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Arvel Crâ€¦     NA    NA brown      fair       brown             NA male  mascuâ€¦
## 2 Finn          NA    NA black      dark       dark              NA male  mascuâ€¦
## 3 Rey           NA    NA brown      light      hazel             NA femaâ€¦ feminâ€¦
## 4 Poe Dameâ€¦     NA    NA brown      light      brown             NA male  mascuâ€¦
## 5 BB8           NA    NA none       none       black             NA none  mascuâ€¦
## 6 Captain â€¦     NA    NA none       none       unknown           NA femaâ€¦ feminâ€¦
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 2) dplyr::filter

How could you build on this to remove rows with missing data?

--


```r
starwars |&gt; 
  filter(!is.na(height)) # use ! for negation
```

```
## # A tibble: 81 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â„¹ 71 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: arrange

# 3) dplyr::arrange

`arrange` sorts the data frame based on the variable(s) you supply:


```r
starwars |&gt; 
  arrange(birth_year)
```

```
## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Wicket â€¦     88  20   brown      brown      brown            8   male  mascuâ€¦
##  2 IG-88       200 140   none       metal      red             15   none  mascuâ€¦
##  3 Luke Skâ€¦    172  77   blond      fair       blue            19   male  mascuâ€¦
##  4 Leia Orâ€¦    150  49   brown      light      brown           19   femaâ€¦ feminâ€¦
##  5 Wedge Aâ€¦    170  77   brown      fair       hazel           21   male  mascuâ€¦
##  6 Plo Koon    188  80   none       orange     black           22   male  mascuâ€¦
##  7 Biggs Dâ€¦    183  84   black      light      brown           24   male  mascuâ€¦
##  8 Han Solo    180  80   brown      fair       brown           29   male  mascuâ€¦
##  9 Lando Câ€¦    177  79   black      dark       brown           31   male  mascuâ€¦
## 10 Boba Feâ€¦    183  78.2 black      fair       brown           31.5 male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 3) dplyr::arrange

We can also arrange items in descending order using `arrange(desc())`:

```r
starwars |&gt; 
  arrange(desc(birth_year))
```

```
## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda         66    17 white      green      brown            896 male  mascuâ€¦
##  2 Jabba Dâ€¦    175  1358 &lt;NA&gt;       green-tanâ€¦ orange           600 hermâ€¦ mascuâ€¦
##  3 Chewbacâ€¦    228   112 brown      unknown    blue             200 male  mascuâ€¦
##  4 C-3PO       167    75 &lt;NA&gt;       gold       yellow           112 none  mascuâ€¦
##  5 Dooku       193    80 white      fair       brown            102 male  mascuâ€¦
##  6 Qui-Gonâ€¦    193    89 brown      fair       blue              92 male  mascuâ€¦
##  7 Ki-Adi-â€¦    198    82 white      pale       yellow            92 male  mascuâ€¦
##  8 Finis Vâ€¦    170    NA blond      fair       blue              91 male  mascuâ€¦
##  9 Palpatiâ€¦    170    75 grey       pale       yellow            82 male  mascuâ€¦
## 10 Cliegg â€¦    183    NA brown      fair       blue              82 male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: mutate

# 4) dplyr::mutate

&lt;img src="img/02/dplyr_mutate.png" width="55%" style="display: block; margin: auto;" /&gt;

---

# 4) dplyr::mutate

You can create new columns from scratch or by transforming existing columns:

```r
starwars |&gt; 
  select(name, birth_year) |&gt;
  mutate(dog_years = birth_year * 7)
```

```
## # A tibble: 87 Ã— 3
##    name               birth_year dog_years
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;
##  1 Luke Skywalker           19        133 
##  2 C-3PO                   112        784 
##  3 R2-D2                    33        231 
##  4 Darth Vader              41.9      293.
##  5 Leia Organa              19        133 
##  6 Owen Lars                52        364 
##  7 Beru Whitesun Lars       47        329 
##  8 R5-D4                    NA         NA 
##  9 Biggs Darklighter        24        168 
## 10 Obi-Wan Kenobi           57        399 
## # â„¹ 77 more rows
```

---

# 4) dplyr::mutate

You can create new columns from scratch or by transforming existing columns:

```r
starwars |&gt; 
  select(name, birth_year) |&gt;
  mutate(dog_years = birth_year * 7) |&gt;
  mutate(comment = str_glue("{name} is {dog_years} in dog years.")) # or could use paste()
```

```
## # A tibble: 87 Ã— 4
##    name               birth_year dog_years comment                              
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;glue&gt;                               
##  1 Luke Skywalker           19        133  Luke Skywalker is 133 in dog years.  
##  2 C-3PO                   112        784  C-3PO is 784 in dog years.           
##  3 R2-D2                    33        231  R2-D2 is 231 in dog years.           
##  4 Darth Vader              41.9      293. Darth Vader is 293.3 in dog years.   
##  5 Leia Organa              19        133  Leia Organa is 133 in dog years.     
##  6 Owen Lars                52        364  Owen Lars is 364 in dog years.       
##  7 Beru Whitesun Lars       47        329  Beru Whitesun Lars is 329 in dog yeaâ€¦
##  8 R5-D4                    NA         NA  R5-D4 is NA in dog years.            
##  9 Biggs Darklighter        24        168  Biggs Darklighter is 168 in dog yearâ€¦
## 10 Obi-Wan Kenobi           57        399  Obi-Wan Kenobi is 399 in dog years.  
## # â„¹ 77 more rows
```

---


# 4) dplyr::mutate

`mutate` creates variables in order, so we can chain them together in a single call:

```r
starwars |&gt; 
  select(name, birth_year) |&gt;
  mutate(dog_years = birth_year * 7, # separate with a comma
         comment = str_glue("{name} is {dog_years} in dog years."))
```

```
## # A tibble: 87 Ã— 4
##    name               birth_year dog_years comment                              
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;glue&gt;                               
##  1 Luke Skywalker           19        133  Luke Skywalker is 133 in dog years.  
##  2 C-3PO                   112        784  C-3PO is 784 in dog years.           
##  3 R2-D2                    33        231  R2-D2 is 231 in dog years.           
##  4 Darth Vader              41.9      293. Darth Vader is 293.3 in dog years.   
##  5 Leia Organa              19        133  Leia Organa is 133 in dog years.     
##  6 Owen Lars                52        364  Owen Lars is 364 in dog years.       
##  7 Beru Whitesun Lars       47        329  Beru Whitesun Lars is 329 in dog yeaâ€¦
##  8 R5-D4                    NA         NA  R5-D4 is NA in dog years.            
##  9 Biggs Darklighter        24        168  Biggs Darklighter is 168 in dog yearâ€¦
## 10 Obi-Wan Kenobi           57        399  Obi-Wan Kenobi is 399 in dog years.  
## # â„¹ 77 more rows
```

---

# 4) dplyr::mutate

Boolean, logical, and conditional operators all work well with `mutate`:

```r
starwars |&gt; 
  select(name, height) |&gt;
  filter(name %in% c("Luke Skywalker", "Anakin Skywalker")) |&gt; 
  mutate(tall1 = height &gt; 180) |&gt;
  mutate(tall2 = ifelse(height &gt; 180, "Tall", "Short")) # same effect, but can choose labels
```

How many rows do you think this will return? How many columns?

--


```
## # A tibble: 2 Ã— 4
##   name             height tall1 tall2
##   &lt;chr&gt;             &lt;int&gt; &lt;lgl&gt; &lt;chr&gt;
## 1 Luke Skywalker      172 FALSE Short
## 2 Anakin Skywalker    188 TRUE  Tall
```

---
name: summarize

# 5) dplyr::summarize

Often we want to get summary statistics or *collapse* our data

`summarize` provides an easy way to do this

--

**Example:** "What are the mininum, maximum, and average prices of `diamonds`?"

```r
diamonds |&gt; 
  summarize(min = min(price),      # calculate the min price
            max = max(price),      # calculate the max price
            average = mean(price)) # calculate the mean price
```

```
## # A tibble: 1 Ã— 3
##     min   max average
##   &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
## 1   326 18823   3933.
```

---

# 5) dplyr::summarize

Including `na.rm = TRUE` keeps NAs from propagating to the end result:

.pull-left[

```r
# probably not what we want
starwars |&gt; 
  summarize(mh = mean(height))
```

```
## # A tibble: 1 Ã— 1
##      mh
##   &lt;dbl&gt;
## 1    NA
```
]

.pull-right[

```r
# better
starwars |&gt; 
  summarize(mh = mean(height, na.rm = TRUE))
```

```
## # A tibble: 1 Ã— 1
##      mh
##   &lt;dbl&gt;
## 1  175.
```
]

--

Is this a feature or a bug?

--

It depends on the context!

---

# Bonus: dplyr::group_by

`summarize` is particularly useful in combination with `group_by`:

```r
starwars |&gt; 
  group_by(species, gender) |&gt; # for each species-gender combo
  summarize(mean_height = mean(height, na.rm = TRUE)) |&gt; # calculate the mean height
  head() # then just print the first 6 rows for clarity
```

```
## `summarise()` has grouped output by 'species'. You can override using the
## `.groups` argument.
```

```
## # A tibble: 6 Ã— 3
## # Groups:   species [6]
##   species  gender    mean_height
##   &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;
## 1 Aleena   masculine          79
## 2 Besalisk masculine         198
## 3 Cerean   masculine         198
## 4 Chagrian masculine         196
## 5 Clawdite feminine          168
## 6 Droid    feminine           96
```

---

# Bonus: dplyr::ungroup

&lt;img src="img/02/group_by_ungroup.png" width="65%" style="display: block; margin: auto;" /&gt;

Groups are persistent (sort of), `ungroup` removes them

---
class: inverse, center, middle
name: goodies

# Other dplyr goodies for your reference

---

# Other dplyr goodies: count

`count` to get the number of observations:
.pull-left[

```r
starwars |&gt; 
  count(species)
```

```
## # A tibble: 38 Ã— 2
##    species       n
##    &lt;chr&gt;     &lt;int&gt;
##  1 Aleena        1
##  2 Besalisk      1
##  3 Cerean        1
##  4 Chagrian      1
##  5 Clawdite      1
##  6 Droid         6
##  7 Dug           1
##  8 Ewok          1
##  9 Geonosian     1
## 10 Gungan        3
## # â„¹ 28 more rows
```
]

.pull-right[

```r
starwars |&gt; 
  group_by(species) |&gt; summarize(num = n())
```

```
## # A tibble: 38 Ã— 2
##    species     num
##    &lt;chr&gt;     &lt;int&gt;
##  1 Aleena        1
##  2 Besalisk      1
##  3 Cerean        1
##  4 Chagrian      1
##  5 Clawdite      1
##  6 Droid         6
##  7 Dug           1
##  8 Ewok          1
##  9 Geonosian     1
## 10 Gungan        3
## # â„¹ 28 more rows
```
]

---

# Other dplyr goodies: distinct

`distinct` to isolate unique observations:

```r
starwars |&gt; distinct(species)
```

```
## # A tibble: 38 Ã— 1
##    species       
##    &lt;chr&gt;         
##  1 Human         
##  2 Droid         
##  3 Wookiee       
##  4 Rodian        
##  5 Hutt          
##  6 &lt;NA&gt;          
##  7 Yoda's species
##  8 Trandoshan    
##  9 Mon Calamari  
## 10 Ewok          
## # â„¹ 28 more rows
```



---

# Other dplyr goodies: window functions

[Window functions](https://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html) make it easy to get leads and lags, percentiles, cumulative sums, etc.
- These are often used in conjunction with grouped mutates
- See `vignette("window-functions")`

--

&lt;br&gt;

The final set of dplyr "goodies" worth mentioning are the family of join operations, but we'll come back to those later

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%",
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
