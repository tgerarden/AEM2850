---
title: "Mapping data to graphics and amounts"
author: "Todd Gerarden"
output:
  xaringan::moon_reader:
    lib_dir: "libs"
    css: ["xaringan-themer.css", "css/tdg-slides.css"]
#    css: ['default', 'metropolis', 'metropolis-fonts']
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
      ratio: "16:9"
      navigation:
        scroll: false
      # beforeInit: "libs/offline-mathjax.js"
editor_options: 
  chunk_output_type: console
---

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(base_color = "#B31B1B",
                  text_font_size = "1.4rem")
xaringanExtra::use_xaringan_extra(c("tile_view"))
```

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE, 
                      #cache = TRUE,
                      fig.retina = 3, fig.align = "center",
                      fig.width=14, fig.height=7)
```

```{r packages-data, include=FALSE}
library(tidyverse)
library(ggthemes)
library(gapminder)
```

class: center middle main-title section-title-4

# Mapping data to graphics and amounts

.class-info[

**Week 7**

AEM 2850 / 5850 : R for Business Analytics<br>
Cornell Dyson<br>
Spring 2023

Acknowledgements: 
[Andrew Heiss](https://datavizm20.classes.andrewheiss.com), 
[Claus Wilke](https://wilkelab.org/SDS375/),
<!-- [Grant McDermott](https://github.com/uo-ec607/lectures), -->
<!-- [Jenny Bryan](https://stat545.com/join-cheatsheet.html), -->
[Allison Horst](https://github.com/allisonhorst/stats-illustrations)

]

---

# Announcements

Today marks the start of the data visualization component of this course

We will provide details on the group project in the next 1-2 weeks

I will discuss prelim 1 at the end of class today

Questions before we get started?


---

# Plan for Tuesday

[Course progress](#progress)

[Prologue](#prologue)

[Data, aesthetics, & the grammar of graphics](#grammar-of-graphics)

[Grammatical layers](#grammatical-layers)

[Tidy data revisited](#tidy-data)

[Example (time permitting)](#example-1)

<!-- [Plan for Thursday](#amounts-overview) -->


---
class: inverse, center, middle
name: progress

# Course progress

---

# Course objectives reminder

1. Develop basic proficiency in `R` programming
2. Understand data structures and manipulation
3. Describe effective techniques for data visualization and communication
4. Construct effective data visualizations
5. Utilize course concepts and tools for business applications

---

# Where we've been

1. **Develop basic proficiency in `R` programming**
2. **Understand data structures and manipulation**
3. Describe effective techniques for data visualization and communication
4. Construct effective data visualizations
5. Utilize course concepts and tools for business applications

---

# Where we're going next

1. Develop basic proficiency in `R` programming
2. Understand data structures and manipulation
3. **Describe effective techniques for data visualization and communication**
4. **Construct effective data visualizations**
5. Utilize course concepts and tools for business applications

---

# Schedule overview

#### Weeks 1-5: Programming Foundations

#### Weeks 7-10: Data Visualization Foundations

#### Weeks 11+: Special Topics (mix of programming and dataviz)

See [aem2850.toddgerarden.com/schedule](https://aem2850.toddgerarden.com/schedule/) for details


---
class: inverse, center, middle
name: prologue

# Prologue


---

# [Health and wealth](https://www.youtube.com/watch?v=jbkSRLYSojo)

```{r echo=FALSE, out.width='75%'}
knitr::include_graphics("img/07/gapminder-screenshot.png")
```

???

Image source: [Gapminder](https://www.gapminder.org/tools/#$chart-type=bubbles)

[Video](https://www.youtube.com/watch?v=jbkSRLYSojo)


---
class: inverse, center, middle
name: grammar-of-graphics

# Data, aesthetics,<br>& the grammar of graphics

---

# Mapping data to aesthetics

.pull-left.center[

<figure>
  <img src="img/07/gg-book.jpg" alt="ZZZ" title="ZZZ" width="55%">
</figure>

]

.pull-right[

### Data

A column in a dataset

### Aesthetics

Visual properties of a graph

Position, shape, color, etc.

]

---

# Mapping data to aesthetics

.pull-left[
<table>
  <tr>
    <th class="cell-left">Data</th>
    <th class="cell-left">Aesthetic</th>
    <th class="cell-left">Geometry</th>
  </tr>
  <tr>
    <td class="cell-left">Wealth</td>
    <td class="cell-left">Position (x)</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Health</td>
    <td class="cell-left">Position (y)</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Continent</td>
    <td class="cell-left">Color</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Population</td>
    <td class="cell-left">Size</td>
    <td class="cell-left">Point</td>
  </tr>
</table>
]

.pull-right[
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics("img/07/gapminder-screenshot.png")
```
]

---

# Mapping data to aesthetics using ggplot

.pull-left[
<table>
  <tr>
    <th class="cell-left">Data</th>
    <th class="cell-left">Aesthetic</th>
    <th class="cell-left">Geometry</th>
  </tr>
  <tr>
    <td class="cell-left">Wealth</td>
    <td class="cell-left">Position (x)</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Health</td>
    <td class="cell-left">Position (y)</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Continent</td>
    <td class="cell-left">Color</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Population</td>
    <td class="cell-left">Size</td>
    <td class="cell-left">Point</td>
  </tr>
</table>
]

.pull-right[
<table>
  <tr>
    <th class="cell-left">Data</th>
    <th class="cell-left"><code class="remark-inline-code">aes()</code></th>
    <th class="cell-left"><code class="remark-inline-code">geom</code></th>
  </tr>
  <tr>
    <td class="cell-left">Wealth</td>
    <td class="cell-left">?</td>
    <td class="cell-left"><code class="remark-inline-code">geom_point()</code></td>
  </tr>
  <tr>
    <td class="cell-left">Health</td>
    <td class="cell-left">?</td>
    <td class="cell-left">?</td>
  </tr>
  <tr>
    <td class="cell-left">Continent</td>
    <td class="cell-left"><code class="remark-inline-code">color</code></td>
    <td class="cell-left">?</td>
  </tr>
  <tr>
    <td class="cell-left">Population</td>
    <td class="cell-left">?</td>
    <td class="cell-left">?</td>
  </tr>
</table>
]

---

# Mapping data to aesthetics using ggplot

.pull-left[
<table>
  <tr>
    <th class="cell-left">Data</th>
    <th class="cell-left">Aesthetic</th>
    <th class="cell-left">Geometry</th>
  </tr>
  <tr>
    <td class="cell-left">Wealth</td>
    <td class="cell-left">Position (x)</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Health</td>
    <td class="cell-left">Position (y)</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Continent</td>
    <td class="cell-left">Color</td>
    <td class="cell-left">Point</td>
  </tr>
  <tr>
    <td class="cell-left">Population</td>
    <td class="cell-left">Size</td>
    <td class="cell-left">Point</td>
  </tr>
</table>
]

.pull-right[
<table>
  <tr>
    <th class="cell-left">Data</th>
    <th class="cell-left"><code class="remark-inline-code">aes()</code></th>
    <th class="cell-left"><code class="remark-inline-code">geom</code></th>
  </tr>
  <tr>
    <td class="cell-left">Wealth</td>
    <td class="cell-left"><code class="remark-inline-code">x</code></td>
    <td class="cell-left"><code class="remark-inline-code">geom_point()</code></td>
  </tr>
  <tr>
    <td class="cell-left">Health</td>
    <td class="cell-left"><code class="remark-inline-code">y</code></td>
    <td class="cell-left"><code class="remark-inline-code">geom_point()</code></td>
  </tr>
  <tr>
    <td class="cell-left">Continent</td>
    <td class="cell-left"><code class="remark-inline-code">color</code></td>
    <td class="cell-left"><code class="remark-inline-code">geom_point()</code></td>
  </tr>
  <tr>
    <td class="cell-left">Population</td>
    <td class="cell-left"><code class="remark-inline-code">size</code>&emsp;</td>
    <td class="cell-left"><code class="remark-inline-code">geom_point()</code></td>
  </tr>
</table>
]

---

# Barebones `ggplot2::ggplot()` template

```{r show-ggplot-template-0, eval=FALSE}
library(tidyverse) # tidyverse loads the package ggplot2
```

--

We need to specify data, aesthetic mapping, and geometry:
```{r show-ggplot-template-1, eval=FALSE}
ggplot(data = DATA,
       mapping = aes(AESTHETIC MAPPINGS)) +
  GEOM_FUNCTION()
```

--

Or, in the context of a data wrangling pipeline:
```{r show-ggplot-template-2, eval=FALSE}
DATA |> 
  ... |> # intermediate data wrangling (optional)
  ggplot(aes(AESTHETIC MAPPINGS)) +
  GEOM_FUNCTION()
```

---

# Mapping from `gapminder` to aesthetics
```{r gapminder-data, echo=FALSE, warning=FALSE}
gapminder_2007 <- gapminder |> 
  filter(year == 2007) |> 
  select(country, continent, gdpPercap, lifeExp, pop)
```

```{r head-gapminder-mask-1, echo=FALSE}
gapminder_2007 |> 
  slice(1:2) |> 
  mutate_all(as.character) |> 
  bind_rows(tibble(country = "…", continent = "…", gdpPercap = "…", lifeExp = "…", pop = "…")) |> 
  knitr::kable(format = "html", align = "ccccc")
```

```{r gapminder-example-mask-1, eval=FALSE}
_________ |> #<<
  ggplot(aes(x = _________,
             y = _______,
             color = _________,
             size = ___)) +
  geom______() +
  scale_x_log10() + theme_gray(base_size = 20) # ignore this line for now
```

Let's fill in the blanks... how do we start?

---

# Mapping from `gapminder` to aesthetics
```{r head-gapminder-mask-2, echo=FALSE}
gapminder_2007 |> 
  slice(1:2) |> 
  mutate_all(as.character) |> 
  bind_rows(tibble(country = "…", continent = "…", gdpPercap = "…", lifeExp = "…", pop = "…")) |> 
  knitr::kable(format = "html", align = "ccccc")
```

```{r gapminder-example-mask-2, eval=FALSE}
gapminder |> 
  ggplot(aes(x = _________, #<<
             y = _______, #<<
             color = _________,
             size = ___)) +
  geom______() +
  scale_x_log10() + theme_gray(base_size = 20) # ignore this line for now
```

Let's fill in the blanks... what should we map to x? y?

---

# Mapping from `gapminder` to aesthetics
```{r head-gapminder-mask-3, echo=FALSE}
gapminder_2007 |> 
  slice(1:2) |> 
  mutate_all(as.character) |> 
  bind_rows(tibble(country = "…", continent = "…", gdpPercap = "…", lifeExp = "…", pop = "…")) |> 
  knitr::kable(format = "html", align = "ccccc")
```

```{r gapminder-example-mask-3, eval=FALSE}
gapminder |> 
  ggplot(aes(x = gdpPercap,
             y = lifeExp,
             color = _________, #<<
             size = ___)) + #<<
  geom______() +
  scale_x_log10() + theme_gray(base_size = 20) # ignore this line for now
```

Let's fill in the blanks... what should we map to color? size?

---

# Mapping from `gapminder` to aesthetics
```{r head-gapminder-mask-4, echo=FALSE}
gapminder_2007 |> 
  slice(1:2) |> 
  mutate_all(as.character) |> 
  bind_rows(tibble(country = "…", continent = "…", gdpPercap = "…", lifeExp = "…", pop = "…")) |> 
  knitr::kable(format = "html", align = "ccccc")
```

```{r gapminder-example-mask-4, eval=FALSE}
gapminder |> 
  ggplot(aes(x = gdpPercap,
             y = lifeExp,
             color = continent,
             size = pop)) +
  geom______() + #<<
  scale_x_log10() + theme_gray(base_size = 20) # ignore this line for now
```

Let's fill in the blanks... what geometry should we use?

---

# Mapping from `gapminder` to aesthetics
```{r head-gapminder-mask-5, echo=FALSE}
gapminder_2007 |> 
  slice(1:2) |> 
  mutate_all(as.character) |> 
  bind_rows(tibble(country = "…", continent = "…", gdpPercap = "…", lifeExp = "…", pop = "…")) |> 
  knitr::kable(format = "html", align = "ccccc")
```

```{r gapminder-example-mask-5, eval=FALSE}
gapminder |> 
  ggplot(aes(x = gdpPercap,
             y = lifeExp,
             color = continent,
             size = pop)) +
  geom_point() +
  scale_x_log10() + theme_gray(base_size = 20) # ignore this line for now
```

Let's fill in the blanks... what geometry should we use?

---

# Mapping from `gapminder` to aesthetics
```{r head-gapminder, echo=FALSE}
gapminder_2007 |> 
  slice(1:2) |> 
  mutate_all(as.character) |> 
  bind_rows(tibble(country = "…", continent = "…", gdpPercap = "…", lifeExp = "…", pop = "…")) |> 
  knitr::kable(format = "html", align = "ccccc")
```

```{r gapminder-example, eval=FALSE}
gapminder |> 
  ggplot(aes(x = gdpPercap,
             y = lifeExp,
             color = continent,
             size = pop)) +
  geom_point() +
  scale_x_log10() + theme_gray(base_size = 20) # ignore this line for now
```

All done! Let's see what we get...

---

# Health and wealth

```{r show-basic-gapminder, echo=FALSE, fig.width=12, fig.height=5.5, out.width="100%"}
gapminder_2007 |> 
  ggplot(aes(x = gdpPercap,
             y = lifeExp,
             color = continent,
             size = pop)) +
  geom_point() +
  scale_x_log10() + theme_gray(base_size = 20)
# +
#   scale_size_continuous(range = c(1, 15),
#                         labels = scales::comma)
```

---
class: inverse, center, middle
name: grammatical-layers

# Grammatical layers

---

# Grammar components as layers

.pull-left[
So far we know about data, aesthetics, and geometries

Think of these components as **layers**

Add them to foundational `ggplot()` with `+`
]

.pull-right[

&nbsp;

![](img/07/ggplot-layers-short@4x.png)
]

???

Layer analogy borrowed from [Thomas Lin Pedersen](https://www.data-imaginist.com/) and his ["Drawing Anything with ggplot2" workshop](https://github.com/thomasp85/ggplot2_workshop).

---

# Possible aesthetics

.pull-left-3.center[

`color` (discrete)

```{r aes-color-discrete, echo=FALSE, fig.dim=c(4, 2), out.width="100%"}
eg <- tribble(
  ~x, ~y, ~size, ~x1,
  "A", 1, 5, 1,
  "B", 1, 10, 2,
  "C", 1, 15, 3
)

# Color, discrete
ggplot(eg, aes(x = x, y = y, color = x)) +
  geom_point(size = 30) +
  guides(color = "none") +
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank())
```

`color` (continuous)

```{r aes-color-continuous, echo=FALSE, fig.dim=c(4, 2), out.width="100%"}
# Color, continuous
ggplot(eg, aes(x = x1, y = y, color = x1)) +
  geom_point(size = 30) +
  guides(color = "none") +
  coord_cartesian(xlim = c(0.5, 3.5)) +
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank())
```
]

.pull-middle-3.center[

`size`

```{r aes-size, echo=FALSE, fig.dim=c(4, 2), out.width="100%"}
# Size
ggplot(eg, aes(x = x, y = y, size = x)) +
  geom_point() +
  scale_size_discrete(range = c(2, 30)) +
  guides(size = "none") +
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank())
```

`fill`

```{r aes-fill, echo=FALSE, fig.dim=c(4, 2), out.width="100%"}
# Fill
ggplot(eg, aes(x = x, y = y, fill = x)) +
  geom_point(size = 30, pch = 21, stroke = 5) +
  guides(fill = "none") +
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank())
```
]

.pull-right-3.center[

`shape`

```{r aes-shape, echo=FALSE, fig.dim=c(4, 2), out.width="100%"}
# Shape
ggplot(eg, aes(x = x, y = y, shape = x)) +
  geom_point(size = 30) +
  guides(shape = "none") +
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank())
```

`alpha` (opacity)

```{r aes-alpha, echo=FALSE, fig.dim=c(4, 2), out.width="100%"}
# Alpha
ggplot(eg, aes(x = x, y = y, alpha = x)) +
  geom_point(size = 30) +
  guides(alpha = "none") +
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank())
```
]

---

# Possible geoms

<table>
  <tr>
    <th class="cell-left"></th>
    <th class="cell-left">Example geom</th>
    <th class="cell-left">What it makes</th>
  </tr>
  <tr>
    <td class="cell-left"><img src="img/07/geom_bar.png"></td>
    <td class="cell-left"><code class="remark-inline-code">geom_col()</code></td>
    <td class="cell-left">Bar charts</td>
  </tr>
  <tr>
    <td class="cell-left"><img src="img/07/geom_text.png"></td>
    <td class="cell-left"><code class="remark-inline-code">geom_text()</code></td>
    <td class="cell-left">Text</td>
  </tr>
  <tr>
    <td class="cell-left"><img src="img/07/geom_point.png"></td>
    <td class="cell-left"><code class="remark-inline-code">geom_point()</code></td>
    <td class="cell-left">Points</td>
  </tr>
  <tr>
    <td class="cell-left"><img src="img/07/geom_boxplot.png"></td>
    <td class="cell-left"><code class="remark-inline-code">geom_boxplot()</code>&emsp;</td>
    <td class="cell-left">Boxplots</td>
  </tr>
  <tr>
    <td class="cell-left"><img src="img/07/geom_sf.png"></td>
    <td class="cell-left"><code class="remark-inline-code">geom_sf()</code></td>
    <td class="cell-left">Maps</td>
  </tr>
</table>

---

# Possible geoms

There are dozens of possible geoms

Over the next several weeks we will cover a number of them

See [the **ggplot2** documentation](https://ggplot2.tidyverse.org/reference/index.html#section-layer-geoms) for examples of all the different geom layers

---

# Additional layers

.pull-left[
There are many other grammatical layers we can use to describe graphs!

We can sequentially add layers to the foundational `ggplot()` plot to create complex figures

I will give you a quick preview, don't worry about all the details for now
]

.pull-right[
![](img/07/ggplot-layers@4x.png)
]

---

# Scales

Scales change the properties of the variable mapping

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_x_continuous()</code></td>
    <td class="cell-left">Make the x-axis continuous</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_x_continuous(breaks = 1:5)&ensp;</code></td>
    <td class="cell-left">Manually specify axis ticks</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_x_log10()</code></td>
    <td class="cell-left">Log the x-axis</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_color_gradient()</code></td>
    <td class="cell-left">Use a gradient</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">scale_fill_viridis_d()</code></td>
    <td class="cell-left">Fill with discrete viridis colors</td>
  </tr>
</table>

---

# Scales

.pull-left[

.center[`scale_x_log10()`]

```{r scale-example-1, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10()
```
]

--

.pull-right[

.center[`scale_color_viridis_d()`]

```{r scale-example-2, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() +
  scale_color_viridis_d()
```
]

---

# Facets

Facets show subplots for different subsets of data

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(vars(continent))</code></td>
    <td class="cell-left">Plot for each continent</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(vars(continent, year))</code>&emsp;</td>
    <td class="cell-left">Plot for each continent/year</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(..., ncol = 1)</code></td>
    <td class="cell-left">Put all facets in one column</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">facet_wrap(..., nrow = 1)</code></td>
    <td class="cell-left">Put all facets in one row</td>
  </tr>
</table>

---

# Facets

.pull-left[

.center.small[`facet_wrap(vars(continent))`]

```{r facet-example-1, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() +
  facet_wrap(vars(continent))
```
]

--

.pull-right[

.center.small[`facet_wrap(vars(continent, year))`]

```{r facet-example-2, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(filter(gapminder, year %in% c(2002, 2007)), 
       aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() +
  facet_wrap(vars(year, continent), nrow = 2)
```
]

---

# Coordinates

Change the coordinate system

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">coord_cartesian(ylim = c(1, 10))</code>&emsp;</td>
    <td class="cell-left">Zoom in where y is 1–10</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">coord_flip()</code></td>
    <td class="cell-left">Switch x and y</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">coord_polar()</code></td>
    <td class="cell-left">Use polar coordinates</td>
  </tr>
</table>

---

# Coordinates

.pull-left[

.center.small[`coord_cartesian(ylim = c(70, 80), xlim = c(10000, 30000))`]

```{r coord-example-1, echo=FALSE, fig.dim=c(4.8, 3.25), out.width="100%"}
ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() +
  coord_cartesian(ylim = c(70, 80), xlim = c(10000, 30000))
```
]

--

.pull-right[

.center.small[`coord_flip()`]

```{r coord-example-2, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() + 
  coord_flip()
```
]

---

# Labels

Add labels to the plot with a single `labs()` layer

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(title = "Neat title")</code></td>
    <td class="cell-left">Title</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(caption = "Something")</td>
    <td class="cell-left">Caption</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(y = "Something")</td>
    <td class="cell-left">y-axis</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">labs(size = "Population")</code></td>
    <td class="cell-left">Title of size legend</td>
  </tr>
</table>

---

# Labels

.left-code[
```{r labels-example, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(gapminder_2007, 
       aes(x = gdpPercap, y = lifeExp, 
           color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() +
  labs(title = "Health and wealth go together",
       subtitle = "Data from 2007",
       x = "Wealth (GDP per capita)",
       y = "Health (life expectancy)",
       color = "Continent",
       size = "Population",
       caption = "Source: The Gapminder Project")
```
]

.right-plot[
![](`r knitr::fig_chunk("labels-example", "png")`)
]

---

# Theme

`theme()` can be used to change the appearance of anything in a plot

Lots of themes built in and available from other packages

<table>
  <tr>
    <th class="cell-left">Example layer</th>
    <th class="cell-left">What it does</th>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">theme_grey()</code></td>
    <td class="cell-left">Default grey background</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">theme_bw()</td>
    <td class="cell-left">Black and white</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">theme_dark()</td>
    <td class="cell-left">Dark</td>
  </tr>
  <tr>
    <td class="cell-left"><code class="remark-inline-code">theme_minimal()</code></td>
    <td class="cell-left">Minimal</td>
  </tr>
</table>

---

# Theme

.pull-left[

.center.small[`theme_dark()`]

```{r theme-example-1, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() +
  theme_dark()
```
]

--

.pull-right[

.center.small[`theme_minimal()`]

```{r theme-example-2, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +
  geom_point() +
  scale_x_log10() + 
  theme_minimal()
```
]

---

# Theme

There are collections of pre-built themes online, like [the **ggthemes** package](https://jrnold.github.io/ggthemes/)

.center[
<figure>
  <img src="img/07/ggthemes.png" alt="ggthemes" title="ggthemes" width="55%">
</figure>
]

---

# Theme

Organizations often make their own custom themes, like [the BBC](https://bbc.github.io/rcookbook/)

.center[
<figure>
  <img src="img/07/bbc-cookbook.png" alt="ggthemes" title="ggthemes" width="80%">
</figure>
]

---

# Theme

Make individual theme adjustments with `theme()`

```{r example-theme-options, eval=FALSE, tidy=FALSE}
theme_bw() + 
theme(legend.position = "bottom",
      plot.title = element_text(face = "bold"),
      panel.grid = element_blank(),
      axis.title.y = element_text(face = "italic"))
```

---

# So many possibilities!

.pull-left[
![](img/07/ggplot-layers@4x.png)
]

.pull-right[
These were just a few examples

See [the **ggplot2** documentation](https://ggplot2.tidyverse.org/reference/index.html) for examples of everything you can do
]

---

# A true grammar

.pull-left[
You have probably made graphics in Excel by searching through menus for a specific chart type, and then reshaping your data to work with it

With the grammar of graphics, we don't talk about specific chart **types**
]

.pull-right[
.center[
<figure>
  <img src="img/07/excel-chart-types.png" alt="Excel chart types" title="Excel chart types" width="85%">
</figure>
]
]

---

# A true grammar

.pull-left[
With the grammar of graphics, we talk about specific chart **elements**

- .small[Map a column to the x-axis, fill by a variable, `geom_col()` to get stacked bars]

- .small[Geoms can be interchangable (e.g., `geom_violin()` and `geom_boxplot()`)]

This grammar is portable to other software like Tableau, which is [built on the grammar of graphics](https://www.tableau.com/about/blog/2015/4/getting-know-lee-wilkinson-tableaus-new-vp-statistics-38654)
]

.pull-right[
![](img/07/ggplot-layers@4x.png)
]

---

# Describing graphs with the grammar

.left-code[
.box-2.small[Map wealth to the x-axis, health to the y-axis, add points, color by continent, size by population, scale the y-axis with a log, and facet by year]

```{r describe-1, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(data = filter(gapminder, year %in% c(2002, 2007)), 
       mapping = aes(x = gdpPercap,
                     y = lifeExp,
                     color = continent,
                     size = pop)) +
  geom_point() +
  scale_x_log10() + 
  facet_wrap(vars(year), ncol = 1)
```
]

.right-plot[
![](`r knitr::fig_chunk("describe-1", "png")`)
]

---

# Describing graphs with the grammar

.left-code[
.box-2.small[Map health to the x-axis, add a histogram with bins for every 5 years, fill and facet by continent]

```{r describe-2, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(data = gapminder_2007, 
       mapping = aes(x = lifeExp,
                     fill = continent)) +
  geom_histogram(binwidth = 5, 
                 color = "white") +
  guides(fill = "none") +  # Turn off legend
  facet_wrap(vars(continent))
```
]

.right-plot[
![](`r knitr::fig_chunk("describe-2", "png")`)
]

---

# Describing graphs with the grammar

.left-code[
.box-2.small[Map continent to the x-axis, health to the y-axis, add boxplots, fill by continent]

```{r describe-3, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(data = gapminder, 
       mapping = aes(x = continent,
                     y = lifeExp,
                     fill = continent)) +
  geom_boxplot() +
  guides(fill = "none")  # Turn off legend
```
]

.right-plot[
![](`r knitr::fig_chunk("describe-3", "png")`)
]

---

# Describing graphs with the grammar

.left-code[
.box-2.small[Map continent to the x-axis, health to the y-axis, add violin plots, fill by continent]

```{r describe-4, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(data = gapminder, 
       mapping = aes(x = continent,
                     y = lifeExp,
                     fill = continent)) +
  geom_violin() + # we only had to change this! #<<
  guides(fill = "none")  # Turn off legend
```
]

.right-plot[
![](`r knitr::fig_chunk("describe-4", "png")`)
]

---
class: inverse, center, middle
name: tidy-data

# Tidy data revisited

---

# Tidy data revisited

`ggplot()` is incredibly flexible

For `ggplot()` to work its magic, your data frame needs to be **tidy**

This requires a bit of upfront work, but it pays off

We never had to modify `gapminder` to make all those different plots!

---

```{r echo=FALSE, out.width='100%'}
knitr::include_graphics("img/07/tidydata_7.jpg")
```


---
class: inverse, center, middle
name: example-1

# example-07:<br>mapping-data-to-graphics-practice.R


---

# Putting it all together

In the example, we'll build a plot sequentially to see how each grammatical layer changes its appearance

The rest of this section presents that code and output in slide form

For illustrative purposes, let's use data on cars from the data frame `ggplot2::mpg`

```{r head-mpg, echo=FALSE}
mpg |> 
  filter(manufacturer=="volkswagen") |> 
  slice(1:2) |> 
  select(manufacturer, model, year, trans, displ, hwy, drv) |> 
  mutate_all(as.character) |> 
  bind_rows(tibble(manufacturer = "…", model = "…", year = "…", trans = "…", displ = "…", hwy = "…", drv = "…")) |> 
  knitr::kable(format = "html")
```

---

.left-code[
### Start with data and aesthetics

```{r mpg-layers-1, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,                              #<<
       aes(x = displ, # engine displacement     #<<
           y = hwy, # highway mpg               #<<
           color = drv))  # type of drive train #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-1", "png")`)
]

---

.left-code[
### Add a point geom

```{r mpg-layers-2, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-2", "png")`)
]

---

.left-code[
### Add a smooth geom

```{r mpg-layers-3, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth() #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-3", "png")`)
]

---

.left-code[
### Make it straight

```{r mpg-layers-4, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth(method = "lm") #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-4", "png")`)
]

---

.left-code[
### Use a viridis color scale

```{r mpg-layers-5, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_viridis_d() #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-5", "png")`)
]

---

.left-code[
### Facet by drive train type

```{r mpg-layers-6, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_viridis_d() +
  facet_wrap(vars(drv), ncol = 1) #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-6", "png")`)
]

---

.left-code[
### Add labels

```{r mpg-layers-7, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_viridis_d() +
  facet_wrap(vars(drv), ncol = 1) +
  labs(x = "Displacement", y = "Highway MPG",  #<<
       color = "Drive",   #<<
       title = "Larger engines use more fuel",  #<<
       subtitle = "Displacement measures engine size")  #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-7", "png")`)
]

---

.left-code[
### Add a theme

```{r mpg-layers-8, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg,
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_viridis_d() +
  facet_wrap(vars(drv), ncol = 1) +
  labs(x = "Displacement", y = "Highway MPG",
       color = "Drive",
       title = "Larger engines use more fuel",
       subtitle = "Displacement measures engine size") +
  theme_bw() #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-8", "png")`)
]

---

.left-code[
### Modify the theme

```{r mpg-layers-9, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg, 
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_viridis_d() +
  facet_wrap(vars(drv), ncol = 1) +
  labs(x = "Displacement", y = "Highway MPG",
       color = "Drive",
       title = "Larger engines use more fuel",
       subtitle = "Displacement measures engine size") +
  theme_bw() +
  theme(legend.position = "bottom", #<<
        plot.title = element_text(face = "bold")) #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-9", "png")`)
]

---

.left-code[
### Finished!

```{r mpg-layers-finished, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 5), out.width="100%"}
ggplot(data = mpg, 
       mapping = aes(x = displ,
                     y = hwy,
                     color = drv)) +
  geom_point() +
  geom_smooth(method = "lm") + 
  scale_color_viridis_d() +
  facet_wrap(vars(drv), ncol = 1) +
  labs(x = "Displacement", y = "Highway MPG",
       color = "Drive",
       title = "Larger engines use more fuel",
       subtitle = "Displacement measures engine size") +
  theme_bw() +
  theme(legend.position = "bottom",
        plot.title = element_text(face = "bold"))
```
]

.right-plot[
![](`r knitr::fig_chunk("mpg-layers-finished", "png")`)
]

