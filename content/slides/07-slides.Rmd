---
title: "Distributions"
author: "Todd Gerarden"
output:
  xaringan::moon_reader:
    lib_dir: "libs"
    css: ["xaringan-themer.css", "css/tdg-slides.css"]
#    css: ['default', 'metropolis', 'metropolis-fonts']
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
      ratio: "16:9"
      navigation:
        scroll: false
      # beforeInit: "libs/offline-mathjax.js"
editor_options: 
  chunk_output_type: console
---

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(base_color = "#B31B1B",
                  text_font_size = "1.4rem")
xaringanExtra::use_xaringan_extra(c("tile_view"))
```

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE, 
                      #cache = TRUE,
                      fig.retina = 3, fig.align = "center",
                      fig.width=14, fig.height=7)
```

```{r packages-data, include=FALSE}
library(tidyverse)
```

class: center middle main-title section-title-4

# Distributions

.class-info[

**Week 7**

AEM 2850 / 5850 : R for Business Analytics<br>
Cornell Dyson<br>
Spring 2023

Acknowledgements: 
[Andrew Heiss](https://datavizm20.classes.andrewheiss.com), 
[Claus Wilke](https://wilkelab.org/SDS375/)
<!-- [Grant McDermott](https://github.com/uo-ec607/lectures), -->
<!-- [Jenny Bryan](https://stat545.com/join-cheatsheet.html), -->
<!-- [Allison Horst](https://github.com/allisonhorst/stats-illustrations) -->

]

---

# Announcements

This week we are back to our old routine:
- Today: slides
- Wednesday: reflection is due
- Thursday: work through an example
- Monday: next lab is due

First: discuss survey resonses and mini project 1

Questions before we get started?


---

# Plan for today

[Prologue](#prologue)

[Mini Project 1](#mini-project-1)

[Proportions: a brief interlude](#proportions)

[Distributions](#distributions)

---
class: inverse, center, middle
name: prologue

# Prologue

```{r read-survey-responses, include=FALSE}
# load data
survey <- read_csv("data/survey-responses-midsemester/survey_responses.csv")
summary_questions <- survey %>% 
  select(id, contains(":"))
names(summary_questions) <- str_replace( names(summary_questions), ".*: ", "")

# make a function for plotting responses
```

---

# Thank you!

I read all the Reflection - Week 6 survey responses

I will briefly summarize some of the responses and share some reactions

Please don't hesitate to provide feedback on how the course progresses!

---

# Please rate the pace overall:

```{r, echo=FALSE}
summary_questions %>% 
  ggplot(aes(x = fct_relevel(`Please rate the pace overall:`,
                                "too slow", "about right", "too fast")
                                )) +
  geom_bar() +
  labs(x = NULL,
       y = "number of students") +
  theme_xaringan()
```


---

# Please rate the difficulty overall:

```{r, echo=FALSE}
summary_questions %>% 
  ggplot(aes(x = fct_relevel(`Please rate the difficulty overall:`,
                                "too easy", "about right", "too difficult")
                                )) +
  geom_bar() +
  labs(x = NULL,
       y = "number of students") +
  theme_xaringan()
```


---

# Please rate the workload overall:

```{r, echo=FALSE}
summary_questions %>% 
  group_by(`Please rate the workload overall:`) %>% count() %>% ungroup() %>% 
  add_row(`Please rate the workload overall:` = "too little", n = 0) %>% 
  ggplot(aes(x = fct_relevel(`Please rate the workload overall:`,
                                "too little", "about right", "too much"),
             y = n)) +
  geom_col() +
  labs(x = NULL,
       y = "number of students") +
  theme_xaringan()
```


---

# RStudio Cloud versus a local install?

```{r, echo=FALSE}
summary_questions %>% 
  rename(preference = contains("preference")) %>% 
  ggplot(aes(x = preference)) +
  geom_bar() +
  labs(x = NULL,
       y = "number of students") +
  theme_xaringan()
```


---

# Some themes:

**Desire for more business applications**
- We will work on this, especially on projects

--

**Several people requested guidance on installing/working locally**
- I will post some basic guidance on the course site
- Come to office hours if you want help installing R+RStudio!

--

**Examples: make them more open-ended/challenging + work more as a group**
- I will experiment with this!

--

**Interest in modeling, statistical methods, linear regression, etc.**

---
class: inverse, center, middle
name: mini-project-1

# Mini Project 1

---

# Mini Project 1

Use R and the tidyverse to wrangle and visualize equities data

#### Three parts:
1. AAPL
2. The S&P 500
3. Our Class Portfolio

```{r load-project-data, include=FALSE}
load("../../rstudio-cloud/mini-project-01/sp500.RData")
our_companies <- read_csv("../../rstudio-cloud/mini-project-01/our-companies.csv")
```

---

# Mini Project 1: data

```{r}
sp500_companies
```

---

# Mini Project 1: data

```{r}
sp500_prices
```

---

# Mini Project 1: data

```{r}
our_companies
```

---

# Mini Project 1: logistics

Work in groups of 3 (posted on canvas)

Write report in R Markdown that summarizes your work, presents visualizations, and discusses takeaways

Do not use any packages outside base R and the tidyverse

No TA help for Part 3!
- If you try but still need help, come to my office hours

---
class: inverse, center, middle
name: proportions

# Proportions: a brief interlude

---

# Can we improve this survey visualization?

```{r, echo=FALSE}
summary_questions %>% 
  rename(preference = contains("preference")) %>% 
  ggplot(aes(x = preference)) +
  geom_bar() +
  labs(x = NULL,
       y = "number of students") +
  theme_xaringan()
```


---

# Proportions

.pull-left[
```{r, echo=FALSE}
summary_questions %>% 
  rename(preference = contains("preference")) %>% 
  group_by(preference) %>% count() %>% 
  ggplot(aes(x = n, y = "", fill = fct_rev(preference))) +
  geom_col() +
  coord_polar() +
  scale_x_continuous(
    name = NULL, breaks = NULL
  ) +
  scale_xaringan_fill_discrete(direction = -1) +
  labs(x = NULL,
       y = NULL,
       fill = NULL) +
  theme_xaringan(text_font_size = 50)
```
]

.pull-right[
```{r, echo=FALSE}
summary_questions %>% 
  rename(preference = contains("preference")) %>% 
  ggplot(aes(x = "", fill = preference)) +
  geom_bar(position = "fill") +
  coord_flip() +
  scale_xaringan_fill_discrete() +
  guides(fill = guide_legend(reverse = TRUE)) +
  labs(x = NULL,
       y = "share of students",
       fill = NULL) +
  theme_xaringan(text_font_size = 50) +
  theme(axis.title.x = element_text(size = 44)) +
  theme(legend.position = "bottom")
```
]

---

# Pros and cons of different approaches

.small.center[
               | Pie chart | Stacked bars | Side-by-side bars
:----------    | :-------: | :----------: | :---------------:
Allows easy comparison of relative proportions   | ✖ | ✖ | ✔ 
]

---

# Pros and cons of different approaches

.small.center[
               | Pie chart | Stacked bars | Side-by-side bars
:----------    | :-------: | :----------: | :---------------:
Allows easy comparison of relative proportions   | ✖ | ✖ | ✔ 
Shows data as proportions of a whole             | ✔ | ✔ | ✖
]

---

# Pros and cons of different approaches

.small.center[
               | Pie chart | Stacked bars | Side-by-side bars
:----------    | :-------: | :----------: | :---------------:
Allows easy comparison of relative proportions   | ✖ | ✖ | ✔ 
Shows data as proportions of a whole             | ✔ | ✔ | ✖
Emphasizes simple fractions (1/2, 1/3, ...) | ✔ | ✖ | ✖
]

---

# Pros and cons of different approaches

.small.center[
               | Pie chart | Stacked bars | Side-by-side bars
:----------    | :-------: | :----------: | :---------------:
Allows easy comparison of relative proportions   | ✖ | ✖ | ✔ 
Shows data as proportions of a whole             | ✔ | ✔ | ✖
Emphasizes simple fractions (1/2, 1/3, ...) | ✔ | ✖ | ✖
Visually appealing for small datasets | ✔ | ✖ | ✔
]


---

# Pros and cons of different approaches

.small.center[
               | Pie chart | Stacked bars | Side-by-side bars
:----------    | :-------: | :----------: | :---------------:
Allows easy comparison of relative proportions   | ✖ | ✖ | ✔ 
Shows data as proportions of a whole             | ✔ | ✔ | ✖
Emphasizes simple fractions (1/2, 1/3, ...) | ✔ | ✖ | ✖
Visually appealing for small datasets | ✔ | ✖ | ✔
Works well for a large number of subsets | ✖ | ✖ | ✔ 
]

---

# Pros and cons of different approaches

.small.center[
               | Pie chart | Stacked bars | Side-by-side bars
:----------    | :-------: | :----------: | :---------------:
Allows easy comparison of relative proportions   | ✖ | ✖ | ✔ 
Shows data as proportions of a whole             | ✔ | ✔ | ✖
Emphasizes simple fractions (1/2, 1/3, ...) | ✔ | ✖ | ✖
Visually appealing for small datasets | ✔ | ✖ | ✔
Works well for a large number of subsets | ✖ | ✖ | ✔ 
Works well for time series and similar | ✖ | ✔ | ✖
]

--

No one visualization fits all scenarios!

[//]: # "segment ends here"


---

class: inverse, center, middle
name: distributions

# Distributions

```{r, include=FALSE}
theme_xaringan_restore_defaults() # revert to ggplot2 defaults for remainder
theme_set(theme_gray(base_size = 18)) # increase base text size
```

---

# Problems with single numbers
  
.pull-left[

```{r animal-weight-bar, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
set.seed(1234)
animals <- tibble(animal = c(rep(c("Small cat", "Big cat"), each = 250), rep("Dog", 500))) %>% 
  mutate(weight = case_when(
    animal == "Small cat" ~ rnorm(n(), 20, 5),
    animal == "Big cat" ~ rnorm(n(), 60, 5),
    animal == "Dog" ~ rnorm(n(), 40, 10)
  )) %>% 
  mutate(animal_type = ifelse(str_detect(animal, "cat"), "Cats", "Dogs"))

animals_mean <- animals %>% 
  group_by(animal_type) %>% 
  summarize(avg_weight = mean(weight))

ggplot(animals_mean, aes(x = animal_type, y = avg_weight, fill = animal_type)) + 
  geom_col() +
  labs(x = NULL, y = "Weight") +
  ylim(0, 75) +
  guides(fill = "none")
```
  
]

--
  
.pull-right[
  
```{r animal-weight-points, echo=FALSE, fig.dim=c(4.8, 3.75), out.width="100%"}
ggplot(animals, aes(x = animal_type, y = weight, color = animal_type)) +
  geom_point(position = position_jitter(height = 0), size = 1) +
  stat_summary(geom = "point", fun = "mean", size = 5, color = "darkred") +
  labs(x = NULL, y = "Weight") +
  guides(color = "none")
```
]

---
  
# More information is (almost) always better
  
**Avoid visualizing single numbers when you have a whole range or distribution of numbers**

--
  
Uncertainty in single variables

--
  
Uncertainty across multiple variables

--
  
Uncertainty in models and simulations

---

# Histograms

What are they?

--

Put data into equally spaced buckets (or "bins"), plot how many rows are in each bucket

---
  
# Histograms

How would we use the grammar of graphics to make a histogram of `lifeExp`?

```{r basic-histogram-data}
library(gapminder)

gapminder_2002 <- gapminder %>% 
  filter(year == 2002)

head(gapminder_2002)
```

---
  
# Histograms

.left-code[
```{r basic-histogram, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3), out.width="100%"}
ggplot(gapminder_2002,
       aes(x = lifeExp)) + #<<
  geom_histogram() #<<
```

What if we mapped lifeExp to y?
]

.right-plot[
  ![](`r knitr::fig_chunk("basic-histogram", "png")`)
]


---
  
# Histograms

.left-code[
```{r basic-histogram-y, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3), out.width="100%"}
ggplot(gapminder_2002,
       aes(y = lifeExp)) + #<<
  geom_histogram()
```
]

.right-plot[
  ![](`r knitr::fig_chunk("basic-histogram-y", "png")`)
]


---
  
# Histograms: bin width
  
No official rule for what makes a good bin width

.pull-left-3[
.center.small[Too narrow:]

.center.tiny[`geom_histogram(binwidth = .2)`]

```{r hist-too-narrow, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_histogram(binwidth = 0.2)
```
  
]

--
  
.pull-middle-3[
.center.small[Too wide:]

.center.tiny[`geom_histogram(binwidth = 50)`]

```{r hist-too-wide, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_histogram(binwidth = 50)
```
]

--
  
.pull-right-3[
.center.small[(One type of) just right:]

.center.tiny[`geom_histogram(binwidth = 5)`]
  
```{r hist-just-right, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_histogram(binwidth = 5)
```
]

---
  
# Histogram tips

.pull-left[
.center[Add a border to the bars<br>for readability]

.center.tiny[`geom_histogram(..., color = "white")`]
    
```{r hist-border, echo=FALSE, fig.dim=c(4.5, 3), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_histogram(binwidth = 5, color = "white")
```
]

--
  
.pull-right[
.center.small[Set the boundary;<br>bucket now 50–55, not 47.5–52.5]

.center.tiny[`geom_histogram(..., boundary = 50)`]

```{r hist-boundary, echo=FALSE, fig.dim=c(4.5, 3), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_histogram(binwidth = 5, color = "white", boundary = 50)
```

]

---
  
# Density plots
  
What are they?

--

Estimates of the **probability *density* function** of a random variable

--

Histograms show raw counts; density plots show proportions (integrate to 1)

--

How would we use the grammar of graphics to make a density plot of `lifeExp`?

---
  
# Density plots
  
.left-code[
```{r basic-density, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3), out.width="100%"}
ggplot(gapminder_2002,
       aes(x = lifeExp)) + #<<
  geom_density() #<<
```
]

.right-plot[
  ![](`r knitr::fig_chunk("basic-density", "png")`)
]

---
  
# Density plots: add some color
  
.left-code[
```{r basic-density-color, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3), out.width="100%"}
ggplot(gapminder_2002,
       aes(x = lifeExp)) +
  geom_density(fill = "skyblue") #<<
```

Reminder: we can use aesthetics as parameters inside a geom rather than inside an **aes()** statement

Here we used **fill = "skyblue"**
]

.right-plot[
  ![](`r knitr::fig_chunk("basic-density-color", "png")`)
]

---
  
# Density plots: bandwidths

Different options for calculus change the plot shape

.pull-left-3[
.center.small[`bw = 1`]

```{r gaussian-bw-1, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_density(fill = "skyblue",
               kernel = "gaussian", bw = 1)
```
  
]

--
  
.pull-middle-3[
.center.small[`bw = 10`]

```{r gaussian-bw-10, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_density(fill = "skyblue",
               kernel = "gaussian", bw = 10)
```
]

--
  
.pull-right-3[
.center.small[`bw = "nrd0"` <small>(default)</small>]
    
```{r gaussian-bw-auto, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_density(fill = "skyblue",
               kernel = "gaussian")
```
]

---
  
# Density plots: kernels
  
Different options for calculus change the plot shape

.pull-left-3[
.center.small[`kernel = "gaussian"`]

```{r gaussian-kernel-gaussian, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_density(fill = "skyblue",
               kernel = "gaussian")
```
  
]

--
  
.pull-middle-3[
.center.small[`"epanechnikov"`]

```{r gaussian-kernel-epanechnikov, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_density(fill = "skyblue",
               kernel = "epanechnikov")
```
]

--
  
.pull-right-3[
.center.small[`"rectangular"`]

```{r gaussian-kernel-rectangular, echo=FALSE, fig.dim=c(4.5, 4.2), out.width="100%"}
ggplot(gapminder_2002, aes(x = lifeExp)) +
  geom_density(fill = "skyblue",
               kernel = "rectangular")
```
]

---
  
# Box plots

What are they?

--

Graphical representations of specific points in a distribution


---
  
# Box plots
  
```{r boxplot-explanation, echo=FALSE, fig.width=8, fig.height=3.5, out.width="100%"}
hwy_50 <- quantile(mpg$hwy, 0.5)
hwy_25 <- quantile(mpg$hwy, 0.25)
hwy_75 <- quantile(mpg$hwy, 0.75)
hwy_iqr <- hwy_75 - hwy_25

# Technically this should just be hwy_75 + 1.5 * IQR, but ggplot does odd things
# with small datasets
hwy_min <- boxplot.stats(mpg$hwy)$stats[1]
hwy_max <- boxplot.stats(mpg$hwy)$stats[5]

hwy_out <- boxplot.stats(mpg$hwy)$out

ggplot(mpg, aes(x = hwy)) +
  geom_boxplot(fill = "#F7F7F7", color = "#B31B1B") +
  annotate(geom = "text", x = hwy_50, y = 0.48, label = "Median", fontface = "bold") +
  annotate(geom = "segment", x = hwy_50, xend = hwy_50, y = 0.44, yend = 0.4,
           arrow = arrow(length = unit(0.3, "lines"))) +
  annotate(geom = "text", x = hwy_25, y = 0.48, label = "25%", fontface = "bold") +
  annotate(geom = "segment", x = hwy_25, xend = hwy_25, y = 0.44, yend = 0.4,
           arrow = arrow(length = unit(0.3, "lines"))) +
  annotate(geom = "text", x = hwy_75, y = 0.48, label = "75%", fontface = "bold") +
  annotate(geom = "segment", x = hwy_75, xend = hwy_75, y = 0.44, yend = 0.4,
           arrow = arrow(length = unit(0.3, "lines"))) +
  annotate(geom = "text", x = hwy_25 + 0.5 * hwy_iqr, y = -0.52, 
           label = "Interquartile range (IQR)", fontface = "bold") +
  annotate(geom = "segment", x = c(hwy_25, hwy_75), xend = c(hwy_25, hwy_75), 
           y = -0.46, yend = -0.4, arrow = arrow(length = unit(0.3, "lines"))) +
  annotate(geom = "segment", x = hwy_25, xend = hwy_75, y = -0.46, yend = -0.46) +
  annotate(geom = "text", x = hwy_min, y = 0.15, label = "Minimum\n25% − (1.5 × IQR)",
           hjust = 0, lineheight = 1, fontface = "bold") +
  annotate(geom = "segment", x = hwy_min, xend = hwy_min, y = 0.06, yend = 0.02,
           arrow = arrow(length = unit(0.3, "lines"))) +
  annotate(geom = "text", x = hwy_max, y = 0.15, label = "Maximum\n75% + (1.5 × IQR)",
           hjust = 1, lineheight = 1, fontface = "bold") +
  annotate(geom = "segment", x = hwy_max, xend = hwy_max, y = 0.06, yend = 0.02,
           arrow = arrow(length = unit(0.3, "lines")))  +
  annotate(geom = "text", x = min(hwy_out) + 0.5 * (max(hwy_out) - min(hwy_out)), y = -0.16, 
           label = "Outliers", fontface = "bold") +
  annotate(geom = "segment", x = c(min(hwy_out), max(hwy_out)), xend = c(min(hwy_out), max(hwy_out)), 
           y = -0.1, yend = -0.04, arrow = arrow(length = unit(0.3, "lines"))) +
  annotate(geom = "segment", x = min(hwy_out), xend = max(hwy_out),
           y = -0.1, yend = -0.1) +
  labs(x = "Highway MPG") +
  theme_minimal() +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
```

---
  
# Box plots

What are they?

Show specific points in a distribution

How would we use the grammar of graphics to make a boxplot of `lifeExp`?

---
  
# Box plots

.left-code[
```{r basic-boxplot, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 2.75), out.width="100%"}
  ggplot(gapminder_2002,
         aes(x = lifeExp)) + #<<
    geom_boxplot() #<<
```

What do the y axis numbers mean?
]

.right-plot[
  ![](`r knitr::fig_chunk("basic-boxplot", "png")`)
]

---
  
# Box plots

Use `theme()` to customize the plot for this geom

.left-code[
```{r basic-boxplot-no-y, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 2.75), out.width="100%"}
  ggplot(gapminder_2002,
         aes(x = lifeExp)) +
    geom_boxplot() +
  theme(axis.text.y = element_blank(), #<<
        axis.ticks.y = element_blank(), #<<
        panel.grid.major.y = element_blank(), #<<
        panel.grid.minor.y = element_blank()) #<<
```

]

.right-plot[
  ![](`r knitr::fig_chunk("basic-boxplot-no-y", "png")`)
]


---
  
# Violin plots
  
Mirror density plot and flip

.left-code[
```{r basic-violin, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 2.75), out.width="100%"}
ggplot(gapminder_2002,
       aes(x = "", 
           y = lifeExp)) + #<<
  geom_violin() #<<
```
]

.right-plot[
  ![](`r knitr::fig_chunk("basic-violin", "png")`)
]

---
  
# Overalying geometries

We can overlay multiple geometries to provide more information

.left-code[
```{r basic-violin-overlay, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 2.75), out.width="100%"}
ggplot(gapminder_2002,
       aes(x = "", 
           y = lifeExp)) +
  geom_violin() +
  geom_boxplot(width = 0.1) #<<
```
]

.right-plot[
  ![](`r knitr::fig_chunk("basic-violin-overlay", "png")`)
]

---
  
# Uncertainty across multiple variables
  
```{r, include=FALSE}
theme_set(theme_gray(base_size = 16)) # decrease base text size
```

How could we visualize the distribution of a single variable across groups?

--

Add a `fill` aesthetic or use faceting!

---
  
# Multiple histograms
  
Fill with a different variable

This is bad and really hard to read though

.left-code[
```{r histogram-fill, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 2.75), out.width="100%"}
ggplot(gapminder_2002,
       aes(x = lifeExp,
           fill = continent)) + #<<
  geom_histogram(binwidth = 5, 
                 color = "white", 
                 boundary = 50)
```
]

.right-plot[
  ![](`r knitr::fig_chunk("histogram-fill", "png")`)
]

---
  
# Multiple histograms
  
Facet with a different variable

.left-code[
```{r histogram-facet, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 3.25), out.width="100%"}
ggplot(gapminder_2002,
       aes(x = lifeExp,
           fill = continent)) +
  geom_histogram(binwidth = 5, 
                 color = "white", 
                 boundary = 50) +
  guides(fill = "none") + #<<
  facet_wrap(vars(continent)) #<<
```
]

.right-plot[
  ![](`r knitr::fig_chunk("histogram-facet", "png")`)
]

---

# Pyramid histograms

.left-code[
```{r gapminder-pyramid, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 4.2), out.width="100%"}
gapminder %>% 
  filter(year == 2002) %>% 
  mutate(africa = 
           ifelse(continent == "Africa", 
                  "Africa", 
                  "Not Africa")) %>% 
      mutate(age_buckets = 
               cut(lifeExp, 
                   breaks = seq(30, 90, by = 5))) %>% 
      group_by(africa, age_buckets) %>% 
      summarize(total = n()) %>% 
ggplot(aes(y = age_buckets,
           x = ifelse(africa == "Africa", 
                      total, -total),
           fill = africa)) +
  geom_col(width = 1, color = "white") + 
  theme(legend.position = "bottom")
```
]

.right-plot[
  ![](`r knitr::fig_chunk("gapminder-pyramid", "png")`)
]

???

There's no way to use `geom_histogram()` to do this, but we can fake it with `geom_col()`

---

# Multiple densities: Transparency

.left-code[
```{r density-fill, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 4.2), out.width="100%"}
gapminder_2002 %>% 
  filter(continent != "Oceania") %>% 
  ggplot(aes(x = lifeExp,
             fill = continent)) +
  geom_density(alpha = 0.5) #<<
```

But be careful, these can get confusing quickly

With many groups, better to space them out using ridgeline plots
]

.right-plot[
![](`r knitr::fig_chunk("density-fill", "png")`)
]

---

# Multiple densities: Ridgeline plots

.left-code[
```{r density-ridges, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 4.2), out.width="100%"}
library(ggridges) #<<

ggplot(filter(gapminder_2002, 
              continent != "Oceania"),
       aes(x = lifeExp,
           fill = continent,
           y = continent)) +
  guides(fill = "none") +
  labs(y = NULL) +
  geom_density_ridges() #<<
```

There is no explicit scale for the densities anymore (it is shared with y)

With many densities, use a single fill color to prevent distraction
]

.right-plot[
![](`r knitr::fig_chunk("density-ridges", "png")`)
]

---

# Multiple geoms: gghalves

.left-code[
```{r gghalves, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 4.2), out.width="100%"}
library(gghalves) #<<

ggplot(filter(gapminder_2002, 
              continent != "Oceania"),
       aes(y = lifeExp,
           x = continent,
           color = continent)) +
  geom_half_boxplot(side = "l") + #<<
  geom_half_point(side = "r") + #<<
  guides(color = "none")
```
]

.right-plot[
![](`r knitr::fig_chunk("gghalves", "png")`)
]

---

# Multiple geoms: Raincloud plots

.left-code[
```{r raincloud, tidy=FALSE, message=FALSE, fig.show="hide", fig.dim=c(4.8, 4.2), out.width="100%"}
library(gghalves) #<<

ggplot(filter(gapminder_2002, 
              continent != "Oceania"),
       aes(y = lifeExp,
           x = continent,
           color = continent)) +
  geom_half_point(side = "l", size = 0.3) +  #<<
  geom_half_boxplot(side = "l", width = 0.5,  #<<
                    alpha = 0.3, nudge = 0.1) + #<<
  geom_half_violin(aes(fill = continent),  #<<
                   side = "r") + #<<
  guides(fill = "none", color = "none") +
  labs(y = NULL) +
  coord_flip()  #<<
```
]

.right-plot[
![](`r knitr::fig_chunk("raincloud", "png")`)
]

---

# Uncertainty in models and simulations

We have already seen at least one example: `geom_smooth()`

We will discuss these more next week

Until then, here are a few real-world examples

---

# The needle

.center[
<figure>
  <img src="img/07/needle.gif" alt="2016 election needle" title="2016 election needle" width="65%">
</figure>
]

???

Via https://www.vis4.net/blog/2016/11/jittery-gauges-election-forecast/

---

# Uncertainty in model outcomes

.center[
<figure>
  <img src="img/07/fivethirtyeight-outcomes.png" alt="FiveThirtyEight model outcomes plot" title="FiveThirtyEight model outcomes plot" width="55%">
  <figcaption>FiveThirtyEight's 2018 midterms model outcomes plot</figcaption
</figure>
  ]
