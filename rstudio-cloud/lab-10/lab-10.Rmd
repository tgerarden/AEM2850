---
#########################################################
# Steps to complete this lab:
#   1. Add your name to the author field of the yaml header
#   2. Fill in the code chunks and use inline code to answer the questions 
#   3. Click on "Knit" directly above to render output (or Ctrl/Cmd-Shift-K)
#   4. Repeat steps 2-3 until you are satisfied with the final product
#   5. Download the resulting file lab-xx.pdf
#   6. Upload lab-xx.pdf to canvas
# Reminder: to work interactively, you can run code chunks on their own
# You can do this using keyboard shortcuts, icons in each chunk, or Run at the top right of this pane
#########################################################
title: "Lab-10"
author: "your name here"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
urlcolor: blue
---

```{r setup, include = FALSE}
library(tidyverse)
library(sf)

# omit warnings and center plots by default
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE,
               fig.align = "center",
               out.width = "85%")
```

# Preface

The goal of this assignment is to help you gain more familiarity with using **ggplot** to visualize geospatial data. As always, please come to office hours and reach out to your teaching staff if you have any questions.

## Knitting

Since the maps in this lab contain a lot of data, knitting may be slower than usual. We recommend running your code interactively (e.g., in chunks) so you can work on each problem separately without needing to knit the entire document repeatedly. Then you can knit the final product for submission when ready.

## Data

We will work with data on Airbnb listings from [Inside Airbnb](http://insideairbnb.com).[^insideairbnb] For this lab, we will start by using listing location data contained in `listings.csv`. Each row corresponds to a listing `id`, and variables summarize the key details for that listing. Import these data and assign them to a name.
```{r}

```


\newpage
## 1. We'll start by plotting locations without formally treating them as spatial data. Use `geom_point()` to make a scatter plot of listing locations. Adjust the transparency to make it easier to see which locations have higher and lower densities of listings. Color by borough (e.g., Bronx, Brooklyn, etc.).

```{r}

```


\newpage
## 2. Use `read_sf()` to read in the shapefile `nybb_22a/nybb.shp` and assign it to `boroughs`. Then use `geom_sf()` to plot the spatial data contained in `boroughs`, and `fill` by `BoroName`.

```{r}

```


\newpage
## 3. Now we'll combine the listings data with these spatial data. Use `count()` or `summarize()` to count the number of listings in each borough. Join the resulting data frame with `boroughs`. Use `geom_sf()` to plot the boroughs as in 2, but now `fill` by the number of Airbnb listings in each borough to make a choropleth map. Add `scale_fill_viridis_c()` to alter the default fill colors.[^viridis-tidyverse]
```{r}

```


\newpage
## 4. Now use the joined data to compute the number of listings per square mile, then use that to recreate your choropleth map from 3. Do the patterns look similar to or different from the map you created in 3? Do you think one is better than the other? Why or why not?
*Hint: print `boroughs` and look at the type information for `geometry` to try to figure out what units `Shape_Area` is in, and/or use google to try to figure it out.*
```{r}

```


\newpage
## 5. Let's do some data work. Use `st_as_sf()` to convert the Airbnb listings in Manhattan to an `sf` data frame. Set the coordinate reference system by including the argument `crs = st_crs("WGS84")` in your call to `st_as_sf()`. Assign this new object to `listing_locations`.
```{r}

```

## Next, create a sf data frame with one row that contains the location of Times Square. Use the same coordinate reference system ("WGS84").
*Hint: see slide 41 from Tuesday's lecture if you aren't sure where to start.*
```{r}

```

## Use `mutate()` and `st_distance()` to create a new variable in `listing_locations` that contains the distance between each listing and Times Square. 
*Tip: it will simplify plotting if you convert the distance measure to a numeric in order to strip the units (meters). You may also want to convert from meters to kilometers.*
```{r}

```

## Finally, plot the listings in Manhattan and `color` by the distance to Times Square. Add `scale_color_viridis_c()` to customize the color scheme.
*Optional: start with the `boroughs` map of Manhattan and add points for an aesthetically pleasing result.*
```{r}

```


\newpage
## 6. Read in `review_summary.csv`.[^review-data] Isolate the properties with at least 10 reviews and `review_scores_location` of at least 4. Join the `review_scores_location` variable to `listing_locations`. Make a scatter plot of the listings using `geom_sf()`, and `color` by `review_scores_location`. Make sure there are no listings with missing values for `review_scores_location` on the plot. Adjust transparency as needed. Does proximity to Times Square seem to matter for location ratings?
*Optional: start with the `boroughs` map of Manhattan and add points for an aesthetically pleasing result.*

```{r}

```


\newpage
## 7. Use a linear regression model to confirm your visual analysis of whether proximity to Times Square matters for location ratings. Use `review_scores_location` as the dependent variable and distance to Times Square as the independent variable. Print a `summary()` of the results and comment on your findings. Do you think this is a good model of location ratings?
```{r}

```


\newpage
## 8. Do something else interesting with these data, or with other spatial data. You could analyze other airbnb rating measures, or use other variables like price. You could compute the distance to wherever you will spend spring break, or make a map of that location. Or just stop here and go enjoy your break. Your choice!













[^insideairbnb]: Inside Airbnb is a mission driven activist project with the objective to: *Provide data that quantifies the impact of short-term rentals on housing and residential communities; and also provides a platform to support advocacy for policies to protect our cities from the impacts of short-term rentals.*

[^viridis-tidyverse]: Several `viridis` scales are loaded with `tidyverse`, since they are included in the package `ggplot2` we have used for all our plots.

[^review-data]: As a reminder from a previous assignment: each row corresponds to a listing `id`, and variables summarize all the reviews for that listing. For context, [here is the reviews page](https://www.airbnb.com/rooms/2595/reviews) for the first listing in the data. In the top left corner you can see that Airbnb reviews include an overall rating (`review_scores_rating`) and several sub-ratings for specific things (e.g., cleanliness, stored in the column `review_scores_cleanliness`).
