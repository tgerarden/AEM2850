<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Welcome to the tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Todd Gerarden" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/tdg-slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">











class: center middle main-title section-title-4

# Welcome to the tidyverse

.class-info[

**Week 3**

AEM 2850: R for Business Analytics&lt;br&gt;
Cornell Dyson&lt;br&gt;
Spring 2022

Acknowledgements: 
&lt;!-- [Andrew Heiss](https://datavizm20.classes.andrewheiss.com),  --&gt;
&lt;!-- [Claus Wilke](https://wilkelab.org/SDS375/),  --&gt;
[Grant McDermott](https://github.com/uo-ec607/lectures),
[Allison Horst](https://github.com/allisonhorst/stats-illustrations)

]


---

# Announcements

If you are new to the class, please review canvas announcements

Reminders:
- Bookmark [aem2850.toddgerarden.com/schedule](https://aem2850.toddgerarden.com/schedule) and visit often
- Submit assignments via canvas
  - Lab 2 was due yesterday (Monday) at 11:59pm
  - Reflection - Week 3 is due Wednesday at 11:59pm

**Bring your laptop to class on Thursday!**

Questions before we get started?

---

# Plan for today

[Prologue](#prologue)

[Tidyverse basics](#basics)

[Data transformation with dplyr](#dplyr)
  - [filter](#filter)
  - [arrange](#arrange)
  - [select](#select)
  - [mutate](#mutate)
  - [summarize](#summarize)
  - [other goodies](#goodies)


---
class: inverse, center, middle
name: prologue

# Prologue

---

# What sports do we watch?

Take a guess: what's the most popular spectator sport among classmates?



--


```
##  [1] "football"   "basketball" "volleyball" "soccer"     NA          
##  [6] "baseball"   "football"   "basketball" "basketball" "football"  
## [11] "gymnastics" "gymnastics" "squash"     NA           "basketball"
## [16] "gymnastics" "tennis"     "baseball"   "basketball" "basketball"
## [21] NA           "soccer"     "basketball" "baseball"   "tennis"    
## [26] "polo"       "hockey"     "basketball" "gymnastics" "soccer"    
## [31] "tennis"     NA           "soccer"     "cricket"    "tennis"    
## [36] "tennis"     "badminton"  "football"   "football"
```

--

Let's `count` and `arrange` to get the top 3:


```
## # A tibble: 3 Ã— 2
##   sport          n
##   &lt;chr&gt;      &lt;int&gt;
## 1 basketball     8
## 2 football       5
## 3 tennis         5
```

---

# R can be used for sports analytics, too!

.pull-left[
&lt;img src="img/03/stephen-curry.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="img/03/kobe-bryant.png" width="100%" style="display: block; margin: auto;" /&gt;
]

???
Source: https://github.com/toddwschneider/ballr


---

# R "dialects"

Last week we introduced several R programming concepts:
  - logical expressions
  - assignment
  - object types
  - object names, namespace conflicts
  - indexing

We did this using base R
  - **pro:** comes in the box, close parallels to other programming languages
  - **con:** can be confusing for new programmers (esp. indexing operations)

---

# R "dialects"

.more-left[
This week we will start using the tidyverse

You can think of it as a different "dialect" of R

This dialect is more like human language

More intuitive if you're new to programming

So if Lab 2 was confusing, don't get discouraged!
]

--

.less-right[
&lt;img src="img/03/r_first_then.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
class: inverse, center, middle
name: basics

# Tidyverse basics


---

# Tidyverse vs. base R

Lots of debate over tidyverse vs. base R

--

Why we're using the tidyverse:
- Consistent philosophy and syntax
- Great documentation and community support
- For data wrangling and plotting, tidyverse is ðŸ”¥

--

&lt;br&gt;

Base R is still great, can do some things tidyverse can't

**data.table** is another great alternative for data wrangling


---

# Tidyverse vs. base R

Often a correspondence between tidyverse and base R commands:

| tidyverse  |  base |
|---|---|
| `?readr::read_csv`  | `?utils::read.csv` |
|  `?dplyr::if_else` |  `?base::ifelse` |
|  `?tibble::tibble` |  `?base::data.frame` |

Tidyverse alternatives typically offer extra features

--

**Remember:** There are always multiple ways to do something in R

---

# Let's load the tidyverse meta-package


```r
library(tidyverse)
```

--


```
## â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.1 â”€â”€
```

```
## âœ“ ggplot2 3.3.5     âœ“ purrr   0.3.4
## âœ“ tibble  3.1.6     âœ“ dplyr   1.0.7
## âœ“ tidyr   1.1.4     âœ“ stringr 1.4.0
## âœ“ readr   2.1.1     âœ“ forcats 0.5.1
```

```
## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## x tidyr::extract()   masks magrittr::extract()
## x dplyr::filter()    masks stats::filter()
## x dplyr::lag()       masks stats::lag()
## x purrr::set_names() masks magrittr::set_names()
```

--

We just loaded a bunch of packages: **ggplot2**, **tibble**, **dplyr**, etc.

We also see some **namespace conflicts**

---

# Tidyverse packages

When you install the tidyverse, you actually get a lot more packages:

```r
tidyverse_packages()
```

```
##  [1] "broom"         "cli"           "crayon"        "dbplyr"       
##  [5] "dplyr"         "dtplyr"        "forcats"       "googledrive"  
##  [9] "googlesheets4" "ggplot2"       "haven"         "hms"          
## [13] "httr"          "jsonlite"      "lubridate"     "magrittr"     
## [17] "modelr"        "pillar"        "purrr"         "readr"        
## [21] "readxl"        "reprex"        "rlang"         "rstudioapi"   
## [25] "rvest"         "stringr"       "tibble"        "tidyr"        
## [29] "xml2"          "tidyverse"
```

--

These other packages have to be loaded separately

---

# Tidyverse packages

Today we'll focus on [**dplyr**](https://dplyr.tidyverse.org/)

But first let's talk about tibbles and pipes


---
name: tibbles

# Review: What are objects? 

There are many different *types* (or *classes*) of objects

Here are some objects that we'll be working with regularly:
- vectors
- matrices
- data frames
- lists
- functions


---

# Review: Data frames

The most important object we'll work with is the **data frame**

You can think of it as an Excel spreadsheet


```r
# Create a small data frame called "d"
d &lt;- data.frame(x = 1:2, y = 3:4) 
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

This is essentially just a table with columns named `x` and `y`

Each row is an observation telling us the values of both `x` and `y`

---

# Tibbles are data frames with opinions

For this class you can think of tibbles and data frames as synonymous

Tibbles have some advantages, such as pretty printing

--

We will primarily use tibbles in this course

Two functions may come in handy:
- `as_tibble()` converts data frames to tibbles
- `tibble()` creates new tibbles from scratch

See `vignette("tibble")` for more

---

# Printing a data.frame


```r
as.data.frame(starwars)
```

```
##                     name height   mass    hair_color          skin_color
## 1         Luke Skywalker    172   77.0         blond                fair
## 2                  C-3PO    167   75.0          &lt;NA&gt;                gold
## 3                  R2-D2     96   32.0          &lt;NA&gt;         white, blue
## 4            Darth Vader    202  136.0          none               white
## 5            Leia Organa    150   49.0         brown               light
## 6              Owen Lars    178  120.0   brown, grey               light
## 7     Beru Whitesun lars    165   75.0         brown               light
## 8                  R5-D4     97   32.0          &lt;NA&gt;          white, red
## 9      Biggs Darklighter    183   84.0         black               light
## 10        Obi-Wan Kenobi    182   77.0 auburn, white                fair
## 11      Anakin Skywalker    188   84.0         blond                fair
## 12        Wilhuff Tarkin    180     NA  auburn, grey                fair
## 13             Chewbacca    228  112.0         brown             unknown
## 14              Han Solo    180   80.0         brown                fair
## 15                Greedo    173   74.0          &lt;NA&gt;               green
## 16 Jabba Desilijic Tiure    175 1358.0          &lt;NA&gt;    green-tan, brown
## 17        Wedge Antilles    170   77.0         brown                fair
## 18      Jek Tono Porkins    180  110.0         brown                fair
## 19                  Yoda     66   17.0         white               green
## 20             Palpatine    170   75.0          grey                pale
## 21             Boba Fett    183   78.2         black                fair
## 22                 IG-88    200  140.0          none               metal
## 23                 Bossk    190  113.0          none               green
## 24      Lando Calrissian    177   79.0         black                dark
## 25                 Lobot    175   79.0          none               light
## 26                Ackbar    180   83.0          none        brown mottle
## 27            Mon Mothma    150     NA        auburn                fair
## 28          Arvel Crynyd     NA     NA         brown                fair
## 29 Wicket Systri Warrick     88   20.0         brown               brown
## 30             Nien Nunb    160   68.0          none                grey
## 31          Qui-Gon Jinn    193   89.0         brown                fair
## 32           Nute Gunray    191   90.0          none       mottled green
## 33         Finis Valorum    170     NA         blond                fair
## 34         Jar Jar Binks    196   66.0          none              orange
## 35          Roos Tarpals    224   82.0          none                grey
## 36            Rugor Nass    206     NA          none               green
## 37              Ric OliÃ©    183     NA         brown                fair
## 38                 Watto    137     NA         black          blue, grey
## 39               Sebulba    112   40.0          none           grey, red
## 40         Quarsh Panaka    183     NA         black                dark
## 41        Shmi Skywalker    163     NA         black                fair
## 42            Darth Maul    175   80.0          none                 red
## 43           Bib Fortuna    180     NA          none                pale
## 44           Ayla Secura    178   55.0          none                blue
## 45              Dud Bolt     94   45.0          none          blue, grey
## 46               Gasgano    122     NA          none         white, blue
## 47        Ben Quadinaros    163   65.0          none grey, green, yellow
## 48            Mace Windu    188   84.0          none                dark
## 49          Ki-Adi-Mundi    198   82.0         white                pale
## 50             Kit Fisto    196   87.0          none               green
## 51             Eeth Koth    171     NA         black               brown
## 52            Adi Gallia    184   50.0          none                dark
## 53           Saesee Tiin    188     NA          none                pale
## 54           Yarael Poof    264     NA          none               white
## 55              Plo Koon    188   80.0          none              orange
## 56            Mas Amedda    196     NA          none                blue
## 57          Gregar Typho    185   85.0         black                dark
## 58                 CordÃ©    157     NA         brown               light
## 59           Cliegg Lars    183     NA         brown                fair
## 60     Poggle the Lesser    183   80.0          none               green
## 61       Luminara Unduli    170   56.2         black              yellow
## 62         Barriss Offee    166   50.0         black              yellow
## 63                 DormÃ©    165     NA         brown               light
## 64                 Dooku    193   80.0         white                fair
## 65   Bail Prestor Organa    191     NA         black                 tan
## 66            Jango Fett    183   79.0         black                 tan
## 67            Zam Wesell    168   55.0        blonde fair, green, yellow
## 68       Dexter Jettster    198  102.0          none               brown
## 69               Lama Su    229   88.0          none                grey
## 70               Taun We    213     NA          none                grey
## 71            Jocasta Nu    167     NA         white                fair
## 72         Ratts Tyerell     79   15.0          none          grey, blue
## 73                R4-P17     96     NA          none         silver, red
## 74            Wat Tambor    193   48.0          none         green, grey
## 75              San Hill    191     NA          none                grey
## 76              Shaak Ti    178   57.0          none    red, blue, white
## 77              Grievous    216  159.0          none        brown, white
## 78               Tarfful    234  136.0         brown               brown
## 79       Raymus Antilles    188   79.0         brown               light
## 80             Sly Moore    178   48.0          none                pale
## 81            Tion Medon    206   80.0          none                grey
## 82                  Finn     NA     NA         black                dark
## 83                   Rey     NA     NA         brown               light
## 84           Poe Dameron     NA     NA         brown               light
## 85                   BB8     NA     NA          none                none
## 86        Captain Phasma     NA     NA       unknown             unknown
## 87         PadmÃ© Amidala    165   45.0         brown               light
##        eye_color birth_year            sex    gender      homeworld
## 1           blue       19.0           male masculine       Tatooine
## 2         yellow      112.0           none masculine       Tatooine
## 3            red       33.0           none masculine          Naboo
## 4         yellow       41.9           male masculine       Tatooine
## 5          brown       19.0         female  feminine       Alderaan
## 6           blue       52.0           male masculine       Tatooine
## 7           blue       47.0         female  feminine       Tatooine
## 8            red         NA           none masculine       Tatooine
## 9          brown       24.0           male masculine       Tatooine
## 10     blue-gray       57.0           male masculine        Stewjon
## 11          blue       41.9           male masculine       Tatooine
## 12          blue       64.0           male masculine         Eriadu
## 13          blue      200.0           male masculine       Kashyyyk
## 14         brown       29.0           male masculine       Corellia
## 15         black       44.0           male masculine          Rodia
## 16        orange      600.0 hermaphroditic masculine      Nal Hutta
## 17         hazel       21.0           male masculine       Corellia
## 18          blue         NA           male masculine     Bestine IV
## 19         brown      896.0           male masculine           &lt;NA&gt;
## 20        yellow       82.0           male masculine          Naboo
## 21         brown       31.5           male masculine         Kamino
## 22           red       15.0           none masculine           &lt;NA&gt;
## 23           red       53.0           male masculine      Trandosha
## 24         brown       31.0           male masculine        Socorro
## 25          blue       37.0           male masculine         Bespin
## 26        orange       41.0           male masculine       Mon Cala
## 27          blue       48.0         female  feminine      Chandrila
## 28         brown         NA           male masculine           &lt;NA&gt;
## 29         brown        8.0           male masculine          Endor
## 30         black         NA           male masculine        Sullust
## 31          blue       92.0           male masculine           &lt;NA&gt;
## 32           red         NA           male masculine Cato Neimoidia
## 33          blue       91.0           male masculine      Coruscant
## 34        orange       52.0           male masculine          Naboo
## 35        orange         NA           male masculine          Naboo
## 36        orange         NA           male masculine          Naboo
## 37          blue         NA           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 38        yellow         NA           male masculine       Toydaria
## 39        orange         NA           male masculine      Malastare
## 40         brown       62.0           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 41         brown       72.0         female  feminine       Tatooine
## 42        yellow       54.0           male masculine       Dathomir
## 43          pink         NA           male masculine         Ryloth
## 44         hazel       48.0         female  feminine         Ryloth
## 45        yellow         NA           male masculine        Vulpter
## 46         black         NA           male masculine        Troiken
## 47        orange         NA           male masculine           Tund
## 48         brown       72.0           male masculine     Haruun Kal
## 49        yellow       92.0           male masculine          Cerea
## 50         black         NA           male masculine    Glee Anselm
## 51         brown         NA           male masculine       Iridonia
## 52          blue         NA         female  feminine      Coruscant
## 53        orange         NA           male masculine        Iktotch
## 54        yellow         NA           male masculine        Quermia
## 55         black       22.0           male masculine          Dorin
## 56          blue         NA           male masculine       Champala
## 57         brown         NA           male masculine          Naboo
## 58         brown         NA         female  feminine          Naboo
## 59          blue       82.0           male masculine       Tatooine
## 60        yellow         NA           male masculine       Geonosis
## 61          blue       58.0         female  feminine         Mirial
## 62          blue       40.0         female  feminine         Mirial
## 63         brown         NA         female  feminine          Naboo
## 64         brown      102.0           male masculine        Serenno
## 65         brown       67.0           male masculine       Alderaan
## 66         brown       66.0           male masculine   Concord Dawn
## 67        yellow         NA         female  feminine          Zolan
## 68        yellow         NA           male masculine           Ojom
## 69         black         NA           male masculine         Kamino
## 70         black         NA         female  feminine         Kamino
## 71          blue         NA         female  feminine      Coruscant
## 72       unknown         NA           male masculine    Aleen Minor
## 73     red, blue         NA           none  feminine           &lt;NA&gt;
## 74       unknown         NA           male masculine          Skako
## 75          gold         NA           male masculine     Muunilinst
## 76         black         NA         female  feminine          Shili
## 77 green, yellow         NA           male masculine          Kalee
## 78          blue         NA           male masculine       Kashyyyk
## 79         brown         NA           male masculine       Alderaan
## 80         white         NA           &lt;NA&gt;      &lt;NA&gt;         Umbara
## 81         black         NA           male masculine         Utapau
## 82          dark         NA           male masculine           &lt;NA&gt;
## 83         hazel         NA         female  feminine           &lt;NA&gt;
## 84         brown         NA           male masculine           &lt;NA&gt;
## 85         black         NA           none masculine           &lt;NA&gt;
## 86       unknown         NA           &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;
## 87         brown       46.0         female  feminine          Naboo
##           species
## 1           Human
## 2           Droid
## 3           Droid
## 4           Human
## 5           Human
## 6           Human
## 7           Human
## 8           Droid
## 9           Human
## 10          Human
## 11          Human
## 12          Human
## 13        Wookiee
## 14          Human
## 15         Rodian
## 16           Hutt
## 17          Human
## 18          Human
## 19 Yoda's species
## 20          Human
## 21          Human
## 22          Droid
## 23     Trandoshan
## 24          Human
## 25          Human
## 26   Mon Calamari
## 27          Human
## 28          Human
## 29           Ewok
## 30      Sullustan
## 31          Human
## 32      Neimodian
## 33          Human
## 34         Gungan
## 35         Gungan
## 36         Gungan
## 37           &lt;NA&gt;
## 38      Toydarian
## 39            Dug
## 40           &lt;NA&gt;
## 41          Human
## 42         Zabrak
## 43        Twi'lek
## 44        Twi'lek
## 45     Vulptereen
## 46          Xexto
## 47          Toong
## 48          Human
## 49         Cerean
## 50       Nautolan
## 51         Zabrak
## 52     Tholothian
## 53       Iktotchi
## 54       Quermian
## 55        Kel Dor
## 56       Chagrian
## 57          Human
## 58          Human
## 59          Human
## 60      Geonosian
## 61       Mirialan
## 62       Mirialan
## 63          Human
## 64          Human
## 65          Human
## 66          Human
## 67       Clawdite
## 68       Besalisk
## 69       Kaminoan
## 70       Kaminoan
## 71          Human
## 72         Aleena
## 73          Droid
## 74        Skakoan
## 75           Muun
## 76        Togruta
## 77        Kaleesh
## 78        Wookiee
## 79          Human
## 80           &lt;NA&gt;
## 81         Pau'an
## 82          Human
## 83          Human
## 84          Human
## 85          Droid
## 86           &lt;NA&gt;
## 87          Human
##                                                                                                                                        films
## 1                                            The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 2                     The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope
## 3  The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 4                                                               The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope
## 5                                            The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 6                                                                                      Attack of the Clones, Revenge of the Sith, A New Hope
## 7                                                                                      Attack of the Clones, Revenge of the Sith, A New Hope
## 8                                                                                                                                 A New Hope
## 9                                                                                                                                 A New Hope
## 10                    The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope
## 11                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 12                                                                                                           Revenge of the Sith, A New Hope
## 13                                           The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 14                                                                The Empire Strikes Back, Return of the Jedi, A New Hope, The Force Awakens
## 15                                                                                                                                A New Hope
## 16                                                                                        The Phantom Menace, Return of the Jedi, A New Hope
## 17                                                                                   The Empire Strikes Back, Return of the Jedi, A New Hope
## 18                                                                                                                                A New Hope
## 19                                The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi
## 20                                The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi
## 21                                                                         The Empire Strikes Back, Attack of the Clones, Return of the Jedi
## 22                                                                                                                   The Empire Strikes Back
## 23                                                                                                                   The Empire Strikes Back
## 24                                                                                               The Empire Strikes Back, Return of the Jedi
## 25                                                                                                                   The Empire Strikes Back
## 26                                                                                                     Return of the Jedi, The Force Awakens
## 27                                                                                                                        Return of the Jedi
## 28                                                                                                                        Return of the Jedi
## 29                                                                                                                        Return of the Jedi
## 30                                                                                                                        Return of the Jedi
## 31                                                                                                                        The Phantom Menace
## 32                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 33                                                                                                                        The Phantom Menace
## 34                                                                                                  Attack of the Clones, The Phantom Menace
## 35                                                                                                                        The Phantom Menace
## 36                                                                                                                        The Phantom Menace
## 37                                                                                                                        The Phantom Menace
## 38                                                                                                  Attack of the Clones, The Phantom Menace
## 39                                                                                                                        The Phantom Menace
## 40                                                                                                                        The Phantom Menace
## 41                                                                                                  Attack of the Clones, The Phantom Menace
## 42                                                                                                                        The Phantom Menace
## 43                                                                                                                        Return of the Jedi
## 44                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 45                                                                                                                        The Phantom Menace
## 46                                                                                                                        The Phantom Menace
## 47                                                                                                                        The Phantom Menace
## 48                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 49                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 50                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 51                                                                                                   The Phantom Menace, Revenge of the Sith
## 52                                                                                                   The Phantom Menace, Revenge of the Sith
## 53                                                                                                   The Phantom Menace, Revenge of the Sith
## 54                                                                                                                        The Phantom Menace
## 55                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 56                                                                                                  Attack of the Clones, The Phantom Menace
## 57                                                                                                                      Attack of the Clones
## 58                                                                                                                      Attack of the Clones
## 59                                                                                                                      Attack of the Clones
## 60                                                                                                 Attack of the Clones, Revenge of the Sith
## 61                                                                                                 Attack of the Clones, Revenge of the Sith
## 62                                                                                                                      Attack of the Clones
## 63                                                                                                                      Attack of the Clones
## 64                                                                                                 Attack of the Clones, Revenge of the Sith
## 65                                                                                                 Attack of the Clones, Revenge of the Sith
## 66                                                                                                                      Attack of the Clones
## 67                                                                                                                      Attack of the Clones
## 68                                                                                                                      Attack of the Clones
## 69                                                                                                                      Attack of the Clones
## 70                                                                                                                      Attack of the Clones
## 71                                                                                                                      Attack of the Clones
## 72                                                                                                                        The Phantom Menace
## 73                                                                                                 Attack of the Clones, Revenge of the Sith
## 74                                                                                                                      Attack of the Clones
## 75                                                                                                                      Attack of the Clones
## 76                                                                                                 Attack of the Clones, Revenge of the Sith
## 77                                                                                                                       Revenge of the Sith
## 78                                                                                                                       Revenge of the Sith
## 79                                                                                                           Revenge of the Sith, A New Hope
## 80                                                                                                 Attack of the Clones, Revenge of the Sith
## 81                                                                                                                       Revenge of the Sith
## 82                                                                                                                         The Force Awakens
## 83                                                                                                                         The Force Awakens
## 84                                                                                                                         The Force Awakens
## 85                                                                                                                         The Force Awakens
## 86                                                                                                                         The Force Awakens
## 87                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
##                                vehicles
## 1    Snowspeeder, Imperial Speeder Bike
## 2                                      
## 3                                      
## 4                                      
## 5                 Imperial Speeder Bike
## 6                                      
## 7                                      
## 8                                      
## 9                                      
## 10                      Tribubble bongo
## 11 Zephyr-G swoop bike, XJ-6 airspeeder
## 12                                     
## 13                                AT-ST
## 14                                     
## 15                                     
## 16                                     
## 17                          Snowspeeder
## 18                                     
## 19                                     
## 20                                     
## 21                                     
## 22                                     
## 23                                     
## 24                                     
## 25                                     
## 26                                     
## 27                                     
## 28                                     
## 29                                     
## 30                                     
## 31                      Tribubble bongo
## 32                                     
## 33                                     
## 34                                     
## 35                                     
## 36                                     
## 37                                     
## 38                                     
## 39                                     
## 40                                     
## 41                                     
## 42                         Sith speeder
## 43                                     
## 44                                     
## 45                                     
## 46                                     
## 47                                     
## 48                                     
## 49                                     
## 50                                     
## 51                                     
## 52                                     
## 53                                     
## 54                                     
## 55                                     
## 56                                     
## 57                                     
## 58                                     
## 59                                     
## 60                                     
## 61                                     
## 62                                     
## 63                                     
## 64                     Flitknot speeder
## 65                                     
## 66                                     
## 67           Koro-2 Exodrive airspeeder
## 68                                     
## 69                                     
## 70                                     
## 71                                     
## 72                                     
## 73                                     
## 74                                     
## 75                                     
## 76                                     
## 77          Tsmeu-6 personal wheel bike
## 78                                     
## 79                                     
## 80                                     
## 81                                     
## 82                                     
## 83                                     
## 84                                     
## 85                                     
## 86                                     
## 87                                     
##                                                                                                   starships
## 1                                                                                  X-wing, Imperial shuttle
## 2                                                                                                          
## 3                                                                                                          
## 4                                                                                           TIE Advanced x1
## 5                                                                                                          
## 6                                                                                                          
## 7                                                                                                          
## 8                                                                                                          
## 9                                                                                                    X-wing
## 10 Jedi starfighter, Trade Federation cruiser, Naboo star skiff, Jedi Interceptor, Belbullab-22 starfighter
## 11                                                Trade Federation cruiser, Jedi Interceptor, Naboo fighter
## 12                                                                                                         
## 13                                                                      Millennium Falcon, Imperial shuttle
## 14                                                                      Millennium Falcon, Imperial shuttle
## 15                                                                                                         
## 16                                                                                                         
## 17                                                                                                   X-wing
## 18                                                                                                   X-wing
## 19                                                                                                         
## 20                                                                                                         
## 21                                                                                                  Slave 1
## 22                                                                                                         
## 23                                                                                                         
## 24                                                                                        Millennium Falcon
## 25                                                                                                         
## 26                                                                                                         
## 27                                                                                                         
## 28                                                                                                   A-wing
## 29                                                                                                         
## 30                                                                                        Millennium Falcon
## 31                                                                                                         
## 32                                                                                                         
## 33                                                                                                         
## 34                                                                                                         
## 35                                                                                                         
## 36                                                                                                         
## 37                                                                                     Naboo Royal Starship
## 38                                                                                                         
## 39                                                                                                         
## 40                                                                                                         
## 41                                                                                                         
## 42                                                                                                 Scimitar
## 43                                                                                                         
## 44                                                                                                         
## 45                                                                                                         
## 46                                                                                                         
## 47                                                                                                         
## 48                                                                                                         
## 49                                                                                                         
## 50                                                                                                         
## 51                                                                                                         
## 52                                                                                                         
## 53                                                                                                         
## 54                                                                                                         
## 55                                                                                         Jedi starfighter
## 56                                                                                                         
## 57                                                                                            Naboo fighter
## 58                                                                                                         
## 59                                                                                                         
## 60                                                                                                         
## 61                                                                                                         
## 62                                                                                                         
## 63                                                                                                         
## 64                                                                                                         
## 65                                                                                                         
## 66                                                                                                         
## 67                                                                                                         
## 68                                                                                                         
## 69                                                                                                         
## 70                                                                                                         
## 71                                                                                                         
## 72                                                                                                         
## 73                                                                                                         
## 74                                                                                                         
## 75                                                                                                         
## 76                                                                                                         
## 77                                                                                 Belbullab-22 starfighter
## 78                                                                                                         
## 79                                                                                                         
## 80                                                                                                         
## 81                                                                                                         
## 82                                                                                                         
## 83                                                                                                         
## 84                                                                                      T-70 X-wing fighter
## 85                                                                                                         
## 86                                                                                                         
## 87                                                     H-type Nubian yacht, Naboo star skiff, Naboo fighter
```

---

# How could we make this look nicer?


```r
as.data.frame(starwars)
```

```
##                     name height   mass    hair_color          skin_color
## 1         Luke Skywalker    172   77.0         blond                fair
## 2                  C-3PO    167   75.0          &lt;NA&gt;                gold
## 3                  R2-D2     96   32.0          &lt;NA&gt;         white, blue
## 4            Darth Vader    202  136.0          none               white
## 5            Leia Organa    150   49.0         brown               light
## 6              Owen Lars    178  120.0   brown, grey               light
## 7     Beru Whitesun lars    165   75.0         brown               light
## 8                  R5-D4     97   32.0          &lt;NA&gt;          white, red
## 9      Biggs Darklighter    183   84.0         black               light
## 10        Obi-Wan Kenobi    182   77.0 auburn, white                fair
## 11      Anakin Skywalker    188   84.0         blond                fair
## 12        Wilhuff Tarkin    180     NA  auburn, grey                fair
## 13             Chewbacca    228  112.0         brown             unknown
## 14              Han Solo    180   80.0         brown                fair
## 15                Greedo    173   74.0          &lt;NA&gt;               green
## 16 Jabba Desilijic Tiure    175 1358.0          &lt;NA&gt;    green-tan, brown
## 17        Wedge Antilles    170   77.0         brown                fair
## 18      Jek Tono Porkins    180  110.0         brown                fair
## 19                  Yoda     66   17.0         white               green
## 20             Palpatine    170   75.0          grey                pale
## 21             Boba Fett    183   78.2         black                fair
## 22                 IG-88    200  140.0          none               metal
## 23                 Bossk    190  113.0          none               green
## 24      Lando Calrissian    177   79.0         black                dark
## 25                 Lobot    175   79.0          none               light
## 26                Ackbar    180   83.0          none        brown mottle
## 27            Mon Mothma    150     NA        auburn                fair
## 28          Arvel Crynyd     NA     NA         brown                fair
## 29 Wicket Systri Warrick     88   20.0         brown               brown
## 30             Nien Nunb    160   68.0          none                grey
## 31          Qui-Gon Jinn    193   89.0         brown                fair
## 32           Nute Gunray    191   90.0          none       mottled green
## 33         Finis Valorum    170     NA         blond                fair
## 34         Jar Jar Binks    196   66.0          none              orange
## 35          Roos Tarpals    224   82.0          none                grey
## 36            Rugor Nass    206     NA          none               green
## 37              Ric OliÃ©    183     NA         brown                fair
## 38                 Watto    137     NA         black          blue, grey
## 39               Sebulba    112   40.0          none           grey, red
## 40         Quarsh Panaka    183     NA         black                dark
## 41        Shmi Skywalker    163     NA         black                fair
## 42            Darth Maul    175   80.0          none                 red
## 43           Bib Fortuna    180     NA          none                pale
## 44           Ayla Secura    178   55.0          none                blue
## 45              Dud Bolt     94   45.0          none          blue, grey
## 46               Gasgano    122     NA          none         white, blue
## 47        Ben Quadinaros    163   65.0          none grey, green, yellow
## 48            Mace Windu    188   84.0          none                dark
## 49          Ki-Adi-Mundi    198   82.0         white                pale
## 50             Kit Fisto    196   87.0          none               green
## 51             Eeth Koth    171     NA         black               brown
## 52            Adi Gallia    184   50.0          none                dark
## 53           Saesee Tiin    188     NA          none                pale
## 54           Yarael Poof    264     NA          none               white
## 55              Plo Koon    188   80.0          none              orange
## 56            Mas Amedda    196     NA          none                blue
## 57          Gregar Typho    185   85.0         black                dark
## 58                 CordÃ©    157     NA         brown               light
## 59           Cliegg Lars    183     NA         brown                fair
## 60     Poggle the Lesser    183   80.0          none               green
## 61       Luminara Unduli    170   56.2         black              yellow
## 62         Barriss Offee    166   50.0         black              yellow
## 63                 DormÃ©    165     NA         brown               light
## 64                 Dooku    193   80.0         white                fair
## 65   Bail Prestor Organa    191     NA         black                 tan
## 66            Jango Fett    183   79.0         black                 tan
## 67            Zam Wesell    168   55.0        blonde fair, green, yellow
## 68       Dexter Jettster    198  102.0          none               brown
## 69               Lama Su    229   88.0          none                grey
## 70               Taun We    213     NA          none                grey
## 71            Jocasta Nu    167     NA         white                fair
## 72         Ratts Tyerell     79   15.0          none          grey, blue
## 73                R4-P17     96     NA          none         silver, red
## 74            Wat Tambor    193   48.0          none         green, grey
## 75              San Hill    191     NA          none                grey
## 76              Shaak Ti    178   57.0          none    red, blue, white
## 77              Grievous    216  159.0          none        brown, white
## 78               Tarfful    234  136.0         brown               brown
## 79       Raymus Antilles    188   79.0         brown               light
## 80             Sly Moore    178   48.0          none                pale
## 81            Tion Medon    206   80.0          none                grey
## 82                  Finn     NA     NA         black                dark
## 83                   Rey     NA     NA         brown               light
## 84           Poe Dameron     NA     NA         brown               light
## 85                   BB8     NA     NA          none                none
## 86        Captain Phasma     NA     NA       unknown             unknown
## 87         PadmÃ© Amidala    165   45.0         brown               light
##        eye_color birth_year            sex    gender      homeworld
## 1           blue       19.0           male masculine       Tatooine
## 2         yellow      112.0           none masculine       Tatooine
## 3            red       33.0           none masculine          Naboo
## 4         yellow       41.9           male masculine       Tatooine
## 5          brown       19.0         female  feminine       Alderaan
## 6           blue       52.0           male masculine       Tatooine
## 7           blue       47.0         female  feminine       Tatooine
## 8            red         NA           none masculine       Tatooine
## 9          brown       24.0           male masculine       Tatooine
## 10     blue-gray       57.0           male masculine        Stewjon
## 11          blue       41.9           male masculine       Tatooine
## 12          blue       64.0           male masculine         Eriadu
## 13          blue      200.0           male masculine       Kashyyyk
## 14         brown       29.0           male masculine       Corellia
## 15         black       44.0           male masculine          Rodia
## 16        orange      600.0 hermaphroditic masculine      Nal Hutta
## 17         hazel       21.0           male masculine       Corellia
## 18          blue         NA           male masculine     Bestine IV
## 19         brown      896.0           male masculine           &lt;NA&gt;
## 20        yellow       82.0           male masculine          Naboo
## 21         brown       31.5           male masculine         Kamino
## 22           red       15.0           none masculine           &lt;NA&gt;
## 23           red       53.0           male masculine      Trandosha
## 24         brown       31.0           male masculine        Socorro
## 25          blue       37.0           male masculine         Bespin
## 26        orange       41.0           male masculine       Mon Cala
## 27          blue       48.0         female  feminine      Chandrila
## 28         brown         NA           male masculine           &lt;NA&gt;
## 29         brown        8.0           male masculine          Endor
## 30         black         NA           male masculine        Sullust
## 31          blue       92.0           male masculine           &lt;NA&gt;
## 32           red         NA           male masculine Cato Neimoidia
## 33          blue       91.0           male masculine      Coruscant
## 34        orange       52.0           male masculine          Naboo
## 35        orange         NA           male masculine          Naboo
## 36        orange         NA           male masculine          Naboo
## 37          blue         NA           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 38        yellow         NA           male masculine       Toydaria
## 39        orange         NA           male masculine      Malastare
## 40         brown       62.0           &lt;NA&gt;      &lt;NA&gt;          Naboo
## 41         brown       72.0         female  feminine       Tatooine
## 42        yellow       54.0           male masculine       Dathomir
## 43          pink         NA           male masculine         Ryloth
## 44         hazel       48.0         female  feminine         Ryloth
## 45        yellow         NA           male masculine        Vulpter
## 46         black         NA           male masculine        Troiken
## 47        orange         NA           male masculine           Tund
## 48         brown       72.0           male masculine     Haruun Kal
## 49        yellow       92.0           male masculine          Cerea
## 50         black         NA           male masculine    Glee Anselm
## 51         brown         NA           male masculine       Iridonia
## 52          blue         NA         female  feminine      Coruscant
## 53        orange         NA           male masculine        Iktotch
## 54        yellow         NA           male masculine        Quermia
## 55         black       22.0           male masculine          Dorin
## 56          blue         NA           male masculine       Champala
## 57         brown         NA           male masculine          Naboo
## 58         brown         NA         female  feminine          Naboo
## 59          blue       82.0           male masculine       Tatooine
## 60        yellow         NA           male masculine       Geonosis
## 61          blue       58.0         female  feminine         Mirial
## 62          blue       40.0         female  feminine         Mirial
## 63         brown         NA         female  feminine          Naboo
## 64         brown      102.0           male masculine        Serenno
## 65         brown       67.0           male masculine       Alderaan
## 66         brown       66.0           male masculine   Concord Dawn
## 67        yellow         NA         female  feminine          Zolan
## 68        yellow         NA           male masculine           Ojom
## 69         black         NA           male masculine         Kamino
## 70         black         NA         female  feminine         Kamino
## 71          blue         NA         female  feminine      Coruscant
## 72       unknown         NA           male masculine    Aleen Minor
## 73     red, blue         NA           none  feminine           &lt;NA&gt;
## 74       unknown         NA           male masculine          Skako
## 75          gold         NA           male masculine     Muunilinst
## 76         black         NA         female  feminine          Shili
## 77 green, yellow         NA           male masculine          Kalee
## 78          blue         NA           male masculine       Kashyyyk
## 79         brown         NA           male masculine       Alderaan
## 80         white         NA           &lt;NA&gt;      &lt;NA&gt;         Umbara
## 81         black         NA           male masculine         Utapau
## 82          dark         NA           male masculine           &lt;NA&gt;
## 83         hazel         NA         female  feminine           &lt;NA&gt;
## 84         brown         NA           male masculine           &lt;NA&gt;
## 85         black         NA           none masculine           &lt;NA&gt;
## 86       unknown         NA           &lt;NA&gt;      &lt;NA&gt;           &lt;NA&gt;
## 87         brown       46.0         female  feminine          Naboo
##           species
## 1           Human
## 2           Droid
## 3           Droid
## 4           Human
## 5           Human
## 6           Human
## 7           Human
## 8           Droid
## 9           Human
## 10          Human
## 11          Human
## 12          Human
## 13        Wookiee
## 14          Human
## 15         Rodian
## 16           Hutt
## 17          Human
## 18          Human
## 19 Yoda's species
## 20          Human
## 21          Human
## 22          Droid
## 23     Trandoshan
## 24          Human
## 25          Human
## 26   Mon Calamari
## 27          Human
## 28          Human
## 29           Ewok
## 30      Sullustan
## 31          Human
## 32      Neimodian
## 33          Human
## 34         Gungan
## 35         Gungan
## 36         Gungan
## 37           &lt;NA&gt;
## 38      Toydarian
## 39            Dug
## 40           &lt;NA&gt;
## 41          Human
## 42         Zabrak
## 43        Twi'lek
## 44        Twi'lek
## 45     Vulptereen
## 46          Xexto
## 47          Toong
## 48          Human
## 49         Cerean
## 50       Nautolan
## 51         Zabrak
## 52     Tholothian
## 53       Iktotchi
## 54       Quermian
## 55        Kel Dor
## 56       Chagrian
## 57          Human
## 58          Human
## 59          Human
## 60      Geonosian
## 61       Mirialan
## 62       Mirialan
## 63          Human
## 64          Human
## 65          Human
## 66          Human
## 67       Clawdite
## 68       Besalisk
## 69       Kaminoan
## 70       Kaminoan
## 71          Human
## 72         Aleena
## 73          Droid
## 74        Skakoan
## 75           Muun
## 76        Togruta
## 77        Kaleesh
## 78        Wookiee
## 79          Human
## 80           &lt;NA&gt;
## 81         Pau'an
## 82          Human
## 83          Human
## 84          Human
## 85          Droid
## 86           &lt;NA&gt;
## 87          Human
##                                                                                                                                        films
## 1                                            The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 2                     The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope
## 3  The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 4                                                               The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope
## 5                                            The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 6                                                                                      Attack of the Clones, Revenge of the Sith, A New Hope
## 7                                                                                      Attack of the Clones, Revenge of the Sith, A New Hope
## 8                                                                                                                                 A New Hope
## 9                                                                                                                                 A New Hope
## 10                    The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope
## 11                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 12                                                                                                           Revenge of the Sith, A New Hope
## 13                                           The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 14                                                                The Empire Strikes Back, Return of the Jedi, A New Hope, The Force Awakens
## 15                                                                                                                                A New Hope
## 16                                                                                        The Phantom Menace, Return of the Jedi, A New Hope
## 17                                                                                   The Empire Strikes Back, Return of the Jedi, A New Hope
## 18                                                                                                                                A New Hope
## 19                                The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi
## 20                                The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi
## 21                                                                         The Empire Strikes Back, Attack of the Clones, Return of the Jedi
## 22                                                                                                                   The Empire Strikes Back
## 23                                                                                                                   The Empire Strikes Back
## 24                                                                                               The Empire Strikes Back, Return of the Jedi
## 25                                                                                                                   The Empire Strikes Back
## 26                                                                                                     Return of the Jedi, The Force Awakens
## 27                                                                                                                        Return of the Jedi
## 28                                                                                                                        Return of the Jedi
## 29                                                                                                                        Return of the Jedi
## 30                                                                                                                        Return of the Jedi
## 31                                                                                                                        The Phantom Menace
## 32                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 33                                                                                                                        The Phantom Menace
## 34                                                                                                  Attack of the Clones, The Phantom Menace
## 35                                                                                                                        The Phantom Menace
## 36                                                                                                                        The Phantom Menace
## 37                                                                                                                        The Phantom Menace
## 38                                                                                                  Attack of the Clones, The Phantom Menace
## 39                                                                                                                        The Phantom Menace
## 40                                                                                                                        The Phantom Menace
## 41                                                                                                  Attack of the Clones, The Phantom Menace
## 42                                                                                                                        The Phantom Menace
## 43                                                                                                                        Return of the Jedi
## 44                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 45                                                                                                                        The Phantom Menace
## 46                                                                                                                        The Phantom Menace
## 47                                                                                                                        The Phantom Menace
## 48                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 49                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 50                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 51                                                                                                   The Phantom Menace, Revenge of the Sith
## 52                                                                                                   The Phantom Menace, Revenge of the Sith
## 53                                                                                                   The Phantom Menace, Revenge of the Sith
## 54                                                                                                                        The Phantom Menace
## 55                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
## 56                                                                                                  Attack of the Clones, The Phantom Menace
## 57                                                                                                                      Attack of the Clones
## 58                                                                                                                      Attack of the Clones
## 59                                                                                                                      Attack of the Clones
## 60                                                                                                 Attack of the Clones, Revenge of the Sith
## 61                                                                                                 Attack of the Clones, Revenge of the Sith
## 62                                                                                                                      Attack of the Clones
## 63                                                                                                                      Attack of the Clones
## 64                                                                                                 Attack of the Clones, Revenge of the Sith
## 65                                                                                                 Attack of the Clones, Revenge of the Sith
## 66                                                                                                                      Attack of the Clones
## 67                                                                                                                      Attack of the Clones
## 68                                                                                                                      Attack of the Clones
## 69                                                                                                                      Attack of the Clones
## 70                                                                                                                      Attack of the Clones
## 71                                                                                                                      Attack of the Clones
## 72                                                                                                                        The Phantom Menace
## 73                                                                                                 Attack of the Clones, Revenge of the Sith
## 74                                                                                                                      Attack of the Clones
## 75                                                                                                                      Attack of the Clones
## 76                                                                                                 Attack of the Clones, Revenge of the Sith
## 77                                                                                                                       Revenge of the Sith
## 78                                                                                                                       Revenge of the Sith
## 79                                                                                                           Revenge of the Sith, A New Hope
## 80                                                                                                 Attack of the Clones, Revenge of the Sith
## 81                                                                                                                       Revenge of the Sith
## 82                                                                                                                         The Force Awakens
## 83                                                                                                                         The Force Awakens
## 84                                                                                                                         The Force Awakens
## 85                                                                                                                         The Force Awakens
## 86                                                                                                                         The Force Awakens
## 87                                                                             Attack of the Clones, The Phantom Menace, Revenge of the Sith
##                                vehicles
## 1    Snowspeeder, Imperial Speeder Bike
## 2                                      
## 3                                      
## 4                                      
## 5                 Imperial Speeder Bike
## 6                                      
## 7                                      
## 8                                      
## 9                                      
## 10                      Tribubble bongo
## 11 Zephyr-G swoop bike, XJ-6 airspeeder
## 12                                     
## 13                                AT-ST
## 14                                     
## 15                                     
## 16                                     
## 17                          Snowspeeder
## 18                                     
## 19                                     
## 20                                     
## 21                                     
## 22                                     
## 23                                     
## 24                                     
## 25                                     
## 26                                     
## 27                                     
## 28                                     
## 29                                     
## 30                                     
## 31                      Tribubble bongo
## 32                                     
## 33                                     
## 34                                     
## 35                                     
## 36                                     
## 37                                     
## 38                                     
## 39                                     
## 40                                     
## 41                                     
## 42                         Sith speeder
## 43                                     
## 44                                     
## 45                                     
## 46                                     
## 47                                     
## 48                                     
## 49                                     
## 50                                     
## 51                                     
## 52                                     
## 53                                     
## 54                                     
## 55                                     
## 56                                     
## 57                                     
## 58                                     
## 59                                     
## 60                                     
## 61                                     
## 62                                     
## 63                                     
## 64                     Flitknot speeder
## 65                                     
## 66                                     
## 67           Koro-2 Exodrive airspeeder
## 68                                     
## 69                                     
## 70                                     
## 71                                     
## 72                                     
## 73                                     
## 74                                     
## 75                                     
## 76                                     
## 77          Tsmeu-6 personal wheel bike
## 78                                     
## 79                                     
## 80                                     
## 81                                     
## 82                                     
## 83                                     
## 84                                     
## 85                                     
## 86                                     
## 87                                     
##                                                                                                   starships
## 1                                                                                  X-wing, Imperial shuttle
## 2                                                                                                          
## 3                                                                                                          
## 4                                                                                           TIE Advanced x1
## 5                                                                                                          
## 6                                                                                                          
## 7                                                                                                          
## 8                                                                                                          
## 9                                                                                                    X-wing
## 10 Jedi starfighter, Trade Federation cruiser, Naboo star skiff, Jedi Interceptor, Belbullab-22 starfighter
## 11                                                Trade Federation cruiser, Jedi Interceptor, Naboo fighter
## 12                                                                                                         
## 13                                                                      Millennium Falcon, Imperial shuttle
## 14                                                                      Millennium Falcon, Imperial shuttle
## 15                                                                                                         
## 16                                                                                                         
## 17                                                                                                   X-wing
## 18                                                                                                   X-wing
## 19                                                                                                         
## 20                                                                                                         
## 21                                                                                                  Slave 1
## 22                                                                                                         
## 23                                                                                                         
## 24                                                                                        Millennium Falcon
## 25                                                                                                         
## 26                                                                                                         
## 27                                                                                                         
## 28                                                                                                   A-wing
## 29                                                                                                         
## 30                                                                                        Millennium Falcon
## 31                                                                                                         
## 32                                                                                                         
## 33                                                                                                         
## 34                                                                                                         
## 35                                                                                                         
## 36                                                                                                         
## 37                                                                                     Naboo Royal Starship
## 38                                                                                                         
## 39                                                                                                         
## 40                                                                                                         
## 41                                                                                                         
## 42                                                                                                 Scimitar
## 43                                                                                                         
## 44                                                                                                         
## 45                                                                                                         
## 46                                                                                                         
## 47                                                                                                         
## 48                                                                                                         
## 49                                                                                                         
## 50                                                                                                         
## 51                                                                                                         
## 52                                                                                                         
## 53                                                                                                         
## 54                                                                                                         
## 55                                                                                         Jedi starfighter
## 56                                                                                                         
## 57                                                                                            Naboo fighter
## 58                                                                                                         
## 59                                                                                                         
## 60                                                                                                         
## 61                                                                                                         
## 62                                                                                                         
## 63                                                                                                         
## 64                                                                                                         
## 65                                                                                                         
## 66                                                                                                         
## 67                                                                                                         
## 68                                                                                                         
## 69                                                                                                         
## 70                                                                                                         
## 71                                                                                                         
## 72                                                                                                         
## 73                                                                                                         
## 74                                                                                                         
## 75                                                                                                         
## 76                                                                                                         
## 77                                                                                 Belbullab-22 starfighter
## 78                                                                                                         
## 79                                                                                                         
## 80                                                                                                         
## 81                                                                                                         
## 82                                                                                                         
## 83                                                                                                         
## 84                                                                                      T-70 X-wing fighter
## 85                                                                                                         
## 86                                                                                                         
## 87                                                     H-type Nubian yacht, Naboo star skiff, Naboo fighter
```

---

# Printing a data.frame with head()


```r
head(as.data.frame(starwars))
```

```
##             name height mass  hair_color  skin_color eye_color birth_year
## 1 Luke Skywalker    172   77       blond        fair      blue       19.0
## 2          C-3PO    167   75        &lt;NA&gt;        gold    yellow      112.0
## 3          R2-D2     96   32        &lt;NA&gt; white, blue       red       33.0
## 4    Darth Vader    202  136        none       white    yellow       41.9
## 5    Leia Organa    150   49       brown       light     brown       19.0
## 6      Owen Lars    178  120 brown, grey       light      blue       52.0
##      sex    gender homeworld species
## 1   male masculine  Tatooine   Human
## 2   none masculine  Tatooine   Droid
## 3   none masculine     Naboo   Droid
## 4   male masculine  Tatooine   Human
## 5 female  feminine  Alderaan   Human
## 6   male masculine  Tatooine   Human
##                                                                                                                                       films
## 1                                           The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 2                    The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope
## 3 The Empire Strikes Back, Attack of the Clones, The Phantom Menace, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 4                                                              The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope
## 5                                           The Empire Strikes Back, Revenge of the Sith, Return of the Jedi, A New Hope, The Force Awakens
## 6                                                                                     Attack of the Clones, Revenge of the Sith, A New Hope
##                             vehicles                starships
## 1 Snowspeeder, Imperial Speeder Bike X-wing, Imperial shuttle
## 2                                                            
## 3                                                            
## 4                                             TIE Advanced x1
## 5              Imperial Speeder Bike                         
## 6
```

---

# Printing a tibble


```r
starwars
```

```
*## # A tibble: 87 Ã— 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
*##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blond       fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
*## # â€¦ with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
*## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: pipes

# Pipes

**Generic programming question:** Does anyone know what pipes do?

--

Pipes allow us to pass information through a sequence of operations

--

The tidyverse loads its own pipe operator, denoted `%&gt;%`

**Keyboard shortcut:** use `Ctrl/Cmd+Shift+m` to insert `%&gt;%` (with spaces)

---

# Pipe usage

To see why using pipes is so powerful, consider this contrived example based on what we did this morning:

1. Wake up
2. Get out of bed
4. Get dressed
5. Drink coffee
6. Go to class


---

# A day without pipes

You could code this through a series of assignment operations:


```r
me &lt;- wake_up(me)
me &lt;- get_out_of_bed(me)
me &lt;- get_dressed(me)
me &lt;- drink(me, "coffee")
me &lt;- go(me, "class")
```

Or by putting all these operations in a single line of code:


```r
me &lt;- go(drink(get_dressed(get_out_of_bed(wake_up(me))), "coffee"), "class")
```

Neither is ideal

---

# Pipes are the best of both worlds

We can do everything at once, in order:


```r
me %&gt;% 
  wake_up() %&gt;% 
  get_out_of_bed() %&gt;% 
  get_dressed() %&gt;% 
  drink("coffee") %&gt;% 
  go("class")
```

Emphasis is on verbs (e.g., `wake_up`, `get_out_of_bed`, etc.), not nouns (i.e., `me`)

---

# Pipes: Best practices

Write linear code

Spread code out for readability: use one line per verb

Don't use pipes...
- when you need more than 10 (use intermediate objects instead)
- for multiple inputs or outputs
- for non-linear relationships

--

**Aside:** due to the popularity of `%&gt;%`, base R now includes a native pipe `|&gt;` with slightly different properties. We will use `%&gt;%` in this class.

---
class: inverse, center, middle
name: dplyr

# dplyr

---

# What is dplyr?

&lt;img src="img/03/dplyr_wrangling.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# What is dplyr?

The dplyr package provides a **grammar of data manipulation**

--

dplyr's functions are **verbs** that correspond to things we want to **do**

--

dplyr functions all have these things in common:
1. their first argument is a data frame
2. their other arguments describe what you want to do
3. their output is a new data frame

--

1 + 3 + `%&gt;%` allow us to combine simple steps to achieve complex results

---

# dplyr has five key verbs we will use

1. `filter`: subset rows based on their values

2. `arrange`: reorder rows based on their values

3. `select`: select columns (i.e., variables)

4. `mutate`: create new columns

5. `summarize`: collapse multiple rows into a single summary value


---

# dplyr verbs operate on different things

- Rows:
  - `filter`: subset rows based on their values
  - `arrange`: reorder rows based on their values
- Columns:
  - `select`: select columns (i.e., variables)
  - `mutate`: create new columns
- Groups of rows:
  - `summarize`: collapse multiple rows into a single summary value

--

Let's study these commands together using the `starwars` data frame that comes pre-packaged with dplyr

---

# Starwars

As a reminder, this is what the `starwars` dataset looks like:


```r
starwars
```

```
## # A tibble: 87 Ã— 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blond       fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â€¦ with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```


---
name: filter

# 1) dplyr::filter

&lt;img src="img/03/dplyr_filter.jpg" width="85%" style="display: block; margin: auto;" /&gt;

---

# 1) dplyr::filter

`filter` allows us to focus on certain rows / observations

--

For example, you may only be interested in droids:


```r
starwars %&gt;% 
  filter(species == "Droid") 
```

```
## # A tibble: 6 Ã— 14
##   name   height  mass hair_color skin_color  eye_color birth_year sex   gender  
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   
## 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow           112 none  masculiâ€¦
## 2 R2-D2      96    32 &lt;NA&gt;       white, blue red               33 none  masculiâ€¦
## 3 R5-D4      97    32 &lt;NA&gt;       white, red  red               NA none  masculiâ€¦
## 4 IG-88     200   140 none       metal       red               15 none  masculiâ€¦
## 5 R4-P17     96    NA none       silver, red red, blue         NA none  feminine
## 6 BB8        NA    NA none       none        black             NA none  masculiâ€¦
## # â€¦ with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 1) dplyr::filter

Or perhaps you want to subset the humans that are taller than I am:


```r
starwars %&gt;% 
  filter( 
    species == "Human", 
    height &gt;= 194
    ) 
```

Can you name one? *Hint: there's only one*

--


```
## # A tibble: 1 Ã— 14
##   name     height  mass hair_color skin_color eye_color birth_year sex   gender 
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
*## 1 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  masculâ€¦
## # â€¦ with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```


---

# 1) dplyr::filter

Regular expressions work here too, with the help of the `stringr` package:

```r
starwars %&gt;% 
  filter(stringr::str_detect(name, "Skywalker"))
```

```
## # A tibble: 3 Ã— 14
##   name     height  mass hair_color skin_color eye_color birth_year sex    gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
## 1 Luke Skâ€¦    172    77 blond      fair       blue            19   male   mascuâ€¦
## 2 Anakin â€¦    188    84 blond      fair       blue            41.9 male   mascuâ€¦
## 3 Shmi Skâ€¦    163    NA black      fair       brown           72   female feminâ€¦
## # â€¦ with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

--

Or you can use `grepl` to achieve the same goal:

```r
starwars %&gt;% 
  filter(grepl("Skywalker", name))
```

---

# 1) dplyr::filter

A very common `filter` use case is identifying/removing missing data:

```r
starwars %&gt;% 
  filter(is.na(height))
```

```
## # A tibble: 6 Ã— 14
##   name     height  mass hair_color skin_color eye_color birth_year sex    gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
## 1 Arvel Câ€¦     NA    NA brown      fair       brown             NA male   mascuâ€¦
## 2 Finn         NA    NA black      dark       dark              NA male   mascuâ€¦
## 3 Rey          NA    NA brown      light      hazel             NA female feminâ€¦
## 4 Poe Damâ€¦     NA    NA brown      light      brown             NA male   mascuâ€¦
## 5 BB8          NA    NA none       none       black             NA none   mascuâ€¦
## 6 Captainâ€¦     NA    NA unknown    unknown    unknown           NA &lt;NA&gt;   &lt;NA&gt;  
## # â€¦ with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 1) dplyr::filter

How could you build on this to remove missing observations?

--


```r
starwars %&gt;% 
  filter(!is.na(height)) # use ! for negation
```

```
## # A tibble: 81 Ã— 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blond       fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â€¦ with 71 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: arrange

# 2) dplyr::arrange

`arrange` sorts the data frame based on the variable(s) you supply:


```r
starwars %&gt;% 
  arrange(birth_year)
```

```
## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Wicket â€¦     88  20   brown      brown      brown            8   male  mascuâ€¦
##  2 IG-88       200 140   none       metal      red             15   none  mascuâ€¦
##  3 Luke Skâ€¦    172  77   blond      fair       blue            19   male  mascuâ€¦
##  4 Leia Orâ€¦    150  49   brown      light      brown           19   femaâ€¦ feminâ€¦
##  5 Wedge Aâ€¦    170  77   brown      fair       hazel           21   male  mascuâ€¦
##  6 Plo Koon    188  80   none       orange     black           22   male  mascuâ€¦
##  7 Biggs Dâ€¦    183  84   black      light      brown           24   male  mascuâ€¦
##  8 Han Solo    180  80   brown      fair       brown           29   male  mascuâ€¦
##  9 Lando Câ€¦    177  79   black      dark       brown           31   male  mascuâ€¦
## 10 Boba Feâ€¦    183  78.2 black      fair       brown           31.5 male  mascuâ€¦
## # â€¦ with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 2) dplyr::arrange

We can also arrange items in descending order using `arrange(desc())`:

```r
starwars %&gt;% 
  arrange(desc(birth_year))
```

```
## # A tibble: 87 Ã— 14
##    name    height  mass hair_color skin_color  eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda        66    17 white      green       brown            896 male  mascuâ€¦
##  2 Jabba â€¦    175  1358 &lt;NA&gt;       green-tan,â€¦ orange           600 hermâ€¦ mascuâ€¦
##  3 Chewbaâ€¦    228   112 brown      unknown     blue             200 male  mascuâ€¦
##  4 C-3PO      167    75 &lt;NA&gt;       gold        yellow           112 none  mascuâ€¦
##  5 Dooku      193    80 white      fair        brown            102 male  mascuâ€¦
##  6 Qui-Goâ€¦    193    89 brown      fair        blue              92 male  mascuâ€¦
##  7 Ki-Adiâ€¦    198    82 white      pale        yellow            92 male  mascuâ€¦
##  8 Finis â€¦    170    NA blond      fair        blue              91 male  mascuâ€¦
##  9 Palpatâ€¦    170    75 grey       pale        yellow            82 male  mascuâ€¦
## 10 Clieggâ€¦    183    NA brown      fair        blue              82 male  mascuâ€¦
## # â€¦ with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: select

# 3) dplyr::select

`select` allows us to select columns / variables:

.pull-left[

```r
starwars %&gt;% select(name)
```

```
*## # A tibble: 87 Ã— 1
##    name              
##    &lt;chr&gt;             
##  1 Luke Skywalker    
##  2 C-3PO             
##  3 R2-D2             
##  4 Darth Vader       
##  5 Leia Organa       
##  6 Owen Lars         
##  7 Beru Whitesun lars
##  8 R5-D4             
##  9 Biggs Darklighter 
## 10 Obi-Wan Kenobi    
## # â€¦ with 77 more rows
```
]

--

.pull-right[
`select` returns a tibble even though you only asked for one variable

To get a vector, you can use:
- `starwars %&gt;% pull(name)`

Or, from base R:
- `starwars %&gt;% .$name`
- `starwars %&gt;% .[["name"]]`
]

---

# 3) dplyr::select

You can get fancy: use commas to select multiple columns, deselect a column using "-", and select consecutive columns using "first:last"

```r
starwars %&gt;% 
  select(name:skin_color, species, -height)
```

```
## # A tibble: 87 Ã— 5
##    name                mass hair_color    skin_color  species
##    &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;  
##  1 Luke Skywalker        77 blond         fair        Human  
##  2 C-3PO                 75 &lt;NA&gt;          gold        Droid  
##  3 R2-D2                 32 &lt;NA&gt;          white, blue Droid  
##  4 Darth Vader          136 none          white       Human  
##  5 Leia Organa           49 brown         light       Human  
##  6 Owen Lars            120 brown, grey   light       Human  
##  7 Beru Whitesun lars    75 brown         light       Human  
##  8 R5-D4                 32 &lt;NA&gt;          white, red  Droid  
##  9 Biggs Darklighter     84 black         light       Human  
## 10 Obi-Wan Kenobi        77 auburn, white fair        Human  
## # â€¦ with 77 more rows
```

---

# 3) dplyr::select

You can also rename your selected variables at the same time:

```r
starwars %&gt;%
  select(alias = name, crib = homeworld)
```

```
## # A tibble: 87 Ã— 2
##    alias              crib    
##    &lt;chr&gt;              &lt;chr&gt;   
##  1 Luke Skywalker     Tatooine
##  2 C-3PO              Tatooine
##  3 R2-D2              Naboo   
##  4 Darth Vader        Tatooine
##  5 Leia Organa        Alderaan
##  6 Owen Lars          Tatooine
##  7 Beru Whitesun lars Tatooine
##  8 R5-D4              Tatooine
##  9 Biggs Darklighter  Tatooine
## 10 Obi-Wan Kenobi     Stewjon 
## # â€¦ with 77 more rows
```

---

# 3) dplyr::select

If you just want to rename columns without subsetting them, use `rename`:

```r
starwars %&gt;%
  rename(alias = name, crib = homeworld)
```

```
## # A tibble: 87 Ã— 14
##    alias   height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blond       fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â€¦ with 77 more rows, and 5 more variables: crib &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 3) dplyr::select

`select(contains(PATTERN))` provides a handy shortcut:

```r
starwars %&gt;% 
  select(name, contains("color"))
```

```
## # A tibble: 87 Ã— 4
##    name               hair_color    skin_color  eye_color
##    &lt;chr&gt;              &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker     blond         fair        blue     
##  2 C-3PO              &lt;NA&gt;          gold        yellow   
##  3 R2-D2              &lt;NA&gt;          white, blue red      
##  4 Darth Vader        none          white       yellow   
##  5 Leia Organa        brown         light       brown    
##  6 Owen Lars          brown, grey   light       blue     
##  7 Beru Whitesun lars brown         light       blue     
##  8 R5-D4              &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter  black         light       brown    
## 10 Obi-Wan Kenobi     auburn, white fair        blue-gray
## # â€¦ with 77 more rows
```

---

# 3) dplyr::select

`select(..., everything())` is another useful shortcut to move important variables to the "front" of a data frame


```r
starwars %&gt;% 
  select(species, homeworld, everything()) %&gt;%
  head(5)
```

```
## # A tibble: 5 Ã— 14
##   species homeworld name           height  mass hair_color skin_color  eye_color
##   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    
## 1 Human   Tatooine  Luke Skywalker    172    77 blond      fair        blue     
## 2 Droid   Tatooine  C-3PO             167    75 &lt;NA&gt;       gold        yellow   
## 3 Droid   Naboo     R2-D2              96    32 &lt;NA&gt;       white, blue red      
## 4 Human   Tatooine  Darth Vader       202   136 none       white       yellow   
## 5 Human   Alderaan  Leia Organa       150    49 brown      light       brown    
## # â€¦ with 6 more variables: birth_year &lt;dbl&gt;, sex &lt;chr&gt;, gender &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 3) dplyr::~~select~~ relocate

You can also use `relocate` to reorder columns without subsetting:

```r
starwars %&gt;% 
  relocate(species, homeworld) %&gt;%
  head(5)
```

```
## # A tibble: 5 Ã— 14
##   species homeworld name           height  mass hair_color skin_color  eye_color
##   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    
## 1 Human   Tatooine  Luke Skywalker    172    77 blond      fair        blue     
## 2 Droid   Tatooine  C-3PO             167    75 &lt;NA&gt;       gold        yellow   
## 3 Droid   Naboo     R2-D2              96    32 &lt;NA&gt;       white, blue red      
## 4 Human   Tatooine  Darth Vader       202   136 none       white       yellow   
## 5 Human   Alderaan  Leia Organa       150    49 brown      light       brown    
## # â€¦ with 6 more variables: birth_year &lt;dbl&gt;, sex &lt;chr&gt;, gender &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
# 3) dplyr::~~select~~ relocate

&lt;img src="img/03/dplyr_relocate.png" width="65%" style="display: block; margin: auto;" /&gt;

---
name: mutate

# 4) dplyr::mutate

&lt;img src="img/03/dplyr_mutate.png" width="55%" style="display: block; margin: auto;" /&gt;

---

# 4) dplyr::mutate

You can create new columns from scratch or by transforming existing columns:

```r
starwars %&gt;% 
  select(name, birth_year) %&gt;%
  mutate(dog_years = birth_year * 7) %&gt;%
  mutate(comment = paste0(name, " is ", dog_years, " in dog years."))
```

```
## # A tibble: 87 Ã— 4
##    name               birth_year dog_years comment                              
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                
##  1 Luke Skywalker           19        133  Luke Skywalker is 133 in dog years.  
##  2 C-3PO                   112        784  C-3PO is 784 in dog years.           
##  3 R2-D2                    33        231  R2-D2 is 231 in dog years.           
##  4 Darth Vader              41.9      293. Darth Vader is 293.3 in dog years.   
##  5 Leia Organa              19        133  Leia Organa is 133 in dog years.     
##  6 Owen Lars                52        364  Owen Lars is 364 in dog years.       
##  7 Beru Whitesun lars       47        329  Beru Whitesun lars is 329 in dog yeaâ€¦
##  8 R5-D4                    NA         NA  R5-D4 is NA in dog years.            
##  9 Biggs Darklighter        24        168  Biggs Darklighter is 168 in dog yearâ€¦
## 10 Obi-Wan Kenobi           57        399  Obi-Wan Kenobi is 399 in dog years.  
## # â€¦ with 77 more rows
```

---


# 4) dplyr::mutate

`mutate` creates variables in order, so we can chain them together in a single call:

```r
starwars %&gt;% 
  select(name, birth_year) %&gt;%
  mutate(dog_years = birth_year * 7, # separate with a comma
         comment = paste0(name, " is ", dog_years, " in dog years."))
```

```
## # A tibble: 87 Ã— 4
##    name               birth_year dog_years comment                              
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                
##  1 Luke Skywalker           19        133  Luke Skywalker is 133 in dog years.  
##  2 C-3PO                   112        784  C-3PO is 784 in dog years.           
##  3 R2-D2                    33        231  R2-D2 is 231 in dog years.           
##  4 Darth Vader              41.9      293. Darth Vader is 293.3 in dog years.   
##  5 Leia Organa              19        133  Leia Organa is 133 in dog years.     
##  6 Owen Lars                52        364  Owen Lars is 364 in dog years.       
##  7 Beru Whitesun lars       47        329  Beru Whitesun lars is 329 in dog yeaâ€¦
##  8 R5-D4                    NA         NA  R5-D4 is NA in dog years.            
##  9 Biggs Darklighter        24        168  Biggs Darklighter is 168 in dog yearâ€¦
## 10 Obi-Wan Kenobi           57        399  Obi-Wan Kenobi is 399 in dog years.  
## # â€¦ with 77 more rows
```

---

# 4) dplyr::mutate

Boolean, logical, and conditional operators all work well with `mutate`:

```r
starwars %&gt;% 
  select(name, height) %&gt;%
  filter(name %in% c("Luke Skywalker", "Anakin Skywalker")) %&gt;% 
  mutate(tall1 = height &gt; 180) %&gt;%
  mutate(tall2 = ifelse(height &gt; 180, "Tall", "Short")) # same effect, but can choose labels
```

How many rows do you think this will return? How many columns?

--


```
## # A tibble: 2 Ã— 4
##   name             height tall1 tall2
##   &lt;chr&gt;             &lt;int&gt; &lt;lgl&gt; &lt;chr&gt;
## 1 Luke Skywalker      172 FALSE Short
## 2 Anakin Skywalker    188 TRUE  Tall
```

---
name: summarize

# 5) dplyr::summarize

Often we want to get summary statistics or *collapse* our data

`summarize` provides an easy way to do this

--

**Example from Lab 2:** "What are the mininum, maximum, and average prices of the diamonds?"

```r
diamonds %&gt;% 
  summarize(min = min(price),      # calculate the min price
            max = max(price),      # calculate the max price
            average = mean(price)) # calculate the mean price
```

```
## # A tibble: 1 Ã— 3
##     min   max average
##   &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
## 1   326 18823   3933.
```

---

# 5) dplyr::summarize

Including "na.rm = TRUE" keeps NAs from propagating to the end result:

.pull-left[

```r
# Probably not what we want
starwars %&gt;% 
  summarize(mh = mean(height))
```

```
## # A tibble: 1 Ã— 1
##      mh
##   &lt;dbl&gt;
## 1    NA
```
]

.pull-right[

```r
# Much better
starwars %&gt;% 
  summarize(mh = mean(height, na.rm = TRUE))
```

```
## # A tibble: 1 Ã— 1
##      mh
##   &lt;dbl&gt;
## 1  174.
```
]

--

Is this a feature or a bug?

--

It depends on the context!

---

# Bonus: dplyr::group_by

`summarize` is particularly useful in combination with `group_by`:

```r
starwars %&gt;% 
  group_by(species, gender) %&gt;% # for each species-gender combo
  summarize(mean_height = mean(height, na.rm = TRUE)) # calculate the mean height
```

```
## `summarise()` has grouped output by 'species'. You can override using the `.groups` argument.
```

```
## # A tibble: 42 Ã— 3
## # Groups:   species [38]
##    species   gender    mean_height
##    &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
##  1 Aleena    masculine          79
##  2 Besalisk  masculine         198
##  3 Cerean    masculine         198
##  4 Chagrian  masculine         196
##  5 Clawdite  feminine          168
##  6 Droid     feminine           96
##  7 Droid     masculine         140
##  8 Dug       masculine         112
##  9 Ewok      masculine          88
## 10 Geonosian masculine         183
## # â€¦ with 32 more rows
```

---

# Bonus: dplyr::ungroup

&lt;img src="img/03/group_by_ungroup.png" width="65%" style="display: block; margin: auto;" /&gt;

Groups are persistent (sort of), `ungroup` removes them

---
class: inverse, center, middle
name: goodies

# Other dplyr goodies for your reference

---

# Other dplyr goodies: across

&lt;img src="img/03/dplyr_across.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Other dplyr goodies: across

Combining `mutate` with `across` allows you to work on a subset of variables:


```r
starwars %&gt;% 
  select(name:eye_color) %&gt;% 
* mutate(across(where(is.character), toupper)) %&gt;% # capitalize all character variables
  head(5)
```

```
## # A tibble: 5 Ã— 6
##   name           height  mass hair_color skin_color  eye_color
##   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    
## 1 LUKE SKYWALKER    172    77 BLOND      FAIR        BLUE     
## 2 C-3PO             167    75 &lt;NA&gt;       GOLD        YELLOW   
## 3 R2-D2              96    32 &lt;NA&gt;       WHITE, BLUE RED      
## 4 DARTH VADER       202   136 NONE       WHITE       YELLOW   
## 5 LEIA ORGANA       150    49 BROWN      LIGHT       BROWN
```

---

# Other dplyr goodies: across

We can also use `across` within `summarize`:


```r
starwars %&gt;% 
  group_by(species) %&gt;% 
* summarize(across(where(is.numeric), mean, na.rm=T)) %&gt;% # take the mean of all numeric variables
  head(5)
```

```
## # A tibble: 5 Ã— 4
##   species  height  mass birth_year
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1 Aleena       79    15        NaN
## 2 Besalisk    198   102        NaN
## 3 Cerean      198    82         92
## 4 Chagrian    196   NaN        NaN
## 5 Clawdite    168    55        NaN
```
---

# Other dplyr goodies: count

`count` to get the number of observations:
.pull-left[

```r
starwars %&gt;% 
  count(species)
```

```
## # A tibble: 38 Ã— 2
##    species       n
##    &lt;chr&gt;     &lt;int&gt;
##  1 Aleena        1
##  2 Besalisk      1
##  3 Cerean        1
##  4 Chagrian      1
##  5 Clawdite      1
##  6 Droid         6
##  7 Dug           1
##  8 Ewok          1
##  9 Geonosian     1
## 10 Gungan        3
## # â€¦ with 28 more rows
```
]

.pull-right[

```r
starwars %&gt;% 
  group_by(species) %&gt;% summarize(num = n())
```

```
## # A tibble: 38 Ã— 2
##    species     num
##    &lt;chr&gt;     &lt;int&gt;
##  1 Aleena        1
##  2 Besalisk      1
##  3 Cerean        1
##  4 Chagrian      1
##  5 Clawdite      1
##  6 Droid         6
##  7 Dug           1
##  8 Ewok          1
##  9 Geonosian     1
## 10 Gungan        3
## # â€¦ with 28 more rows
```
]

---

# Other dplyr goodies: distinct

`distinct` to isolate unique observations:

```r
starwars %&gt;% distinct(species)
```

```
## # A tibble: 38 Ã— 1
##    species       
##    &lt;chr&gt;         
##  1 Human         
##  2 Droid         
##  3 Wookiee       
##  4 Rodian        
##  5 Hutt          
##  6 Yoda's species
##  7 Trandoshan    
##  8 Mon Calamari  
##  9 Ewok          
## 10 Sullustan     
## # â€¦ with 28 more rows
```



---

# Other dplyr goodies: window functions

[Window functions](https://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html) make it easy to get leads and lags, percentiles, cumulative sums, etc.
- See `vignette("window-functions")`

--

&lt;br&gt;

The final set of dplyr "goodies" worth mentioning are the family of join operations, but we'll come back to those later


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%",
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
